<!DOCTYPE HTML>
<html lang="zh-CN">



<head><meta name="generator" content="Hexo 3.9.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta name="baidu-site-verification" content="code-p6MPyNrcYn">
    <meta charset="utf-8">
    <meta name="keywords" content="Docker学习笔记, HTML,CSS,JavaScript,JQuery,Java,Vue,学习笔记,生活随笔">
    <meta name="description" content="关闭一扇窗，另一扇等着你打开！往事如烟，浅笑而安。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Docker学习笔记 | lskj</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>
<style type="text/css" lang="css">
    #loading-container{
        position: fixed;
        top: 0;
        left: 0;
        min-height: 100vh;
        width: 100vw;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: #FFF;
        text-align: center;
        /* loader页面消失采用渐隐的方式*/
        -webkit-transition: opacity 1s ease;
        -moz-transition: opacity 1s ease;
        -o-transition: opacity 1s ease;
        transition: opacity 1s ease;
    }
    .loading-image{
        width: 120px;
        height: 50px;
        transform: translate(-50%);
    }
    
    .loading-image div:nth-child(2) {
        -webkit-animation: pacman-balls 1s linear 0s infinite;
        animation: pacman-balls 1s linear 0s infinite
    }

    .loading-image div:nth-child(3) {
        -webkit-animation: pacman-balls 1s linear .33s infinite;
        animation: pacman-balls 1s linear .33s infinite
    }

    .loading-image div:nth-child(4) {
        -webkit-animation: pacman-balls 1s linear .66s infinite;
        animation: pacman-balls 1s linear .66s infinite
    }

    .loading-image div:nth-child(5) {
        -webkit-animation: pacman-balls 1s linear .99s infinite;
        animation: pacman-balls 1s linear .99s infinite
    }
    
   .loading-image div:first-of-type {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_up .5s 0s infinite;
        animation: rotate_pacman_half_up .5s 0s infinite;
    }
    .loading-image div:nth-child(2) {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_down .5s 0s infinite;
        animation: rotate_pacman_half_down .5s 0s infinite;
        margin-top: -50px;
    }
    @-webkit-keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @-webkit-keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

    @keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}
    
    @-webkit-keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}

    @keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}
    
   
    .loading-image div:nth-child(3),
    .loading-image div:nth-child(4),
    .loading-image div:nth-child(5),
    .loading-image div:nth-child(6){
        background-color: #49b1f5;
        width: 15px;
        height: 15px;
        border-radius: 100%;
        margin: 2px;
        width: 10px;
        height: 10px;
        position: absolute;
        transform: translateY(-6.25px);
        top: 25px;
        left: 100px;
    }
    .loading-text{
        margin-bottom: 20vh;
        text-align: center;
        color: #2c3e50;
        font-size: 2rem;
        box-sizing: border-box;
        padding: 0 10px;
        text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    @media only screen and (max-width: 500px) {
         .loading-text{
            font-size: 1.5rem;
         }
    }
    .fadeout {
        opacity: 0;
        filter: alpha(opacity=0);
    }
    /* logo出现动画 */
    @-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}
    @keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);}}
 </style>
 <script>
(function () {
    const loaded = function(){
       setTimeout(function(){
            const loader = document.getElementById("loading-container");
            loader.className="fadeout" ;//使用渐隐的方法淡出loading page
            // document.getElementById("body-wrap").style.display="flex";
            setTimeout(function(){
                loader.style.display="none";
            },1000); 
        },1000);//强制显示loading page 1s  
    };
    loaded();
})()
 </script>
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="lskj" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"><style type="text/css" lang="css">
    #loading-container{
        position: fixed;
        top: 0;
        left: 0;
        min-height: 100vh;
        width: 100vw;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: #FFF;
        text-align: center;
        /* loader页面消失采用渐隐的方式*/
        -webkit-transition: opacity 1s ease;
        -moz-transition: opacity 1s ease;
        -o-transition: opacity 1s ease;
        transition: opacity 1s ease;
    }
    .loading-image{
        width: 120px;
        height: 50px;
        transform: translate(-50%);
    }
    
    .loading-image div:nth-child(2) {
        -webkit-animation: pacman-balls 1s linear 0s infinite;
        animation: pacman-balls 1s linear 0s infinite
    }

    .loading-image div:nth-child(3) {
        -webkit-animation: pacman-balls 1s linear .33s infinite;
        animation: pacman-balls 1s linear .33s infinite
    }

    .loading-image div:nth-child(4) {
        -webkit-animation: pacman-balls 1s linear .66s infinite;
        animation: pacman-balls 1s linear .66s infinite
    }

    .loading-image div:nth-child(5) {
        -webkit-animation: pacman-balls 1s linear .99s infinite;
        animation: pacman-balls 1s linear .99s infinite
    }
    
   .loading-image div:first-of-type {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_up .5s 0s infinite;
        animation: rotate_pacman_half_up .5s 0s infinite;
    }
    .loading-image div:nth-child(2) {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_down .5s 0s infinite;
        animation: rotate_pacman_half_down .5s 0s infinite;
        margin-top: -50px;
    }
    @-webkit-keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @-webkit-keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

    @keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}
    
    @-webkit-keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}

    @keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}
    
   
    .loading-image div:nth-child(3),
    .loading-image div:nth-child(4),
    .loading-image div:nth-child(5),
    .loading-image div:nth-child(6){
        background-color: #49b1f5;
        width: 15px;
        height: 15px;
        border-radius: 100%;
        margin: 2px;
        width: 10px;
        height: 10px;
        position: absolute;
        transform: translateY(-6.25px);
        top: 25px;
        left: 100px;
    }
    .loading-text{
        margin-bottom: 20vh;
        text-align: center;
        color: #2c3e50;
        font-size: 2rem;
        box-sizing: border-box;
        padding: 0 10px;
        text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    @media only screen and (max-width: 500px) {
         .loading-text{
            font-size: 1.5rem;
         }
    }
    .fadeout {
        opacity: 0;
        filter: alpha(opacity=0);
    }
    /* logo出现动画 */
    @-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}
    @keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);}}
 </style>
 <script>
(function () {
    const loaded = function(){
       setTimeout(function(){
            const loader = document.getElementById("loading-container");
            loader.className="fadeout" ;//使用渐隐的方法淡出loading page
            // document.getElementById("body-wrap").style.display="flex";
            setTimeout(function(){
                loader.style.display="none";
            },1000); 
        },1000);//强制显示loading page 1s  
    };
    loaded();
})()
 </script>
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>





 <div id="loading-container">
     <p class="loading-text">玩命加载中 . . . </p> 
     <div class="loading-image">
         <div></div>
         <div></div>
         <div></div>
         <div></div> 
         <div></div>
     </div>
 </div><body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!--动态背景-->
    <!-- <div id="bg"><canvas></canvas><canvas></canvas><canvas></canvas></div>
    <script src="/js/canva_moving_effect.js"></script> -->

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">lskj</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/galleries" class="waves-effect waves-light">
      
      <i class="fas fa-image" style="zoom: 0.6;"></i>
      
      <span>相册</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/navigate" class="waves-effect waves-light">
      
      <i class="fas fa-location-arrow" style="zoom: 0.6;"></i>
      
      <span>导航</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <!--全屏-->
  <li id="fullscreen_li" class="fullscreen"><a href="javascript:void(0);" class="modal-trigger waves-effect waves-light"><i id="fullscreen" class="fas fa-expand-arrows-alt" title="全屏" style="zoom: 0.65;"></i></a></li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">lskj</div>
        <div class="logo-desc">
            
            关闭一扇窗，另一扇等着你打开！往事如烟，浅笑而安。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/galleries" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-image"></i>
			
			相册
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/navigate" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-location-arrow"></i>
			
			导航
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<!-- <div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/lskjwp/image@master/imageCover/docker学习笔记.jpg')"> -->
    <div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/20.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Docker学习笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
        background-color: rgb(255, 255, 255,0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        background: linear-gradient(to bottom right,#61B5F3 0%, #26D6D1 100%);
        width: 35px;
        height: 35px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 35px;
        position: absolute;
        right: 0px;
        /* font-size: 1.4rem; */
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Docker/">
                                <span class="chip bg-color">Docker</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Docker/" class="post-category">
                                Docker
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:
                    2020-11-26
                </div>
                

                

                <!--添加作者信息--> 
                <div class="info-break-policy"> 
                     
                        <i class="fa fa-pencil"></i> 作者: 勇也很努力
                     
                </div>

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:
                    6.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:
                    33 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>学习视频链接：<a href="https://www.bilibili.com/video/av838132893" target="_blank" rel="noopener">B站 遇见狂神说</a></p>
<a id="more"></a>
<h1 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h1><p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的<a href="https://baike.baidu.com/item/镜像/1574" target="_blank" rel="noopener">镜像</a>中，然后发布到任何流行的 <a href="https://baike.baidu.com/item/Linux" target="_blank" rel="noopener">Linux</a>或<a href="https://baike.baidu.com/item/Windows/165458" target="_blank" rel="noopener">Windows</a> 机器上，也可以实现<a href="https://baike.baidu.com/item/虚拟化/547949" target="_blank" rel="noopener">虚拟化</a>。容器是完全使用<a href="https://baike.baidu.com/item/沙箱/393318" target="_blank" rel="noopener">沙箱</a>机制，相互之间不会有任何接口。</p>
<p>docker是基于Go语言开发的。</p>
<p>官网：<a href="https://www.docker.com/" target="_blank" rel="noopener">https://www.docker.com/</a></p>
<p>文档地址：<a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com/</a></p>
<p>仓库地址：<a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p>
<blockquote>
<p>容器化技术</p>
</blockquote>
<p>容器技术:有效的将单个操作系统的资源划分到孤立的组中，以便更好的在孤立的组之间平衡有冲突的资源使用需求，这种技术就是容器技术。</p>
<p>容器化技术不是模拟一个完整的操作系统。</p>
<p><strong>Docker与虚拟机技术的区别：</strong></p>
<ul>
<li>传统虚拟机，虚拟出一套硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件。</li>
<li>容器内的应用直接运行在宿主机的内核中，容器是没有自己的内核的，也没有虚拟的硬件，故轻便。</li>
<li>每个容器间是互相隔离的，每个容器内都有一个属于自己的文件系统，互不影响。</li>
</ul>
<blockquote>
<p>DevOps（开发、运维）</p>
</blockquote>
<p><strong>应用更快速的交互和部署。</strong></p>
<p>Docker，打包镜像，发布测试，一键运行。</p>
<p><strong>更便捷的升级和扩容。</strong></p>
<p><strong>更简单的系统运维。</strong></p>
<p><strong>更高效的计算资源利用。</strong></p>
<p>Docker是内核级别的虚拟化，可以在一个物理机上运行很多容器实例。服务器的性能可以被压榨到极致。</p>
<h1 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h1><h2 id="Docker的基本组成"><a href="#Docker的基本组成" class="headerlink" title="Docker的基本组成"></a>Docker的基本组成</h2><p><img src="/archives/4a3d459a/architecture.svg" alt="Docker Architecture Diagram"></p>
<p><strong>镜像（image）</strong></p>
<p>docker镜像就好比是一个模板，可以通过这个 模板来创建容器服务，tomact镜像-&gt;run运行-&gt;Tomact01容器（提供服务器），通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的）</p>
<p><strong>容器（container）</strong></p>
<p>Docker利用容器技术，独立运行一个或一个组应用，通过镜像来创建的。</p>
<p>启动、停止、删除=&gt;基本命令</p>
<p><strong>仓库（repository）</strong></p>
<p>仓库就是存放镜像的地方。</p>
<p>仓库分为共有仓库和私有仓库。</p>
<h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><blockquote>
<p>环境准备</p>
</blockquote>
<p>CentOS7.8、XShell</p>
<blockquote>
<p>环境查看</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 系统内核需升级到2.10以上</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># uname -r</span>
3.10.0-1127.19.1.el7.x86_64</code></pre>
<blockquote>
<p>安装</p>
</blockquote>
<p>文档地址：<a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">https://docs.docker.com/engine/install/centos/</a></p>
<p><strong>1、卸载旧版本</strong></p>
<pre class=" language-bash"><code class="language-bash">yum remove docker \
                   docker-client \
                   docker-client-latest \
                   docker-common \
                   docker-latest \
                   docker-latest-logrotate \
                   docker-logrotate \
                   docker-engine</code></pre>
<p><strong>2、需要的安装包</strong></p>
<pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> -y yum-utils</code></pre>
<p><strong>3、设置镜像的仓库</strong></p>
<p>官方：</p>
<pre class=" language-bash"><code class="language-bash">yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo</code></pre>
<p>阿里云镜像：</p>
<pre class=" language-bash"><code class="language-bash">yum-config-manager \
    --add-repo \
    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></pre>
<blockquote>
<p>更新yum软件包索引</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">yum makecache fast</code></pre>
<p><strong>4、安装docker</strong></p>
<pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io</code></pre>
<p><code>docker-ce</code>社区版，<code>ee</code>是企业版。</p>
<p><strong>5、启动docker</strong></p>
<pre class=" language-bash"><code class="language-bash">systemctl start docker</code></pre>
<p><strong>6、查看docker是否安装成功</strong></p>
<pre class=" language-bash"><code class="language-bash">docker version</code></pre>
<p><strong>7、hello-world测试</strong></p>
<pre class=" language-bash"><code class="language-bash">docker run hello-world</code></pre>
<p><img src="/archives/4a3d459a/image-20201122212102654.png" alt="hello-world"></p>
<p><img src="/archives/4a3d459a/image-20201122215026702.png" alt="hello-world流程"></p>
<p><strong>8、查看一下下载的这个hello-world镜像</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              bf756fb1ae65        10 months ago       13.3kB
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<blockquote>
<p>卸载docker</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 卸载依赖</span>
yum remove docker-ce docker-ce-cli containerd.io
<span class="token comment" spellcheck="true"># 删除资源</span>
<span class="token function">rm</span> -rf /var/lib/docker
<span class="token comment" spellcheck="true"># /var/lib/docker docker的默认工作路径</span></code></pre>
<h2 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h2><p>1、登录阿里云后，进入控制台，点击产品与服务。</p>
<p><img src="/archives/4a3d459a/image-20201122213446826.png" alt="容器镜像服务"></p>
<p>2、首次使用，需要开通，设置Registry登录密码。</p>
<p>3、找到镜像加速地址。</p>
<p><img src="/archives/4a3d459a/image-20201122213746315.png" alt="镜像加速地址"></p>
<p>4、配置使用。</p>
<pre class=" language-shell"><code class="language-shell">sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://m0dved78.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker</code></pre>
<h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><p>Docker是一个Client-Server结构的系统，Docker的守护进程服务运行在主机上。通过Socket丛客户端访问。</p>
<p>DockerServer接收到Docker-Client指令，就会执行命令。</p>
<p><img src="/archives/4a3d459a/image-20201123093120844.png" alt=""></p>
<blockquote>
<p>Docker为什么比VM快？</p>
</blockquote>
<p><img src="/archives/4a3d459a/u=1473564113,4288905819&amp;fm=26&amp;gp=0.jpg" alt=""></p>
<p>1、Docker有着比虚拟机更少的抽象层。</p>
<p>2、Docker利用的是宿主机的内核，VM需要的是Guest OS。</p>
<p>当新建一个容器时，Docker不需要和虚拟机一样重新加载一个操作系统，避免了引导、加载操作系统内核这个比较费时费资源的过程，当新建一个虚拟机时，虚拟机软件需要加载Guest OS，这个新建过程是分钟级别的，而Docker由于直接利用宿主机的操作系统则省略了这个过程，因此新建一个Docker容器只需要几秒钟。</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">Docker容器</th>
<th align="center">虚拟机（VM）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">操作系统</td>
<td align="center">与宿主机共享OS</td>
<td align="center">宿主机OS上运行宿主机OS</td>
</tr>
<tr>
<td align="center">存储大小</td>
<td align="center">镜像小，便于存储与传输</td>
<td align="center">镜像庞大（vmdk等）</td>
</tr>
<tr>
<td align="center">运行性能</td>
<td align="center">几乎无额外性能损失</td>
<td align="center">操作系统额外的cpu、内存消耗</td>
</tr>
<tr>
<td align="center">移植性</td>
<td align="center">轻便、灵活、适用于Linux</td>
<td align="center">笨重、与虚拟化技术耦合度高</td>
</tr>
<tr>
<td align="center">硬件亲和性</td>
<td align="center">面向软件开发者</td>
<td align="center">面向硬件运维者</td>
</tr>
</tbody></table>
<h1 id="三、Docker常用命令"><a href="#三、Docker常用命令" class="headerlink" title="三、Docker常用命令"></a>三、Docker常用命令</h1><p><img src="/archives/4a3d459a/u=3467122840,3410989387&amp;fm=26&amp;gp=0.jpg" alt=""></p>
<h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><pre class=" language-bash"><code class="language-bash">docker version <span class="token comment" spellcheck="true">#显示docker的版本信息</span>
docker info <span class="token comment" spellcheck="true">#显示docker的系统信息，包括镜像和容器数量</span>
docker 命令 --help <span class="token comment" spellcheck="true">#帮助命令</span></code></pre>
<p>文档地址：<a href="https://docs.docker.com/engine/reference/commandline/docker/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/docker/</a></p>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><h3 id="docker-images"><a href="#docker-images" class="headerlink" title="docker images"></a>docker images</h3><p><strong>查看所有本地的主机上的镜像</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              bf756fb1ae65        10 months ago       13.3kB</code></pre>
<p><code>REPOSITORY</code>  镜像的仓库源<br><code>TAG</code>         镜像的标签<br><code>IMAGE ID</code>    镜像的id<br><code>CREATED</code>     镜像的创建时间<br><code>SIZE</code>        镜像的大小</p>
<blockquote>
<p>可选项</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">Options:
  -a, --all             列出所有的镜像
      --digests         Show digests
  -f, --filter filter   Filter output based on conditions provided
      --format string   Pretty-print images using a Go template
      --no-trunc        Don't truncate output
  -q, --quiet           只显示镜像的id</code></pre>
<h3 id="docker-search"><a href="#docker-search" class="headerlink" title="docker search"></a>docker search</h3><p><strong>搜索镜像</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker search mysql</span>
NAME                              DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
mysql                             MySQL is a widely used, open-source relation…   10202               <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>                
mariadb                           MariaDB is a community-developed fork of MyS…   3753                <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>                
mysql/mysql-server                Optimized MySQL Server Docker images. Create…   744                                     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span></code></pre>
<blockquote>
<p>可选项</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">Options:
  -f, --filter filter   Filter output based on conditions provided
      --format string   Pretty-print search using a Go template
      --limit int       Max number of search results <span class="token punctuation">(</span>default 25<span class="token punctuation">)</span>
      --no-trunc        Don't truncate output</code></pre>
<p>通过搜藏来过滤</p>
<pre class=" language-bash"><code class="language-bash">--filter<span class="token operator">=</span>STARS<span class="token operator">=</span>3000 <span class="token comment" spellcheck="true">#搜索出来的镜像就是STARS大于3000的</span>

<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker search mysql --filter=STARS=3000</span>
NAME                DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
mysql               MySQL is a widely used, open-source relation…   10202               <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>                
mariadb             MariaDB is a community-developed fork of MyS…   3753                <span class="token punctuation">[</span>OK<span class="token punctuation">]</span> </code></pre>
<h3 id="docker-pull"><a href="#docker-pull" class="headerlink" title="docker pull"></a>docker pull</h3><p><strong>下载镜像</strong></p>
<p><code>docker pull 镜像名[:tag]</code></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker pull mysql</span>
Using default tag: latest <span class="token comment" spellcheck="true">#如果不写tag，默认就是latest</span>
latest: Pulling from library/mysql
852e50cd189d: Pull complete  <span class="token comment" spellcheck="true">#分层下载，docker image的核心，联合文件系统</span>
29969ddb0ffb: Pull complete 
a43f41a44c48: Pull complete 
5cdd802543a3: Pull complete 
b79b040de953: Pull complete 
938c64119969: Pull complete 
7689ec51a0d9: Pull complete 
a880ba7c411f: Pull complete 
984f656ec6ca: Pull complete 
9f497bce458a: Pull complete 
b9940f97694b: Pull complete 
2f069358dc96: Pull complete 
Digest: sha256:4bb2e81a40e9d0d59bd8e3dc2ba5e1f2197696f6de39a91e90798dd27299b093 <span class="token comment" spellcheck="true">#签名</span>
Status: Downloaded newer image <span class="token keyword">for</span> mysql:latest
docker.io/library/mysql:latest <span class="token comment" spellcheck="true">#真实地址</span></code></pre>
<p><code>docker pull mysql</code> == <code>docker pull docker.io/library/mysql:latest</code></p>
<p><strong>指定版本下载</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker pull mysql:5.7</span>
5.7: Pulling from library/mysql
852e50cd189d: Already exists 
29969ddb0ffb: Already exists 
a43f41a44c48: Already exists 
5cdd802543a3: Already exists 
b79b040de953: Already exists 
938c64119969: Already exists 
7689ec51a0d9: Already exists 
36bd6224d58f: Pull complete 
cab9d3fa4c8c: Pull complete 
1b741e1c47de: Pull complete 
aac9d11987ac: Pull complete 
Digest: sha256:8e2004f9fe43df06c3030090f593021a5f283d028b5ed5765cc24236c2c4d88e
Status: Downloaded newer image <span class="token keyword">for</span> mysql:5.7
docker.io/library/mysql:5.7</code></pre>
<h3 id="docker-rmi"><a href="#docker-rmi" class="headerlink" title="docker rmi"></a>docker rmi</h3><p><strong>删除镜像</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
mysql               5.7                 ae0658fdbad5        2 days ago          449MB
mysql               latest              dd7265748b5d        2 days ago          545MB
hello-world         latest              bf756fb1ae65        10 months ago       13.3kB
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker rmi -f dd7265748b5d</span>
Untagged: mysql:latest
Untagged: mysql@sha256:4bb2e81a40e9d0d59bd8e3dc2ba5e1f2197696f6de39a91e90798dd27299b093
Deleted: sha256:dd7265748b5dc3211208fb9aa232cef8d3fefd5d9a2a80d87407b8ea649e571c
Deleted: sha256:aac9a624212bf416c3b41a62212caf12ed3c578d6b17b0f15be13a7dab56628d
Deleted: sha256:1bf3ce09276e9e128108b166121e5d04abd16e7de7473b53b3018c6db0cf23ff
Deleted: sha256:24c6444cea460c3cc2f4e0385e3e97819a0672a54a361921f95d4582583abd59
Deleted: sha256:77585ebe3eaa035694084b3c5937fe82b8972aae1e6c6070fc4d7bc391d10928
Deleted: sha256:1cfd539163ceb17f7bb85a0da968714fe9258b75dbf73f5ad45392a45cfd34b7
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
mysql               5.7                 ae0658fdbad5        2 days ago          449MB
hello-world         latest              bf756fb1ae65        10 months ago       13.3kB
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker rmi -f $(docker images -aq)</span>
Untagged: mysql:5.7
Untagged: mysql@sha256:8e2004f9fe43df06c3030090f593021a5f283d028b5ed5765cc24236c2c4d88e
Deleted: sha256:ae0658fdbad5fb1c9413c998d8a573eeb5d16713463992005029c591e6400d02
Deleted: sha256:a2cf831f4221764f4484ff0df961b54f1f949ed78220de1b24046843c55ac40f
Deleted: sha256:0a7adcc95a91b1ec2beab283e0bfce5ccd6df590bd5a5e894954fcf27571e7f5
Deleted: sha256:0fae465cbacf7c99aa90bc286689bc88a35d086f37fd931e03966d312d5dfb10
Deleted: sha256:23af125b9e54a94c064bdfacc2414b1c8fba288aff48308e8117beb08b38cb19
Deleted: sha256:c37f414ac8d2b5e5d39f159a6dffd30b279c1268f30186cee5da721e451726ea
Deleted: sha256:955b3c214bccf3ee2a7930768137fd7ed6a72677334be67a07c78a622abd318a
Deleted: sha256:a2e35a0fdb20100365e2fb26c65357fcf926ac7990bf9074a51cbac5a8358d7e
Deleted: sha256:8c3a028fc66f360ce6ce6c206786df68fac4c24257474cbe4f67eda0ac21efd6
Deleted: sha256:0a6d37fabaceb4faa555e729a7d97cb6ee193cb97789a213907a3d3c156d7e35
Deleted: sha256:579519c51de1afe1e29d284b1741af239a307975197cf6ce213a70068d923231
Deleted: sha256:f5600c6330da7bb112776ba067a32a9c20842d6ecc8ee3289f1a713b644092f8
Untagged: hello-world:latest
Untagged: hello-world@sha256:e7c70bb24b462baa86c102610182e3efcb12a04854e8c582838d92970a09f323
Deleted: sha256:bf756fb1ae65adf866bd8c456593cd24beb6a0a061dedf42b26a993176745f6b
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker images</span>
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<p><code>docker rmi -f 镜像id</code>删除指定的镜像。</p>
<p><code>docker rmi -f 镜像id 镜像id 镜像id</code>删除多个镜像。</p>
<p><code>docker rmi -f $(docker images -aq)</code>删除全部的镜像。</p>
<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><blockquote>
<p>有了镜像才可以创建容器</p>
</blockquote>
<p>下载一个centos镜像进行测试。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker pull centos</span>
Using default tag: latest
latest: Pulling from library/centos
3c72a8ed6814: Pull complete 
Digest: sha256:76d24f3ba3317fa945743bb3746fbaf3a0b752f10b10376960de01da70685fbd
Status: Downloaded newer image <span class="token keyword">for</span> centos:latest
docker.io/library/centos:latest</code></pre>
<p><strong>新建容器并启动</strong></p>
<pre class=" language-bash"><code class="language-bash">docker run <span class="token punctuation">[</span>可选参数<span class="token punctuation">]</span> image

<span class="token comment" spellcheck="true"># 参数说明</span>
--name<span class="token operator">=</span><span class="token string">"Name"</span>   容器名字，用来区分容器
-d              后台方式运行
-it             使用交互方式运行，进入容器查看内容
-p              指定容器端口 -p 8080:8080
    -p ip:主机端口:容器端口
    -p 主机端口:容器端口
    -p 容器端口
—P              随机指定端口</code></pre>
<blockquote>
<p>测试</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 启动并进入容器</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -it centos /bin/bash</span>
<span class="token punctuation">[</span>root@5ea79d7e4aaa /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls #查看容器内的centos</span>
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="token comment" spellcheck="true">#从容器中退回主机</span>
<span class="token punctuation">[</span>root@5ea79d7e4aaa /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># exit </span>
<span class="token keyword">exit</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
bin  boot  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</code></pre>
<p><strong>列出所有的运行的容器</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># docker ps 命令</span>
     <span class="token comment" spellcheck="true">#列出当前正在运行的容器</span>
-a   <span class="token comment" spellcheck="true">#列出当前正在运行的容器，并带出历史运行过的容器</span>
-n<span class="token operator">=</span>? <span class="token comment" spellcheck="true">#显示最近创建的容器</span>
-q   <span class="token comment" spellcheck="true">#只显示容器的编号</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps -a</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                          PORTS               NAMES
5ea79d7e4aaa        centos              <span class="token string">"/bin/bash"</span>         3 minutes ago       Exited <span class="token punctuation">(</span>0<span class="token punctuation">)</span> About a minute ago                       practical_pasteur
0126d6ae66c8        bf756fb1ae65        <span class="token string">"/hello"</span>            14 hours ago        Exited <span class="token punctuation">(</span>0<span class="token punctuation">)</span> 14 hours ago                             dreamy_williamson</code></pre>
<p><strong>退出容器</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token keyword">exit</span>  <span class="token comment" spellcheck="true">#直接停止容器并退出</span>
Ctrl + P + Q <span class="token comment" spellcheck="true">#容器不停止退出</span></code></pre>
<p><strong>删除容器</strong></p>
<pre class=" language-bash"><code class="language-bash">docker <span class="token function">rm</span> 容器id  <span class="token comment" spellcheck="true">#删除指定的容器，不能删除正在运行的容器，如果需强制删除使用rm -f</span>
docker <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -aq<span class="token variable">)</span></span>  <span class="token comment" spellcheck="true">#删除所有的容器</span>
docker <span class="token function">ps</span> -a -q<span class="token operator">|</span><span class="token function">xargs</span> docker <span class="token function">rm</span>  <span class="token comment" spellcheck="true">#删除所有的容器</span></code></pre>
<p><strong>启动和停止容器的操作</strong></p>
<pre class=" language-bash"><code class="language-bash">docker start 容器id    <span class="token comment" spellcheck="true">#启动容器</span>
docker restart 容器id  <span class="token comment" spellcheck="true">#重启容器</span>
docker stop 容器id     <span class="token comment" spellcheck="true">#停止当前正在运行的容器</span>
docker <span class="token function">kill</span> 容器id     <span class="token comment" spellcheck="true">#强制停止当前容器</span></code></pre>
<h2 id="常用其它命令"><a href="#常用其它命令" class="headerlink" title="常用其它命令"></a>常用其它命令</h2><h3 id="后台启动容器"><a href="#后台启动容器" class="headerlink" title="后台启动容器"></a>后台启动容器</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#命令 docker run -d 镜像名</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d centos</span>
d50f3d4deb0f29e7b2e11b27f4ff4bcef7fb1084b87485236544516490b978e9
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<blockquote>
<p>问题</p>
</blockquote>
<p><code>docker ps</code>发现centos停止了。</p>
<p>docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止。</p>
<p>nginx，容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了。</p>
<h3 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h3><pre class=" language-bash"><code class="language-bash">docker logs -f -t --tail number 容器id   
<span class="token comment" spellcheck="true">#如果没有显示日志，编写一段shell脚本，进行测试你</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d centos /bin/sh -c "while true;do echo lskj;sleep 1;done"</span>
46b9b0ea42617276eb5dc975abb489954a306c67fbec3586df75432dfc0e34ea
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
46b9b0ea4261        centos              <span class="token string">"/bin/sh -c 'while t…"</span>   3 seconds ago       Up 3 seconds                            kind_lamport
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>


<span class="token comment" spellcheck="true"># 显示日志</span>
-tf            <span class="token comment" spellcheck="true">#显示日志</span>
--tail number  <span class="token comment" spellcheck="true">#要显示日志条数</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker logs -f -t --tail 10 46b9b0ea4261</span></code></pre>
<h3 id="查看容器中进程信息"><a href="#查看容器中进程信息" class="headerlink" title="查看容器中进程信息"></a>查看容器中进程信息</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 命令：docker top 容器id</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
46b9b0ea4261        centos              <span class="token string">"/bin/sh -c 'while t…"</span>   6 minutes ago       Up 6 minutes                            kind_lamport
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker top 46b9b0ea4261</span>
UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
root                14814               14797               0                   11:13               ?                   00:00:00            /bin/sh -c <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token keyword">echo</span> lskj<span class="token punctuation">;</span><span class="token function">sleep</span> 1<span class="token punctuation">;</span><span class="token keyword">done</span>
root                15308               14814               0                   11:20               ?                   00:00:00            /usr/bin/coreutils --coreutils-prog-shebang<span class="token operator">=</span>sleep /usr/bin/sleep 1
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<h3 id="查看镜像的元数据"><a href="#查看镜像的元数据" class="headerlink" title="查看镜像的元数据"></a>查看镜像的元数据</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#命令：docker inspect 容器id</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker inspect 46b9b0ea4261</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"Id"</span><span class="token keyword">:</span> <span class="token string">"46b9b0ea42617276eb5dc975abb489954a306c67fbec3586df75432dfc0e34ea"</span>,
        <span class="token string">"Created"</span><span class="token keyword">:</span> <span class="token string">"2020-11-23T03:13:48.143980583Z"</span>,
        <span class="token string">"Path"</span><span class="token keyword">:</span> <span class="token string">"/bin/sh"</span>,
        <span class="token string">"Args"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
            <span class="token string">"-c"</span>,
            <span class="token string">"while true;do echo lskj;sleep 1;done"</span>
        <span class="token punctuation">]</span>,
        <span class="token string">"State"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Status"</span><span class="token keyword">:</span> <span class="token string">"running"</span>,
            <span class="token string">"Running"</span><span class="token keyword">:</span> true,
            <span class="token string">"Paused"</span><span class="token keyword">:</span> false,
            <span class="token string">"Restarting"</span><span class="token keyword">:</span> false,
            <span class="token string">"OOMKilled"</span><span class="token keyword">:</span> false,
            <span class="token string">"Dead"</span><span class="token keyword">:</span> false,
            <span class="token string">"Pid"</span><span class="token keyword">:</span> 14814,
            <span class="token string">"ExitCode"</span><span class="token keyword">:</span> 0,
            <span class="token string">"Error"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"StartedAt"</span><span class="token keyword">:</span> <span class="token string">"2020-11-23T03:13:48.42067532Z"</span>,
            <span class="token string">"FinishedAt"</span><span class="token keyword">:</span> <span class="token string">"0001-01-01T00:00:00Z"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Image"</span><span class="token keyword">:</span> <span class="token string">"sha256:0d120b6ccaa8c5e149176798b3501d4dd1885f961922497cd0abef155c869566"</span>,
        <span class="token string">"ResolvConfPath"</span><span class="token keyword">:</span> <span class="token string">"/var/lib/docker/containers/46b9b0ea42617276eb5dc975abb489954a306c67fbec3586df75432dfc0e34ea/resolv.conf"</span>,
        <span class="token string">"HostnamePath"</span><span class="token keyword">:</span> <span class="token string">"/var/lib/docker/containers/46b9b0ea42617276eb5dc975abb489954a306c67fbec3586df75432dfc0e34ea/hostname"</span>,
        <span class="token string">"HostsPath"</span><span class="token keyword">:</span> <span class="token string">"/var/lib/docker/containers/46b9b0ea42617276eb5dc975abb489954a306c67fbec3586df75432dfc0e34ea/hosts"</span>,
        <span class="token string">"LogPath"</span><span class="token keyword">:</span> <span class="token string">"/var/lib/docker/containers/46b9b0ea42617276eb5dc975abb489954a306c67fbec3586df75432dfc0e34ea/46b9b0ea42617276eb5dc975abb489954a306c67fbec3586df75432dfc0e34ea-json.log"</span>,
        <span class="token string">"Name"</span><span class="token keyword">:</span> <span class="token string">"/kind_lamport"</span>,
        <span class="token string">"RestartCount"</span><span class="token keyword">:</span> 0,
        <span class="token string">"Driver"</span><span class="token keyword">:</span> <span class="token string">"overlay2"</span>,
        <span class="token string">"Platform"</span><span class="token keyword">:</span> <span class="token string">"linux"</span>,
        <span class="token string">"MountLabel"</span><span class="token keyword">:</span> <span class="token string">""</span>,
        <span class="token string">"ProcessLabel"</span><span class="token keyword">:</span> <span class="token string">""</span>,
        <span class="token string">"AppArmorProfile"</span><span class="token keyword">:</span> <span class="token string">""</span>,
        <span class="token string">"ExecIDs"</span><span class="token keyword">:</span> null,
        <span class="token string">"HostConfig"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Binds"</span><span class="token keyword">:</span> null,
            <span class="token string">"ContainerIDFile"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"LogConfig"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"Type"</span><span class="token keyword">:</span> <span class="token string">"json-file"</span>,
                <span class="token string">"Config"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"NetworkMode"</span><span class="token keyword">:</span> <span class="token string">"default"</span>,
            <span class="token string">"PortBindings"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">"RestartPolicy"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"Name"</span><span class="token keyword">:</span> <span class="token string">"no"</span>,
                <span class="token string">"MaximumRetryCount"</span><span class="token keyword">:</span> 0
            <span class="token punctuation">}</span>,
            <span class="token string">"AutoRemove"</span><span class="token keyword">:</span> false,
            <span class="token string">"VolumeDriver"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"VolumesFrom"</span><span class="token keyword">:</span> null,
            <span class="token string">"CapAdd"</span><span class="token keyword">:</span> null,
            <span class="token string">"CapDrop"</span><span class="token keyword">:</span> null,
            <span class="token string">"Capabilities"</span><span class="token keyword">:</span> null,
            <span class="token string">"Dns"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"DnsOptions"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"DnsSearch"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"ExtraHosts"</span><span class="token keyword">:</span> null,
            <span class="token string">"GroupAdd"</span><span class="token keyword">:</span> null,
            <span class="token string">"IpcMode"</span><span class="token keyword">:</span> <span class="token string">"private"</span>,
            <span class="token string">"Cgroup"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"Links"</span><span class="token keyword">:</span> null,
            <span class="token string">"OomScoreAdj"</span><span class="token keyword">:</span> 0,
            <span class="token string">"PidMode"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"Privileged"</span><span class="token keyword">:</span> false,
            <span class="token string">"PublishAllPorts"</span><span class="token keyword">:</span> false,
            <span class="token string">"ReadonlyRootfs"</span><span class="token keyword">:</span> false,
            <span class="token string">"SecurityOpt"</span><span class="token keyword">:</span> null,
            <span class="token string">"UTSMode"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"UsernsMode"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"ShmSize"</span><span class="token keyword">:</span> 67108864,
            <span class="token string">"Runtime"</span><span class="token keyword">:</span> <span class="token string">"runc"</span>,
            <span class="token string">"ConsoleSize"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                0,
                0
            <span class="token punctuation">]</span>,
            <span class="token string">"Isolation"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"CpuShares"</span><span class="token keyword">:</span> 0,
            <span class="token string">"Memory"</span><span class="token keyword">:</span> 0,
            <span class="token string">"NanoCpus"</span><span class="token keyword">:</span> 0,
            <span class="token string">"CgroupParent"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"BlkioWeight"</span><span class="token keyword">:</span> 0,
            <span class="token string">"BlkioWeightDevice"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"BlkioDeviceReadBps"</span><span class="token keyword">:</span> null,
            <span class="token string">"BlkioDeviceWriteBps"</span><span class="token keyword">:</span> null,
            <span class="token string">"BlkioDeviceReadIOps"</span><span class="token keyword">:</span> null,
            <span class="token string">"BlkioDeviceWriteIOps"</span><span class="token keyword">:</span> null,
            <span class="token string">"CpuPeriod"</span><span class="token keyword">:</span> 0,
            <span class="token string">"CpuQuota"</span><span class="token keyword">:</span> 0,
            <span class="token string">"CpuRealtimePeriod"</span><span class="token keyword">:</span> 0,
            <span class="token string">"CpuRealtimeRuntime"</span><span class="token keyword">:</span> 0,
            <span class="token string">"CpusetCpus"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"CpusetMems"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"Devices"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"DeviceCgroupRules"</span><span class="token keyword">:</span> null,
            <span class="token string">"DeviceRequests"</span><span class="token keyword">:</span> null,
            <span class="token string">"KernelMemory"</span><span class="token keyword">:</span> 0,
            <span class="token string">"KernelMemoryTCP"</span><span class="token keyword">:</span> 0,
            <span class="token string">"MemoryReservation"</span><span class="token keyword">:</span> 0,
            <span class="token string">"MemorySwap"</span><span class="token keyword">:</span> 0,
            <span class="token string">"MemorySwappiness"</span><span class="token keyword">:</span> null,
            <span class="token string">"OomKillDisable"</span><span class="token keyword">:</span> false,
            <span class="token string">"PidsLimit"</span><span class="token keyword">:</span> null,
            <span class="token string">"Ulimits"</span><span class="token keyword">:</span> null,
            <span class="token string">"CpuCount"</span><span class="token keyword">:</span> 0,
            <span class="token string">"CpuPercent"</span><span class="token keyword">:</span> 0,
            <span class="token string">"IOMaximumIOps"</span><span class="token keyword">:</span> 0,
            <span class="token string">"IOMaximumBandwidth"</span><span class="token keyword">:</span> 0,
            <span class="token string">"MaskedPaths"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token string">"/proc/asound"</span>,
                <span class="token string">"/proc/acpi"</span>,
                <span class="token string">"/proc/kcore"</span>,
                <span class="token string">"/proc/keys"</span>,
                <span class="token string">"/proc/latency_stats"</span>,
                <span class="token string">"/proc/timer_list"</span>,
                <span class="token string">"/proc/timer_stats"</span>,
                <span class="token string">"/proc/sched_debug"</span>,
                <span class="token string">"/proc/scsi"</span>,
                <span class="token string">"/sys/firmware"</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"ReadonlyPaths"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token string">"/proc/bus"</span>,
                <span class="token string">"/proc/fs"</span>,
                <span class="token string">"/proc/irq"</span>,
                <span class="token string">"/proc/sys"</span>,
                <span class="token string">"/proc/sysrq-trigger"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"GraphDriver"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Data"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"LowerDir"</span><span class="token keyword">:</span> <span class="token string">"/var/lib/docker/overlay2/5542d30147b91dcdb6a661d83c96e557e7bf718a2c0a25443fa410ba32391675-init/diff:/var/lib/docker/overlay2/06551e2d5cbd37fe1dd01d044c604d63c25a5e5b00ff1e9dcd22cd5b273f1e81/diff"</span>,
                <span class="token string">"MergedDir"</span><span class="token keyword">:</span> <span class="token string">"/var/lib/docker/overlay2/5542d30147b91dcdb6a661d83c96e557e7bf718a2c0a25443fa410ba32391675/merged"</span>,
                <span class="token string">"UpperDir"</span><span class="token keyword">:</span> <span class="token string">"/var/lib/docker/overlay2/5542d30147b91dcdb6a661d83c96e557e7bf718a2c0a25443fa410ba32391675/diff"</span>,
                <span class="token string">"WorkDir"</span><span class="token keyword">:</span> <span class="token string">"/var/lib/docker/overlay2/5542d30147b91dcdb6a661d83c96e557e7bf718a2c0a25443fa410ba32391675/work"</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"Name"</span><span class="token keyword">:</span> <span class="token string">"overlay2"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Mounts"</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"Config"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Hostname"</span><span class="token keyword">:</span> <span class="token string">"46b9b0ea4261"</span>,
            <span class="token string">"Domainname"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"User"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"AttachStdin"</span><span class="token keyword">:</span> false,
            <span class="token string">"AttachStdout"</span><span class="token keyword">:</span> false,
            <span class="token string">"AttachStderr"</span><span class="token keyword">:</span> false,
            <span class="token string">"Tty"</span><span class="token keyword">:</span> false,
            <span class="token string">"OpenStdin"</span><span class="token keyword">:</span> false,
            <span class="token string">"StdinOnce"</span><span class="token keyword">:</span> false,
            <span class="token string">"Env"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"Cmd"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token string">"/bin/sh"</span>,
                <span class="token string">"-c"</span>,
                <span class="token string">"while true;do echo lskj;sleep 1;done"</span>
            <span class="token punctuation">]</span>,
            <span class="token string">"Image"</span><span class="token keyword">:</span> <span class="token string">"centos"</span>,
            <span class="token string">"Volumes"</span><span class="token keyword">:</span> null,
            <span class="token string">"WorkingDir"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"Entrypoint"</span><span class="token keyword">:</span> null,
            <span class="token string">"OnBuild"</span><span class="token keyword">:</span> null,
            <span class="token string">"Labels"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"org.label-schema.build-date"</span><span class="token keyword">:</span> <span class="token string">"20200809"</span>,
                <span class="token string">"org.label-schema.license"</span><span class="token keyword">:</span> <span class="token string">"GPLv2"</span>,
                <span class="token string">"org.label-schema.name"</span><span class="token keyword">:</span> <span class="token string">"CentOS Base Image"</span>,
                <span class="token string">"org.label-schema.schema-version"</span><span class="token keyword">:</span> <span class="token string">"1.0"</span>,
                <span class="token string">"org.label-schema.vendor"</span><span class="token keyword">:</span> <span class="token string">"CentOS"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"NetworkSettings"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Bridge"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"SandboxID"</span><span class="token keyword">:</span> <span class="token string">"bf7877c7d65c141262144d36f8f84055335dee25ee1202450f8a42f8d46985a9"</span>,
            <span class="token string">"HairpinMode"</span><span class="token keyword">:</span> false,
            <span class="token string">"LinkLocalIPv6Address"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"LinkLocalIPv6PrefixLen"</span><span class="token keyword">:</span> 0,
            <span class="token string">"Ports"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">"SandboxKey"</span><span class="token keyword">:</span> <span class="token string">"/var/run/docker/netns/bf7877c7d65c"</span>,
            <span class="token string">"SecondaryIPAddresses"</span><span class="token keyword">:</span> null,
            <span class="token string">"SecondaryIPv6Addresses"</span><span class="token keyword">:</span> null,
            <span class="token string">"EndpointID"</span><span class="token keyword">:</span> <span class="token string">"660ee337634eb908d4ebe5ad0442b0a9c7a5103ce749b842f6fe4837c869c899"</span>,
            <span class="token string">"Gateway"</span><span class="token keyword">:</span> <span class="token string">"172.17.0.1"</span>,
            <span class="token string">"GlobalIPv6Address"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"GlobalIPv6PrefixLen"</span><span class="token keyword">:</span> 0,
            <span class="token string">"IPAddress"</span><span class="token keyword">:</span> <span class="token string">"172.17.0.2"</span>,
            <span class="token string">"IPPrefixLen"</span><span class="token keyword">:</span> 16,
            <span class="token string">"IPv6Gateway"</span><span class="token keyword">:</span> <span class="token string">""</span>,
            <span class="token string">"MacAddress"</span><span class="token keyword">:</span> <span class="token string">"02:42:ac:11:00:02"</span>,
            <span class="token string">"Networks"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"bridge"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
                    <span class="token string">"IPAMConfig"</span><span class="token keyword">:</span> null,
                    <span class="token string">"Links"</span><span class="token keyword">:</span> null,
                    <span class="token string">"Aliases"</span><span class="token keyword">:</span> null,
                    <span class="token string">"NetworkID"</span><span class="token keyword">:</span> <span class="token string">"ee56590e65cf6f8e71efb6c797a16174e72e5696f5bd1f76ecf32a387f69864e"</span>,
                    <span class="token string">"EndpointID"</span><span class="token keyword">:</span> <span class="token string">"660ee337634eb908d4ebe5ad0442b0a9c7a5103ce749b842f6fe4837c869c899"</span>,
                    <span class="token string">"Gateway"</span><span class="token keyword">:</span> <span class="token string">"172.17.0.1"</span>,
                    <span class="token string">"IPAddress"</span><span class="token keyword">:</span> <span class="token string">"172.17.0.2"</span>,
                    <span class="token string">"IPPrefixLen"</span><span class="token keyword">:</span> 16,
                    <span class="token string">"IPv6Gateway"</span><span class="token keyword">:</span> <span class="token string">""</span>,
                    <span class="token string">"GlobalIPv6Address"</span><span class="token keyword">:</span> <span class="token string">""</span>,
                    <span class="token string">"GlobalIPv6PrefixLen"</span><span class="token keyword">:</span> 0,
                    <span class="token string">"MacAddress"</span><span class="token keyword">:</span> <span class="token string">"02:42:ac:11:00:02"</span>,
                    <span class="token string">"DriverOpts"</span><span class="token keyword">:</span> null
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<h3 id="进入当前正在运行的容器"><a href="#进入当前正在运行的容器" class="headerlink" title="进入当前正在运行的容器"></a>进入当前正在运行的容器</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 通常容器都是使用后台方式运行的，需要进入容器，修改一些配置</span>

<span class="token comment" spellcheck="true">#命令：docker exec -it 容器id bash/shell</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
46b9b0ea4261        centos              <span class="token string">"/bin/sh -c 'while t…"</span>   14 minutes ago      Up 14 minutes                           kind_lamport
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it 46b9b0ea4261 /bin/bash</span>
<span class="token punctuation">[</span>root@46b9b0ea4261 /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="token punctuation">[</span>root@46b9b0ea4261 /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ps -ef</span>
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 03:13 ?        00:00:00 /bin/sh -c <span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">do</span> <span class="token keyword">echo</span> lskj<span class="token punctuation">;</span><span class="token function">sleep</span> 1<span class="token punctuation">;</span><span class="token keyword">done</span>
root       891     0  0 03:28 pts/0    00:00:00 /bin/bash
root       957     1  0 03:29 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang<span class="token operator">=</span>sleep /usr/bin/sleep 1
root       958   891  0 03:29 pts/0    00:00:00 <span class="token function">ps</span> -ef
<span class="token punctuation">[</span>root@46b9b0ea4261 /<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>

<span class="token comment" spellcheck="true">#方式二：docker attach 容器id</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker attach 46b9b0ea4261</span>
正在执行当前的代码（上面编写的shell脚本，执行是一个死循环），此时使用快捷键之类的无法退出，可复制会话，杀死docker attach进程。
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># pkill -9 -f 'docker.*attach'</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<p><code>docker exec</code>进入容器后，开启一个新的终端，可以在里面操作（常用）。</p>
<p><code>docker attach</code>进入容器正在执行的终端，不会启动新的进程。</p>
<h3 id="从容器内拷贝文件到主机上"><a href="#从容器内拷贝文件到主机上" class="headerlink" title="从容器内拷贝文件到主机上"></a>从容器内拷贝文件到主机上</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#命令：docker cp 容器id:容器内路径 目的地主机路径</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -it centos /bin/bash</span>
<span class="token punctuation">[</span>root@2510245c778d /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># [root@lskj /]# docker ps</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
2510245c778d        centos              <span class="token string">"/bin/bash"</span>         11 seconds ago      Up 11 seconds                           musing_kilby
<span class="token comment" spellcheck="true">#查看当前主机home目录下的文件</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /home</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
<span class="token comment" spellcheck="true">#进入docker容器内部</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker attach 2510245c778d</span>
<span class="token punctuation">[</span>root@2510245c778d /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
<span class="token punctuation">[</span>root@2510245c778d /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /home/</span>
<span class="token punctuation">[</span>root@2510245c778d home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
<span class="token comment" spellcheck="true">#在容器home目录下创建一个test文件</span>
<span class="token punctuation">[</span>root@2510245c778d home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># touch test</span>
<span class="token punctuation">[</span>root@2510245c778d home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
<span class="token function">test</span>
<span class="token punctuation">[</span>root@2510245c778d home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># exit</span>
<span class="token keyword">exit</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
<span class="token comment" spellcheck="true">#将文件拷贝到主机上</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker cp 2510245c778d:/home/test /home</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
<span class="token function">test</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<h1 id="四、部署nginx"><a href="#四、部署nginx" class="headerlink" title="四、部署nginx"></a>四、部署nginx</h1><p>1、搜索镜像。（可以在dockerhub搜索查看）</p>
<pre class=" language-bash"><code class="language-bash">docker search nginx</code></pre>
<p>2、下载镜像。</p>
<pre class=" language-bash"><code class="language-bash">docker pull nginx</code></pre>
<p>3、运行测试。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># -d 后台运行  --name 给容器命名  -p 宿主机端口:容器内部端口</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d --name nginxTest -p 8080:80 nginx</span>
8e01d8de2d93004ec187abfdac32c7ea41ed1fb55a825a554e9796d0fd9b48ca
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
8e01d8de2d93        nginx               <span class="token string">"/docker-entrypoint.…"</span>   38 seconds ago      Up 38 seconds       0.0.0.0:8080-<span class="token operator">></span>80/tcp   nginxTest
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># curl localhost:8080</span></code></pre>
<p>4、进入容器。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it nginxTest /bin/bash</span>
root@8e01d8de2d93:/<span class="token comment" spellcheck="true"># cd /etc/nginx</span>
root@8e01d8de2d93:/etc/nginx<span class="token comment" spellcheck="true"># ls</span>
conf.d    fastcgi_params    koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params    uwsgi_params  win-utf
root@8e01d8de2d93:/etc/nginx<span class="token comment" spellcheck="true">#</span></code></pre>
<p><img src="/archives/4a3d459a/image-20201123134134613.png" alt=""></p>
<h1 id="五、部署Tomact"><a href="#五、部署Tomact" class="headerlink" title="五、部署Tomact"></a>五、部署Tomact</h1><p>官方的使用，一般用来测试，用完即删除。</p>
<pre class=" language-bash"><code class="language-bash">docker run -it --rm tomcat:9.0</code></pre>
<p>1、下载。</p>
<pre class=" language-bash"><code class="language-bash">docker pull tomcat:9.0
<span class="token comment" spellcheck="true">#最新版下载</span>
docker pull tomcat</code></pre>
<p>2、启动。</p>
<pre class=" language-bash"><code class="language-bash">docker run -d -p 80:8080 --name tomcatTest tomcat</code></pre>
<p>3、进入容器。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcatTest /bin/bash</span>
root@d08553edb696:/usr/local/tomcat<span class="token comment" spellcheck="true"># ls -la</span>
total 176
drwxr-xr-x 1 root root  4096 Nov 19 06:16 <span class="token keyword">.</span>
drwxr-xr-x 1 root root  4096 Nov 19 06:12 <span class="token punctuation">..</span>
-rw-r--r-- 1 root root 18982 Nov 12 15:41 BUILDING.txt
-rw-r--r-- 1 root root  5409 Nov 12 15:41 CONTRIBUTING.md
-rw-r--r-- 1 root root 57092 Nov 12 15:41 LICENSE
-rw-r--r-- 1 root root  2333 Nov 12 15:41 NOTICE
-rw-r--r-- 1 root root  3257 Nov 12 15:41 README.md
-rw-r--r-- 1 root root  6898 Nov 12 15:41 RELEASE-NOTES
-rw-r--r-- 1 root root 16507 Nov 12 15:41 RUNNING.txt
drwxr-xr-x 2 root root  4096 Nov 19 06:16 bin
drwxr-xr-x 1 root root  4096 Nov 23 06:02 conf
drwxr-xr-x 2 root root  4096 Nov 19 06:16 lib
drwxrwxrwx 1 root root  4096 Nov 23 06:02 logs
drwxr-xr-x 2 root root  4096 Nov 19 06:16 native-jni-lib
drwxrwxrwx 2 root root  4096 Nov 19 06:16 temp
drwxr-xr-x 2 root root  4096 Nov 19 06:16 webapps
drwxr-xr-x 7 root root  4096 Nov 12 15:38 webapps.dist
drwxrwxrwx 2 root root  4096 Nov 12 15:35 work
root@d08553edb696:/usr/local/tomcat<span class="token comment" spellcheck="true"># cd webapps</span>
root@d08553edb696:/usr/local/tomcat/webapps<span class="token comment" spellcheck="true"># ls</span>
root@d08553edb696:/usr/local/tomcat/webapps<span class="token comment" spellcheck="true"># </span></code></pre>
<p>此时，发现Linux命令少了，也没有webapps。这是因为阿里云镜像的原因，默认是最小的镜像，所有不必要的都删除掉了，保证最小可运行的环境。（现在外网访问会报404，若需要，可执行命令<code>cp -r webapps.dist/* webapps</code>将webapps.dist下的文件复制到webapps下，即可正常访问）</p>
<h1 id="六、部署ES"><a href="#六、部署ES" class="headerlink" title="六、部署ES"></a>六、部署ES</h1><p>ES（elastic search）暴露的端口很多，十分耗内存。</p>
<p>ES的数据一般需要放置到安全目录，挂载。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># --net somnetwork 网络配置</span>
docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e <span class="token string">"discovery.type=single-node"</span> elasticsearch:tag

<span class="token comment" spellcheck="true">#下载启动elasticsearch</span>
docker run -d --name elasticsearch  -p 9200:9200 -p 9300:9300 -e <span class="token string">"discovery.type=single-node"</span> elasticsearch:7.6.2
<span class="token comment" spellcheck="true">#启动之后，Linux可能会卡 docker stats查看CPU的状态</span>
docker stats

<span class="token comment" spellcheck="true">#测试一下es是否成功</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># curl localhost:9200</span>
<span class="token punctuation">{</span>
  <span class="token string">"name"</span> <span class="token keyword">:</span> <span class="token string">"7fa5c06dc5df"</span>,
  <span class="token string">"cluster_name"</span> <span class="token keyword">:</span> <span class="token string">"docker-cluster"</span>,
  <span class="token string">"cluster_uuid"</span> <span class="token keyword">:</span> <span class="token string">"DecIaQ03RmG_gGib0baOWg"</span>,
  <span class="token string">"version"</span> <span class="token keyword">:</span> <span class="token punctuation">{</span>
    <span class="token string">"number"</span> <span class="token keyword">:</span> <span class="token string">"7.6.2"</span>,
    <span class="token string">"build_flavor"</span> <span class="token keyword">:</span> <span class="token string">"default"</span>,
    <span class="token string">"build_type"</span> <span class="token keyword">:</span> <span class="token string">"docker"</span>,
    <span class="token string">"build_hash"</span> <span class="token keyword">:</span> <span class="token string">"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"</span>,
    <span class="token string">"build_date"</span> <span class="token keyword">:</span> <span class="token string">"2020-03-26T06:34:37.794943Z"</span>,
    <span class="token string">"build_snapshot"</span> <span class="token keyword">:</span> false,
    <span class="token string">"lucene_version"</span> <span class="token keyword">:</span> <span class="token string">"8.4.0"</span>,
    <span class="token string">"minimum_wire_compatibility_version"</span> <span class="token keyword">:</span> <span class="token string">"6.8.0"</span>,
    <span class="token string">"minimum_index_compatibility_version"</span> <span class="token keyword">:</span> <span class="token string">"6.0.0-beta1"</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"tagline"</span> <span class="token keyword">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>

<span class="token comment" spellcheck="true">#关闭es，增加内存限制</span>
<span class="token comment" spellcheck="true">#修改配置文件，-e环境配置修改</span>
docker run -d --name elasticsearchTest  -p 9200:9200 -p 9300:9300 -e <span class="token string">"discovery.type=single-node"</span> -e ES_JAVA_OPTS<span class="token operator">=</span><span class="token string">"-Xms64m -Xmx512m"</span> elasticsearch:7.6.2</code></pre>
<p>使用Kibana连接ES</p>
<blockquote>
<p>可视化</p>
</blockquote>
<p><strong>portainer</strong></p>
<p>Docker图形化界面管理工具。提供一个后台面板。</p>
<pre class=" language-bash"><code class="language-bash">docker run -d -p 8080:9000 \
--restart<span class="token operator">=</span>always -v /var/run/docker.sock:/var/run/docker.sock --privileged<span class="token operator">=</span>true portainer/portainer</code></pre>
<p>访问测试：<a href="http://ip:8080/" target="_blank" rel="noopener">http://ip:8080/</a></p>
<p><strong>Rancher(CI/CD再用)</strong></p>
<h1 id="七、Docker镜像"><a href="#七、Docker镜像" class="headerlink" title="七、Docker镜像"></a>七、Docker镜像</h1><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<p>所有的应用，直接打包docker镜像，就可以直接跑起来了。</p>
<p><strong>怎样得到镜像？</strong></p>
<ul>
<li>从远程仓库下载</li>
<li>拷贝</li>
<li>制作镜像DockerFile</li>
</ul>
<h2 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h2><blockquote>
<p>UnionFS（联合文件系统）</p>
</blockquote>
<p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（unite several directories into a single virtual filesystem）。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>docker的镜像实际上由一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p>bootfs（boot file system）主要包含BootLoader和kernel，BootLoader主要是引导加兹安kernel，Linux刚启动时就会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与典型的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p>rootfs（root file system），在bootfs之上。包含的是典型Linux系统中的/dev，/proc，/bin，/etc等标椎目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等。</p>
<p><strong>在VMware中使用的CentOS是都是几个G，为什么Docker里只有几百M？</strong></p>
<p>对于一个精简的OS，rootfs可以很小，只需要包含最基本的命令，工具和程序就可以了，因为底层直接用Host的kernel，自已只需要提供rootfs就可以了。由此可见对于不同的Linux发行版，bootfs基本是一致的，rootfs会有差别，因此不同的发行版可以公用bootfs。</p>
<p>虚拟机是分钟级别，容器是秒级。</p>
<h2 id="分层理解"><a href="#分层理解" class="headerlink" title="分层理解"></a>分层理解</h2><p>下载一个镜像时，从下载日志可以看出是一层一层地下载。</p>
<p>所有的Docker镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之上，创建新的镜像层。</p>
<p>例如，基于Ubuntu 16.04创建一个新的镜像，这就是新镜像的第一层。如果在该镜像中添加Python包，就会在基础镜像层之上创建第二个镜像层。如果继续添加一个安全补丁，就会创建第三个镜像层。</p>
<p><img src="/archives/4a3d459a/image-20201124212140945.png" alt=""></p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合。例如，每个镜像层包含三个文件，而镜像包含了来自两个镜像层的6个文件。</p>
<p><img src="/archives/4a3d459a/image-20201124212658838.png" alt=""></p>
<p>下图在外部看来整个镜像只有6个文件，这是因为最上层中的文件7是文件5的一个更新版。</p>
<p><img src="/archives/4a3d459a/image-20201124213615580.png" alt=""></p>
<p>这种情况下，上层镜像中的文件会覆盖了底层镜像中的文件。这样就使得文件的更新版作为一个新镜像层添加到镜像当中。</p>
<p>Docker通过存储引擎（新版本采用快照集中）的方式来实现镜像层堆栈，并保证多镜像层对外展示位统一的文件系统。</p>
<p>Linux上可用的存储引擎有AUFS、Overlay2、Device Mapper、Btrfs以及ZFS。顾名思义，每种存储引擎都基于Linux中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</p>
<p>Docker在Windows上仅支持windowsfilter一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW。</p>
<p>下图展示了与该系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。</p>
<p><img src="/archives/4a3d459a/image-20201124214736118.png" alt=""></p>
<blockquote>
<p>特点</p>
</blockquote>
<p>Docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部。</p>
<p>这一层就是通常所说的容器层，容器之下的都叫镜像层。</p>
<p><img src="/archives/4a3d459a/image-20201124215715343.png" alt=""></p>
<h2 id="commit镜像"><a href="#commit镜像" class="headerlink" title="commit镜像"></a>commit镜像</h2><pre class=" language-bash"><code class="language-bash">docker commit 提交容器成为一个新的副本

docker commit -m<span class="token operator">=</span><span class="token string">"提交的描述信息"</span> -a<span class="token operator">=</span><span class="token string">"作者"</span> 容器id 目标镜像名:<span class="token punctuation">[</span>TAG<span class="token punctuation">]</span></code></pre>
<blockquote>
<p>测试</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#启动一个默认的Tomcat</span>
docker run -it -p 8080:8080 tomcat
<span class="token comment" spellcheck="true">#默认的Tomcat没有webapps应用，需拷贝webapps.dist下的文件到webapps</span>
docker <span class="token function">exec</span> -it tomcatTest /bin/bash
<span class="token function">cd</span> webapps
<span class="token function">ls</span>
<span class="token function">cd</span> <span class="token punctuation">..</span>
<span class="token function">cp</span> -r webapps.dist/* webapps</code></pre>
<p>将操作过的容器通过commit提交为一个镜像tomcat02，后续使用修改过的镜像即可，这就是自定义修改的镜像。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker ps</span>
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                    NAMES
caa0c361cd59        tomcat              <span class="token string">"catalina.sh run"</span>   7 minutes ago       Up 7 minutes        0.0.0.0:8080-<span class="token operator">></span>8080/tcp   jovial_chebyshev
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker commit -a="lskj" -m="add webapps app" caa0c361cd59 tomcatTest:1.0</span>
invalid reference format: repository name must be lowercase
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker commit -a="lskj" -m="add webapps app" caa0c361cd59 tomcat02:1.0</span>
sha256:963f5b061d831efcf953d3252b13cd82bb28c2581f25593117c22830f2c19fc8
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker images</span>
REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
tomcat02              1.0                 963f5b061d83        8 seconds ago       654MB
tomcat                9.0                 e0bd8b34b4ea        5 days ago          649MB
tomcat                latest              e0bd8b34b4ea        5 days ago          649MB
redis                 latest              74d107221092        6 days ago          104MB
nginx                 latest              daee903b4e43        6 days ago          133MB
centos                latest              0d120b6ccaa8        3 months ago        215MB
portainer/portainer   latest              62771b0b9b09        4 months ago        79.1MB
elasticsearch         7.6.2               f29a1ee41030        8 months ago        791MB
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<h1 id="八、容器数据卷"><a href="#八、容器数据卷" class="headerlink" title="八、容器数据卷"></a>八、容器数据卷</h1><p>docker将应用和环境打包成一个镜像，如果数据都在容器中，容器被删除，数据就会丢失。希望mysql数据可以存储咋本地。</p>
<p>容器之间可以有一个数据共享的技术，Docker容器产生的数据，同步到本地。</p>
<p>这就是卷技术。也就是目录的挂载，将容器内的目录，挂载到Linux上。</p>
<p><strong>容器的持久化和同步操作。容器间也是可以数据共享的。</strong></p>
<h2 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h2><blockquote>
<p>方式一：直接使用命令来挂载 -v</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">docker run -it -v 主机目录:容器内目录</code></pre>
<p><strong>测试：</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -it -v /home/test:/home/ centos /bin/bash</span>
<span class="token punctuation">[</span>root@e8fd1fc54022 /<span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">#启动之后，复制会话，通过docker inspect 容器id 查看容器详细信息</span>
<span class="token punctuation">[</span>root@lskj test<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker inspect e8fd1fc54022</span>
<span class="token punctuation">..</span>.
        <span class="token string">"Mounts"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>  <span class="token comment" spellcheck="true">#挂载 -v 卷</span>
            <span class="token punctuation">{</span>
                <span class="token string">"Type"</span><span class="token keyword">:</span> <span class="token string">"bind"</span>,
                <span class="token string">"Source"</span><span class="token keyword">:</span> <span class="token string">"/home/test"</span>,  <span class="token comment" spellcheck="true">#主机内地址</span>
                <span class="token string">"Destination"</span><span class="token keyword">:</span> <span class="token string">"/home"</span>,  <span class="token comment" spellcheck="true">#docker容器内的地址</span>
                <span class="token string">"Mode"</span><span class="token keyword">:</span> <span class="token string">""</span>,
                <span class="token string">"RW"</span><span class="token keyword">:</span> true,
                <span class="token string">"Propagation"</span><span class="token keyword">:</span> <span class="token string">"rprivate"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,

<span class="token punctuation">..</span>.</code></pre>
<p>测试文件的同步：</p>
<p><img src="/archives/4a3d459a/image-20201124224333277.png" alt=""></p>
<p>1、停止容器</p>
<p>2、宿主机上修改文件</p>
<p>3、启动容器</p>
<p>4、容器内的数据依旧是同步的</p>
<p><img src="/archives/4a3d459a/image-20201124224921146.png" alt=""></p>
<p>以后修改只需要在本地修改即可，容器内会自动同步。</p>
<h2 id="安装Mysql"><a href="#安装Mysql" class="headerlink" title="安装Mysql"></a>安装Mysql</h2><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#获取镜像</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker pull mysql:5.7</span>

<span class="token comment" spellcheck="true">#运行容器，需要做数据挂载。 安装启动mysql，需要配置密码</span>
<span class="token comment" spellcheck="true"># -d 后台运行</span>
<span class="token comment" spellcheck="true"># -p 端口映射</span>
<span class="token comment" spellcheck="true"># -v 卷挂载</span>
<span class="token comment" spellcheck="true"># -e 环境配置</span>
<span class="token comment" spellcheck="true"># --name 容器名字</span>
<span class="token comment" spellcheck="true">#官方测试：docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -p 8080:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root --name mysql01 mysql:5.7</span>
d150915a1b29d8c4a4999f1fae84bcc6b1b618835e0515f410b49abd22f17360

<span class="token comment" spellcheck="true">#启动成功后，可在本地测试连接</span>
mysql -h 公网ip -uroot -P 8080 -proot
<span class="token comment" spellcheck="true">#本地创建数据库</span>
mysql<span class="token operator">></span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sys                <span class="token operator">|</span>
+--------------------+
4 rows <span class="token keyword">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span>0.05 sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span> create database <span class="token function">test</span><span class="token punctuation">;</span>
Query OK, 1 row affected <span class="token punctuation">(</span>0.05 sec<span class="token punctuation">)</span>

mysql<span class="token operator">></span></code></pre>
<p>Linux查看映射的路径：</p>
<p><img src="/archives/4a3d459a/image-20201125091109521.png" alt=""></p>
<p>将容器删除，挂载到本地的数据卷依旧没有丢失，这就实现了容器数据持久化功能。</p>
<p><img src="/archives/4a3d459a/image-20201125091537176.png" alt=""></p>
<h2 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h2><p><strong>匿名挂载：</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#匿名挂载</span>
-v 容器内路径
docker run -d -P --name nginx01 -v /etc/nginx nginx

<span class="token comment" spellcheck="true">#查看所有卷的情况</span>
docker volume <span class="token function">ls</span>

<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker volume ls</span>
DRIVER              VOLUME NAME
local               2b50e0b7719627983833949e6c713f88d3375ab6ddc83da773e2193e1a1f9b08
local               2bd8935c5fea24f21bef8438c10d769dd4c02edf3481724e1c8cb5e2669582e1
local               d3d6b7d6d26a670e30e9c97b0dcaed03212b148427e9468cbc07a39246cdb3b2
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true">#这里的这种就是匿名挂载，因为在-v时只写了容器内的路径，没有写容器外的路径</span></code></pre>
<p><strong>具名挂载：</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -P --name nginx02 -v test-nginx:/etc/nginx nginx</span>
f4d7f0da4443ca8d724d709055bb502cdf189e87b5f120a1b944c21b4d4e6457
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker volume ls</span>
DRIVER              VOLUME NAME
local               2b50e0b7719627983833949e6c713f88d3375ab6ddc83da773e2193e1a1f9b08
local               2bd8935c5fea24f21bef8438c10d769dd4c02edf3481724e1c8cb5e2669582e1
local               d3d6b7d6d26a670e30e9c97b0dcaed03212b148427e9468cbc07a39246cdb3b2
local               test-nginx
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<p>通过<code>-v 卷名:容器内路径</code>。</p>
<p>查看一下这个卷</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker volume inspect test-nginx</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"CreatedAt"</span><span class="token keyword">:</span> <span class="token string">"2020-11-25T10:11:19+08:00"</span>,
        <span class="token string">"Driver"</span><span class="token keyword">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Labels"</span><span class="token keyword">:</span> null,
        <span class="token string">"Mountpoint"</span><span class="token keyword">:</span> <span class="token string">"/var/lib/docker/volumes/test-nginx/_data"</span>,
        <span class="token string">"Name"</span><span class="token keyword">:</span> <span class="token string">"test-nginx"</span>,
        <span class="token string">"Options"</span><span class="token keyword">:</span> null,
        <span class="token string">"Scope"</span><span class="token keyword">:</span> <span class="token string">"local"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<p>所有的docker容器内的卷，没有指定目录的情况下都是在<code>/var/lib/docker/volumes/xxx/_data</code>。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /var/lib/docker/volumes</span>
<span class="token punctuation">[</span>root@lskj volumes<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
2b50e0b7719627983833949e6c713f88d3375ab6ddc83da773e2193e1a1f9b08  metadata.db
2bd8935c5fea24f21bef8438c10d769dd4c02edf3481724e1c8cb5e2669582e1  test-nginx
d3d6b7d6d26a670e30e9c97b0dcaed03212b148427e9468cbc07a39246cdb3b2
<span class="token punctuation">[</span>root@lskj volumes<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd test-nginx/</span>
<span class="token punctuation">[</span>root@lskj test-nginx<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
_data
<span class="token punctuation">[</span>root@lskj test-nginx<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd _data/</span>
<span class="token punctuation">[</span>root@lskj _data<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
conf.d  fastcgi_params  koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params  uwsgi_params  win-utf
<span class="token punctuation">[</span>root@lskj _data<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<p>通过具名挂载可以方便找到一个卷，通常情况下使用的是具名挂载。</p>
<blockquote>
<p>怎样区分是具名挂载、匿名挂载，还是指定路径挂载？</p>
</blockquote>
<ul>
<li><code>-v 容器内路径</code>匿名挂载</li>
<li><code>-v 卷名:容器内路径</code>具名挂载</li>
<li><code>-v /宿主机路径:容器内路径</code>指定路径挂载</li>
</ul>
<blockquote>
<p>拓展</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#通过 -v 容器内路径:ro/rw  改变读写权限</span>
ro：readonly只读
rw：readwrite可读可写

<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -P --name nginx02 -v test-nginx:/etc/nginx:ro nginx</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -P --name nginx02 -v test-nginx:/etc/nginx:rw nginx</span></code></pre>
<p>只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作的。</p>
<h2 id="初始Dockerfile"><a href="#初始Dockerfile" class="headerlink" title="初始Dockerfile"></a>初始Dockerfile</h2><p>Dockerfile就是用来构建docker镜像的构建文件，命令脚本。</p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本就是一个个的命令，每个命令都是一层。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#创建一个dockerfile文件dockerfile01</span>
<span class="token comment" spellcheck="true"># dockerfile01中的内容，指定(大写) 参数</span>
FROM centos
VOLUME <span class="token punctuation">[</span><span class="token string">"volume01"</span>,<span class="token string">"volume02"</span><span class="token punctuation">]</span>

CMD <span class="token keyword">echo</span> <span class="token string">"-----end-----"</span>
CMD /bin/bash
<span class="token comment" spellcheck="true">#这里的每个命令，就是镜像的一层。</span></code></pre>
<p><img src="/archives/4a3d459a/image-20201125105422032.png" alt=""></p>
<p>启动自定义的容器：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj docker-test-volume<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -it f9c2cfe22856 /bin/bash</span>
<span class="token punctuation">[</span>root@1b04e3544ea3 /<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<p><img src="/archives/4a3d459a/image-20201125105910612.png" alt=""></p>
<p>这个卷和外部一定有一个同步的目录。</p>
<p>查看一下挂载的路径：</p>
<p><img src="/archives/4a3d459a/image-20201125131909245.png" alt=""></p>
<p>测试：</p>
<p><img src="/archives/4a3d459a/image-20201125132153059.png" alt=""></p>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><p><img src="/archives/4a3d459a/image-20201125163657034.png" alt=""></p>
<p>启动三个容器，通过上面自定义的镜像启动。</p>
<p><img src="/archives/4a3d459a/image-20201125164134466.png" alt=""></p>
<p><img src="/archives/4a3d459a/image-20201125164901655.png" alt=""></p>
<p><img src="/archives/4a3d459a/image-20201125165325971.png" alt=""></p>
<p>删除docker01，查看docker02和docker03</p>
<p><img src="/archives/4a3d459a/image-20201125165647745.png" alt=""></p>
<p>多个mysql实现数据共享。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -p 8080:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=root --name mysql01 mysql:5.7</span>

<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -p 8080:3306 -e MYSQL_ROOT_PASSWORD=root --name mysql02 --volumes-from mysql01 mysql:5.7</span></code></pre>
<blockquote>
<p>结论：</p>
</blockquote>
<p>容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用为止。</p>
<p>但一旦持久化到本地，本地的数据是不会删除的。</p>
<h1 id="九、DockerFile"><a href="#九、DockerFile" class="headerlink" title="九、DockerFile"></a>九、DockerFile</h1><p>dockerfile是用来构建docker镜像的文件。命令参数脚本。</p>
<p>构建步骤：</p>
<ul>
<li>编写一个dockerfile文件</li>
<li>docker build构建成为一个镜像</li>
<li>docker run运行镜像</li>
<li>docker push发布镜像</li>
</ul>
<h2 id="DockerFile构建过程"><a href="#DockerFile构建过程" class="headerlink" title="DockerFile构建过程"></a>DockerFile构建过程</h2><blockquote>
<p>基础知识</p>
</blockquote>
<p>1、每个保留关键字（指令）都必须是大写字母。</p>
<p>2、执行从上到下顺序执行。</p>
<p>3、<code>#</code>表示注释。</p>
<p>4、每一个指定都会创建提交一个新的镜像层。</p>
<p><img src="/archives/4a3d459a/timg.jpg" alt=""></p>
<p>Dockerfile是面向开发的，以后要发布项目，做镜像，就需要编写Dockerfile文件。</p>
<blockquote>
<p>步骤：开发、部署、运维</p>
</blockquote>
<p>DockerFile：构建文件，定义了一切的步骤，源代码。</p>
<p>DockerImages：通过DockerFile构建生成的镜像，最终发布和运行产品。</p>
<p>Docker容器：容器就是镜像运行起来提供服务。</p>
<h2 id="DockerFile的指令"><a href="#DockerFile的指令" class="headerlink" title="DockerFile的指令"></a>DockerFile的指令</h2><p><code>FROM</code>基础镜像，一切从这里开始构建。（指定基础镜像）</p>
<p><code>MAINTAINER</code>镜像是谁写的，姓名+邮箱（指定维护者信息）</p>
<p><code>RUN</code>镜像构建时，需要运行的命令（你想让它做什么，在命令前面加上RUN即可）</p>
<p><code>ADD</code>copy文件，会自动解压</p>
<p><code>WORKDIR</code>设置镜像的工作目录</p>
<p><code>VOLUME</code>设置卷，挂载主机目录</p>
<p><code>EXPOSE</code>指定对外的端口，暴露端口</p>
<p><code>CMD</code>指定容器启动时，要运行的命令，只有最后一个会生效，可被替代</p>
<p><code>ENTRYPOINT</code>指定容器启动时，要运行的命令，可以追加命令</p>
<p><code>ONBUILD</code>当构建一个被继承DockerFile时，就会运行ONBUILD指令（触发指令）</p>
<p><code>COPY</code>类似ADD，将文件拷贝到镜像中</p>
<p><code>ENV</code>构建时，设置环境变量</p>
<h2 id="构建自已的Centos"><a href="#构建自已的Centos" class="headerlink" title="构建自已的Centos"></a>构建自已的Centos</h2><p>Docker Hub中大多镜像都是从这个基础镜像过来的（FROM scratch），然后配置需要的东西。</p>
<pre class=" language-bash"><code class="language-bash">FROM scratch
ADD centos-7-x86_64-docker.tar.xz /

LABEL \
    org.label-schema.schema-version<span class="token operator">=</span><span class="token string">"1.0"</span> \
    org.label-schema.name<span class="token operator">=</span><span class="token string">"CentOS Base Image"</span> \
    org.label-schema.vendor<span class="token operator">=</span><span class="token string">"CentOS"</span> \
    org.label-schema.license<span class="token operator">=</span><span class="token string">"GPLv2"</span> \
    org.label-schema.build-date<span class="token operator">=</span><span class="token string">"20201113"</span> \
    org.opencontainers.image.title<span class="token operator">=</span><span class="token string">"CentOS Base Image"</span> \
    org.opencontainers.image.vendor<span class="token operator">=</span><span class="token string">"CentOS"</span> \
    org.opencontainers.image.licenses<span class="token operator">=</span><span class="token string">"GPL-2.0-only"</span> \
    org.opencontainers.image.created<span class="token operator">=</span><span class="token string">"2020-11-13 00:00:00+00:00"</span>

CMD <span class="token punctuation">[</span><span class="token string">"/bin/bash"</span><span class="token punctuation">]</span></code></pre>
<blockquote>
<p>创建一个自己的centos</p>
</blockquote>
<p>1、编写Dockerfile文件</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim mydockerfile-centos</span>
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat mydockerfile-centos </span>
FROM centos
MAINTAINER lskj<span class="token operator">&lt;</span>2292807998@qq.com<span class="token operator">></span>

ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>

RUN yum -y <span class="token function">install</span> vim
RUN yum -y <span class="token function">install</span> net-tools

EXPOSE 80


CMD <span class="token keyword">echo</span> <span class="token variable">$MYPATH</span>
CMD <span class="token keyword">echo</span> <span class="token string">"-----end-----"</span>
CMD /bin/bash
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<p>2、通过这个文件构建镜像</p>
<p><code>docker build -f dockerfile文件路径 -t 镜像名:[tag]</code></p>
<pre class=" language-bash"><code class="language-bash">docker build -f mydockerfile-centos -t mycentos:0.1 <span class="token keyword">.</span></code></pre>
<p>3、测试运行</p>
<pre class=" language-bash"><code class="language-bash">docker run -it mycentos:./1</code></pre>
<blockquote>
<p>CMD与ENTRYPOINT区别</p>
</blockquote>
<p>测试CMD：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
mydockerfile-centos
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim dockerfile-cmd-test</span>
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat dockerfile-cmd-test </span>
FROM centos
CMD <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker build -f dockerfile-cmd-test -t cmdtest .</span>
Sending build context to Docker daemon  3.072kB
Step 1/2 <span class="token keyword">:</span> FROM centos
 ---<span class="token operator">></span> 0d120b6ccaa8
Step 2/2 <span class="token keyword">:</span> CMD <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span>
 ---<span class="token operator">></span> Running <span class="token keyword">in</span> ab53426fd79f
Removing intermediate container ab53426fd79f
 ---<span class="token operator">></span> 066b2d72266f
Successfully built 066b2d72266f
Successfully tagged cmdtest:latest
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run 066b2d72266f</span>
<span class="token keyword">.</span>
<span class="token punctuation">..</span>
.dockerenv
bin
dev
etc
home
lib
lib64
lost+found
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span>

<span class="token comment" spellcheck="true">#想追加一个命令 -l  => ls -al</span>
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run 066b2d72266f -l</span>
docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused <span class="token string">"exec: \"-l\": executable file not found in <span class="token variable">$PATH</span>"</span><span class="token keyword">:</span> unknown.
ERRO<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> error waiting <span class="token keyword">for</span> container: context canceled 

<span class="token comment" spellcheck="true">#cmd的情况下 -l替换了CMD ["ls","-a"]命令，-l不是命令，所以报错</span></code></pre>
<p>测试ENTRYPOINT：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim dockerfile-entrypoint-test</span>
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat dockerfile-entrypoint-test </span>
FROM centos
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker build -f dockerfile-entrypoint-test -t entrypoint-test .</span>
Sending build context to Docker daemon  4.096kB
Step 1/2 <span class="token keyword">:</span> FROM centos
 ---<span class="token operator">></span> 0d120b6ccaa8
Step 2/2 <span class="token keyword">:</span> ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span>
 ---<span class="token operator">></span> Running <span class="token keyword">in</span> 9cbf88848912
Removing intermediate container 9cbf88848912
 ---<span class="token operator">></span> bc47f7888c0d
Successfully built bc47f7888c0d
Successfully tagged entrypoint-test:latest

<span class="token comment" spellcheck="true">#追加的命令，是直接拼接在ENTRYPOINT命令的后面</span>
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run bc47f7888c0d -l</span>
total 56
drwxr-xr-x   1 root root 4096 Nov 25 10:31 <span class="token keyword">.</span>
drwxr-xr-x   1 root root 4096 Nov 25 10:31 <span class="token punctuation">..</span>
-rwxr-xr-x   1 root root    0 Nov 25 10:31 .dockerenv
lrwxrwxrwx   1 root root    7 May 11  2019 bin -<span class="token operator">></span> usr/bin
drwxr-xr-x   5 root root  340 Nov 25 10:31 dev
drwxr-xr-x   1 root root 4096 Nov 25 10:31 etc
drwxr-xr-x   2 root root 4096 May 11  2019 home
lrwxrwxrwx   1 root root    7 May 11  2019 lib -<span class="token operator">></span> usr/lib
lrwxrwxrwx   1 root root    9 May 11  2019 lib64 -<span class="token operator">></span> usr/lib64
drwx------   2 root root 4096 Aug  9 21:40 lost+found
drwxr-xr-x   2 root root 4096 May 11  2019 media
drwxr-xr-x   2 root root 4096 May 11  2019 mnt
drwxr-xr-x   2 root root 4096 May 11  2019 opt
dr-xr-xr-x 110 root root    0 Nov 25 10:31 proc
dr-xr-x---   2 root root 4096 Aug  9 21:40 root
drwxr-xr-x  11 root root 4096 Aug  9 21:40 run
lrwxrwxrwx   1 root root    8 May 11  2019 sbin -<span class="token operator">></span> usr/sbin
drwxr-xr-x   2 root root 4096 May 11  2019 srv
dr-xr-xr-x  13 root root    0 Nov 25 02:55 sys
drwxrwxrwt   7 root root 4096 Aug  9 21:40 tmp
drwxr-xr-x  12 root root 4096 Aug  9 21:40 usr
drwxr-xr-x  20 root root 4096 Aug  9 21:40 var
<span class="token punctuation">[</span>root@lskj dockerfile<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<h2 id="Tomcat镜像"><a href="#Tomcat镜像" class="headerlink" title="Tomcat镜像"></a>Tomcat镜像</h2><p>1、准备镜像文件tomcat压缩包，jdk压缩包。</p>
<p><img src="/archives/4a3d459a/image-20201125183726271.png" alt=""></p>
<p>2、编写Dockerfile文件（官方命名<code>Dockerfile</code>，<code>build</code>会自动寻找这个文件，就不需要<code>-f</code>指定了。</p>
<pre class=" language-bash"><code class="language-bash">FROM centos
MAINTAINER lskj

COPY readme.txt /usr/local/readme.txt
ADD jdk-8u271-linux-x64.tar.gz /usr/local
ADD apache-tomcat-9.0.35.tar.gz /usr/local

RUN yum -y <span class="token function">install</span> vim

ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>

ENV JAVA_HOME /usr/local/jdk1.8.0_271
ENV CLASSPATH <span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar
ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.35
ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.35
ENV PATH <span class="token variable">$PATH</span><span class="token keyword">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$CATALINA_HOME</span>/lib:<span class="token variable">$CATALINA_HOME</span>/bin

EXPOSE 8080

CMD /usr/local/apache-tomcat-9.0.35/bin/startup.sh <span class="token operator">&amp;&amp;</span> <span class="token function">tail</span> -F /usr/local/apache-tomcat-9.0.35/bin/logs/catalina.out</code></pre>
<p>3、构建镜像。</p>
<pre class=" language-bash"><code class="language-bash">docker build -t diytomcat <span class="token keyword">.</span></code></pre>
<p>4、启动镜像。</p>
<p>5、访问测试。</p>
<p>6、发布项目（由于做了卷挂载，直接在本地编写项目即可）</p>
<p><strong>web.xml</strong></p>
<pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">"</span></span>
  <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span> <span class="token attr-name">metadata-complete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">></span></span></code></pre>
<h2 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h2><blockquote>
<p>DockerHub</p>
</blockquote>
<p>1、地址：<a href="https://hub.docker.com/，注册自己的账号。" target="_blank" rel="noopener">https://hub.docker.com/，注册自己的账号。</a></p>
<p>2、确定账号可以登录。</p>
<p>3、登录账号，在自己的服务器上提交自己的镜像。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj local<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker login -u lskj</span>
Password: 
WARNING<span class="token operator">!</span> Your password will be stored unencrypted <span class="token keyword">in</span> /root/.docker/config.json.
Configure a credential helper to remove this warning. See
https://docs.docker.com/engine/reference/commandline/login/<span class="token comment" spellcheck="true">#credentials-store</span>

Login Succeeded
</code></pre>
<p>4、登录成功后，提交镜像（docker push）</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#push自己的镜像到服务器上</span>
docker push diytomcat
<span class="token comment" spellcheck="true">#push镜像时，尽量带上版本号</span>
docker push lskj/tomcat:1.0</code></pre>
<blockquote>
<p>阿里云镜像服务</p>
</blockquote>
<p>1、登录阿里云。</p>
<p>2、找到容器镜像服务。</p>
<p>3、创建命名空间。</p>
<p>4、创建容器镜像。</p>
<p><img src="/archives/4a3d459a/image-20201125211437982.png" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/archives/4a3d459a/timg01.jpg" alt=""></p>
<h1 id="十、Docker网络"><a href="#十、Docker网络" class="headerlink" title="十、Docker网络"></a>十、Docker网络</h1><h2 id="Docker0"><a href="#Docker0" class="headerlink" title="Docker0"></a>Docker0</h2><p>清空所有images和容器。</p>
<blockquote>
<p>测试</p>
</blockquote>
<p><img src="/archives/4a3d459a/image-20201125221452254.png" alt=""></p>
<p>docker是怎样处理容器网络访问的？</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -P --name tomcat02 tomcat</span>

<span class="token comment" spellcheck="true">#查看容器内部的网络地址 ip addr</span>
<span class="token comment" spellcheck="true">#容器启动时，会得到一个docker分配的eth0@if69 ip地址</span>
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcat02 ip addr</span>
1: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
68: eth0@if69: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever
<span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<p>Linux能否ping通容器内部？</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ping 172.17.0.2</span>
PING 172.17.0.2 <span class="token punctuation">(</span>172.17.0.2<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from 172.17.0.2: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.079 ms
64 bytes from 172.17.0.2: icmp_seq<span class="token operator">=</span>2 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.071 ms
64 bytes from 172.17.0.2: icmp_seq<span class="token operator">=</span>3 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.059 ms
<span class="token comment" spellcheck="true">#Linux可以ping通docker容器内部</span></code></pre>
<blockquote>
<p>原理</p>
</blockquote>
<p>1、每启动一个docker容器，docker就会给docker容器分配一个ip，只要安装了docker，就会有一个网卡docker0。桥接模式，使用的技术是evth-pair。</p>
<p>再次测试ip addr：</p>
<p><img src="/archives/4a3d459a/image-20201125223434972.png" alt=""></p>
<p>2、再启动一个容器，发现又多了一对容器。</p>
<p><img src="/archives/4a3d459a/image-20201125224039972.png" alt=""></p>
<blockquote>
<p>这些容器带来的网卡都是一对一对的，evth-pair就是一对的虚拟设备接口，它们都是成对出现的，一段连着协议，一段彼此相连。</p>
<p>正因为这个特性，evth-pair充当一个桥梁，连接各种虚拟网络设备。</p>
<p>OpenStac，Docker容器之间的连接，OVS的连接，都是使用evth-pair技术。</p>
</blockquote>
<p>3、测试tomcat02和tomcat03是否可以ping通。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcat03 ping 172.17.0.2</span>
PING 172.17.0.2 <span class="token punctuation">(</span>172.17.0.2<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from 172.17.0.2: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.100 ms
64 bytes from 172.17.0.2: icmp_seq<span class="token operator">=</span>2 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.077 ms
<span class="token comment" spellcheck="true">#结论：容器和容器之间是可以互相ping通的。</span></code></pre>
<p><img src="/archives/4a3d459a/image-20201125232958530.png" alt=""></p>
<p>tomcat02和tomcat03是公用的一个路由器，docker0.</p>
<p>所有的容器不指定网络的情况下，都是docker0路由的，docker会给容器分配一个默认的可用ip。</p>
<blockquote>
<p>总结</p>
</blockquote>
<p>Docker使用的是Linux桥接，宿主机中是一个Docker容器的docker0.</p>
<p><img src="/archives/4a3d459a/image-20201126085509745.png" alt=""></p>
<p>Docker中的所有的网络接口都是虚拟的。虚拟的转发效率高。</p>
<p>只要容器删除，对应网桥一对就没了。</p>
<h2 id="–link容器互联"><a href="#–link容器互联" class="headerlink" title="–link容器互联"></a>–link容器互联</h2><p>一个微服务项目，虽然项目不重启，但数据库的ip变化，希望可以通过名字来进行容器访问。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker start tomcat01</span>
tomcat01
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker start tomcat02</span>
tomcat02
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcat02 ping tomcat01</span>
ping: tomcat01: Name or <span class="token function">service</span> not known

<span class="token comment" spellcheck="true">#通过--link可以解决网络连通问题</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -P --name tomcat04 --link tomcat02 tomcat</span>
f55fceb8f76bf2eff4e31cff076eb7d94f09a5d3d9405ca2024e00729300c95a

<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcat04 ping tomcat02</span>
PING tomcat02 <span class="token punctuation">(</span>172.17.0.3<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from tomcat02 <span class="token punctuation">(</span>172.17.0.3<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.108 ms
<span class="token punctuation">..</span>.

<span class="token comment" spellcheck="true">#反向不可以连通</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcat02 ping tomcat04</span>
ping: tomcat04: Name or <span class="token function">service</span> not known</code></pre>
<p>查看hosts配置</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcat04 cat /etc/hosts</span>
127.0.0.1    localhost
::1    localhost ip6-localhost ip6-loopback
fe00::0    ip6-localnet
ff00::0    ip6-mcastprefix
ff02::1    ip6-allnodes
ff02::2    ip6-allrouters
172.17.0.3    tomcat02 a9c1a174ab52
172.17.0.4    f55fceb8f76b
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#</span></code></pre>
<p><code>--link</code>就是在hosts配置中做映射。</p>
<p>现使用Docker不建议使用<code>--link</code>。</p>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><blockquote>
<p>查看所有的docker网络</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker network ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
6c17614d976e        bridge              bridge              local
1b9e71a2742d        host                host                local
fcde1d5b1f3c        none                null                local
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<p><strong>网络模式</strong></p>
<ul>
<li><p>bride：桥接 ，docker（默认）</p>
</li>
<li><p>none：不配置网络</p>
</li>
<li><p>host：和宿主机共享网络</p>
</li>
<li><p>container：容器网络连通（局限很大，用的少）</p>
</li>
</ul>
<p><strong>测试：</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#直接启动的命令 --net bridge，就是docker0</span>
docker run -d -P --name tomcat01 tomcat
docker run -d -P --name tomcat01 --net bridge tomcat

<span class="token comment" spellcheck="true">#docker0特点：默认，域名不能访问，--link可以打通连接</span>

<span class="token comment" spellcheck="true">#自定义一个网络</span>
<span class="token comment" spellcheck="true">#--driver bridge</span>
<span class="token comment" spellcheck="true">#--subnet 192.168.0.0/16</span>
<span class="token comment" spellcheck="true">#--gateway 192.168.0.1</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span>
3d1c1fc671b0868404208e873de8efc6539f382e8a9b543ed136f8e362753da4
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker network ls</span>
NETWORK ID          NAME                DRIVER              SCOPE
6c17614d976e        bridge              bridge              local
1b9e71a2742d        host                host                local
3d1c1fc671b0        mynet               bridge              local
fcde1d5b1f3c        none                null                local
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<p>自定义的网络就创建完成了。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker network inspect mynet</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"Name"</span><span class="token keyword">:</span> <span class="token string">"mynet"</span>,
        <span class="token string">"Id"</span><span class="token keyword">:</span> <span class="token string">"3d1c1fc671b0868404208e873de8efc6539f382e8a9b543ed136f8e362753da4"</span>,
        <span class="token string">"Created"</span><span class="token keyword">:</span> <span class="token string">"2020-11-26T09:33:07.248648974+08:00"</span>,
        <span class="token string">"Scope"</span><span class="token keyword">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Driver"</span><span class="token keyword">:</span> <span class="token string">"bridge"</span>,
        <span class="token string">"EnableIPv6"</span><span class="token keyword">:</span> false,
        <span class="token string">"IPAM"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Driver"</span><span class="token keyword">:</span> <span class="token string">"default"</span>,
            <span class="token string">"Options"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">"Config"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">"Subnet"</span><span class="token keyword">:</span> <span class="token string">"192.168.0.0/16"</span>,
                    <span class="token string">"Gateway"</span><span class="token keyword">:</span> <span class="token string">"192.168.0.1"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Internal"</span><span class="token keyword">:</span> false,
        <span class="token string">"Attachable"</span><span class="token keyword">:</span> false,
        <span class="token string">"Ingress"</span><span class="token keyword">:</span> false,
        <span class="token string">"ConfigFrom"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Network"</span><span class="token keyword">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"ConfigOnly"</span><span class="token keyword">:</span> false,
        <span class="token string">"Containers"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">"Options"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">"Labels"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<p>启动两个tomcat进行测试：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -P --name tomcat-net-01 --net mynet tomcat</span>
5a443e156cabadffd64e226fa728a387ad65ab65fba2314e3dd5c20cfd623073
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d -P --name tomcat-net-02 --net mynet tomcat</span>
0f3909e224c8d8b977979b0a38a5ff1b26106179a18e87f8bde7bb62023a2dd5
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker network inspect mynet</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">"Name"</span><span class="token keyword">:</span> <span class="token string">"mynet"</span>,
        <span class="token string">"Id"</span><span class="token keyword">:</span> <span class="token string">"3d1c1fc671b0868404208e873de8efc6539f382e8a9b543ed136f8e362753da4"</span>,
        <span class="token string">"Created"</span><span class="token keyword">:</span> <span class="token string">"2020-11-26T09:33:07.248648974+08:00"</span>,
        <span class="token string">"Scope"</span><span class="token keyword">:</span> <span class="token string">"local"</span>,
        <span class="token string">"Driver"</span><span class="token keyword">:</span> <span class="token string">"bridge"</span>,
        <span class="token string">"EnableIPv6"</span><span class="token keyword">:</span> false,
        <span class="token string">"IPAM"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Driver"</span><span class="token keyword">:</span> <span class="token string">"default"</span>,
            <span class="token string">"Options"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">"Config"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">"Subnet"</span><span class="token keyword">:</span> <span class="token string">"192.168.0.0/16"</span>,
                    <span class="token string">"Gateway"</span><span class="token keyword">:</span> <span class="token string">"192.168.0.1"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Internal"</span><span class="token keyword">:</span> false,
        <span class="token string">"Attachable"</span><span class="token keyword">:</span> false,
        <span class="token string">"Ingress"</span><span class="token keyword">:</span> false,
        <span class="token string">"ConfigFrom"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"Network"</span><span class="token keyword">:</span> <span class="token string">""</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"ConfigOnly"</span><span class="token keyword">:</span> false,
        <span class="token string">"Containers"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
            <span class="token string">"0f3909e224c8d8b977979b0a38a5ff1b26106179a18e87f8bde7bb62023a2dd5"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"Name"</span><span class="token keyword">:</span> <span class="token string">"tomcat-net-02"</span>,
                <span class="token string">"EndpointID"</span><span class="token keyword">:</span> <span class="token string">"f37105a2d780fe82974e4f198f6dd1f4b5737bfd91f51f47e6c4fb994b759040"</span>,
                <span class="token string">"MacAddress"</span><span class="token keyword">:</span> <span class="token string">"02:42:c0:a8:00:03"</span>,
                <span class="token string">"IPv4Address"</span><span class="token keyword">:</span> <span class="token string">"192.168.0.3/16"</span>,
                <span class="token string">"IPv6Address"</span><span class="token keyword">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"5a443e156cabadffd64e226fa728a387ad65ab65fba2314e3dd5c20cfd623073"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
                <span class="token string">"Name"</span><span class="token keyword">:</span> <span class="token string">"tomcat-net-01"</span>,
                <span class="token string">"EndpointID"</span><span class="token keyword">:</span> <span class="token string">"06c688456f25e0fd883ff4cda9138b38cd505cecd765573a85552c3d946f2279"</span>,
                <span class="token string">"MacAddress"</span><span class="token keyword">:</span> <span class="token string">"02:42:c0:a8:00:02"</span>,
                <span class="token string">"IPv4Address"</span><span class="token keyword">:</span> <span class="token string">"192.168.0.2/16"</span>,
                <span class="token string">"IPv6Address"</span><span class="token keyword">:</span> <span class="token string">""</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Options"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">"Labels"</span><span class="token keyword">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span>

<span class="token comment" spellcheck="true">#再次测试ping连接</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcat-net-01 ping 192.168.0.3</span>
PING 192.168.0.3 <span class="token punctuation">(</span>192.168.0.3<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from 192.168.0.3: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.101 ms
64 bytes from 192.168.0.3: icmp_seq<span class="token operator">=</span>2 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.082 ms
^C
--- 192.168.0.3 <span class="token function">ping</span> statistics ---
2 packets transmitted, 2 received, 0% packet loss, <span class="token function">time</span> 999ms
rtt min/avg/max/mdev <span class="token operator">=</span> 0.082/0.091/0.101/0.013 ms

<span class="token comment" spellcheck="true">#现在不使用--link也可以ping名字了</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcat-net-01 ping tomcat-net-02</span>
PING tomcat-net-02 <span class="token punctuation">(</span>192.168.0.3<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from tomcat-net-02.mynet <span class="token punctuation">(</span>192.168.0.3<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.067 ms
64 bytes from tomcat-net-02.mynet <span class="token punctuation">(</span>192.168.0.3<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>2 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.079 ms
64 bytes from tomcat-net-02.mynet <span class="token punctuation">(</span>192.168.0.3<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>3 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.094 ms
^C
--- tomcat-net-02 <span class="token function">ping</span> statistics ---
3 packets transmitted, 3 received, 0% packet loss, <span class="token function">time</span> 1001ms
rtt min/avg/max/mdev <span class="token operator">=</span> 0.067/0.080/0.094/0.011 ms
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<p>自定义的网络，docker自动维护好了对应的关系，推荐平时这样使用网络。</p>
<blockquote>
<p>优点</p>
</blockquote>
<p>不同的集群使用不同的网络，保证集群是安全和健康的。</p>
<h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker network --help</span>

Usage:    docker network COMMAND

Manage networks

Commands:
<span class="token comment" spellcheck="true">#connect     Connect a container to a network</span>
  connect     Connect a container to a network
  create      Create a network
  disconnect  Disconnect a container from a network
  inspect     Display detailed information on one or <span class="token function">more</span> networks
  <span class="token function">ls</span>          List networks
  prune       Remove all unused networks
  <span class="token function">rm</span>          Remove one or <span class="token function">more</span> networks

Run <span class="token string">'docker network COMMAND --help'</span> <span class="token keyword">for</span> <span class="token function">more</span> information on a command.</code></pre>
<p><strong>connect</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker network connect --help</span>

Usage:    docker network connect <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> NETWORK CONTAINER

Connect a container to a network

Options:
      --alias strings           Add network-scoped <span class="token function">alias</span> <span class="token keyword">for</span> the container
      --driver-opt strings      driver options <span class="token keyword">for</span> the network
      --ip string               IPv4 address <span class="token punctuation">(</span>e.g., 172.30.100.104<span class="token punctuation">)</span>
      --ip6 string              IPv6 address <span class="token punctuation">(</span>e.g., 2001:db8::33<span class="token punctuation">)</span>
      --link list               Add <span class="token function">link</span> to another container
      --link-local-ip strings   Add a link-local address <span class="token keyword">for</span> the container</code></pre>
<p><img src="/archives/4a3d459a/image-20201126101012875.png" alt=""></p>
<p><strong>测试</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#测试打通tomcat01 -mynet</span>
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker network connect mynet tomcat01</span>

<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker network inspect mynet</span></code></pre>
<p><img src="/archives/4a3d459a/image-20201126100441544.png" alt=""></p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it tomcat01 ping tomcat-net-01</span>
PING tomcat-net-01 <span class="token punctuation">(</span>192.168.0.2<span class="token punctuation">)</span> 56<span class="token punctuation">(</span>84<span class="token punctuation">)</span> bytes of data.
64 bytes from tomcat-net-01.mynet <span class="token punctuation">(</span>192.168.0.2<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>1 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.088 ms
64 bytes from tomcat-net-01.mynet <span class="token punctuation">(</span>192.168.0.2<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>2 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.075 ms
64 bytes from tomcat-net-01.mynet <span class="token punctuation">(</span>192.168.0.2<span class="token punctuation">)</span>: icmp_seq<span class="token operator">=</span>3 ttl<span class="token operator">=</span>64 time<span class="token operator">=</span>0.076 ms
^C
--- tomcat-net-01 <span class="token function">ping</span> statistics ---
3 packets transmitted, 3 received, 0% packet loss, <span class="token function">time</span> 1001ms
rtt min/avg/max/mdev <span class="token operator">=</span> 0.075/0.079/0.088/0.011 ms
<span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span></code></pre>
<blockquote>
<p>结论</p>
</blockquote>
<p>假设要跨网络操作容器，需要使用<code>docker network connect</code>连通。</p>
<h2 id="部署Redis集群"><a href="#部署Redis集群" class="headerlink" title="部署Redis集群"></a>部署Redis集群</h2><p>1、创建网卡</p>
<pre class=" language-bash"><code class="language-bash">docker network create redis --subnet 172.38.0.0/16</code></pre>
<p>2、通过shell脚本创建6个redis配置</p>
<pre class=" language-bash"><code class="language-bash"><span class="token keyword">for</span> port <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> 1 6<span class="token variable">)</span></span><span class="token punctuation">;</span> \
<span class="token keyword">do</span> \
<span class="token function">mkdir</span> -p /mydata/redis/node-<span class="token variable">${port}</span>/conf
<span class="token function">touch</span> /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> EOF <span class="token operator">></span>/mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf
port 6379
bind 0.0.0.0
cluster-enabled <span class="token function">yes</span>
cluster-config-file nodes.conf
cluster-node-timeout 5000
cluster-announce-ip 172.38.0.1<span class="token variable">${port}</span>
cluster-announce-port 6379
cluster-announce-bus-port 16379
appendonly <span class="token function">yes</span>
EOF
<span class="token keyword">done</span></code></pre>
<p>3、启动</p>
<pre class=" language-bash"><code class="language-bash">docker run -p 637<span class="token variable">${port}</span>:6379 -p 1637<span class="token variable">${port}</span>:16379 --name redis-<span class="token variable">${port}</span> \
-v /mydata/redis/node-<span class="token variable">${port}</span>/data:/data \
-v /mydata/redis/node-<span class="token variable">${port}</span>/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.1<span class="token variable">${port}</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf<span class="token punctuation">;</span> \


docker run -p 6371:6379 -p 16371:16379 --name redis-1 \
-v /mydata/redis/node-1/data:/data \
-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf<span class="token punctuation">;</span> 

docker run -p 6372:6379 -p 16372:16379 --name redis-2 \
-v /mydata/redis/node-2/data:/data \
-v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf<span class="token punctuation">;</span> 

docker run -p 6373:6379 -p 16373:16379 --name redis-3 \
-v /mydata/redis/node-3/data:/data \
-v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf<span class="token punctuation">;</span> 

docker run -p 6374:6379 -p 16374:16379 --name redis-4 \
-v /mydata/redis/node-4/data:/data \
-v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf<span class="token punctuation">;</span>

docker run -p 6375:6379 -p 16375:16379 --name redis-5 \
-v /mydata/redis/node-5/data:/data \
-v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf<span class="token punctuation">;</span>

docker run -p 6376:6379 -p 16376:16379 --name redis-6 \
-v /mydata/redis/node-6/data:/data \
-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf \
-d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf<span class="token punctuation">;</span></code></pre>
<p>4、创建集群</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj /<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker exec -it redis-1 /bin/sh</span>
/data <span class="token comment" spellcheck="true">#</span>

/data <span class="token comment" spellcheck="true"># redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 -</span>
-cluster-replicas 1


/data <span class="token comment" spellcheck="true"># redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 -</span>
-cluster-replicas 1
<span class="token operator">>></span><span class="token operator">></span> Performing <span class="token function">hash</span> slots allocation on 6 nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span>0<span class="token punctuation">]</span> -<span class="token operator">></span> Slots 0 - 5460
Master<span class="token punctuation">[</span>1<span class="token punctuation">]</span> -<span class="token operator">></span> Slots 5461 - 10922
Master<span class="token punctuation">[</span>2<span class="token punctuation">]</span> -<span class="token operator">></span> Slots 10923 - 16383
Adding replica 172.38.0.15:6379 to 172.38.0.11:6379
Adding replica 172.38.0.16:6379 to 172.38.0.12:6379
Adding replica 172.38.0.14:6379 to 172.38.0.13:6379
M: 4562280ea4f7c7e49fcadfc299d0c9912d767988 172.38.0.11:6379
   slots:<span class="token punctuation">[</span>0-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span>5461 slots<span class="token punctuation">)</span> master
M: d7f953003f939e0a6aec2796635d039acc61a538 172.38.0.12:6379
   slots:<span class="token punctuation">[</span>5461-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span>5462 slots<span class="token punctuation">)</span> master
M: 8cd3da0e9c72dab60380e6ef03dfb66352434ac8 172.38.0.13:6379
   slots:<span class="token punctuation">[</span>10923-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span>5461 slots<span class="token punctuation">)</span> master
S: 2f5df14d3bdb5c340a77cb0a59f564debc8474f8 172.38.0.14:6379
   replicates 8cd3da0e9c72dab60380e6ef03dfb66352434ac8
S: 39422e8958039c54b850539f8bff28b0e424b7f5 172.38.0.15:6379
   replicates 4562280ea4f7c7e49fcadfc299d0c9912d767988
S: f92d88b990e47738ccec9012b5b43d2ad1feae3d 172.38.0.16:6379
   replicates d7f953003f939e0a6aec2796635d039acc61a538
Can I <span class="token keyword">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">'yes'</span> to accept<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token operator">>></span><span class="token operator">></span> Nodes configuration updated
<span class="token operator">>></span><span class="token operator">></span> Assign a different config epoch to each node
<span class="token operator">>></span><span class="token operator">></span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">>></span><span class="token operator">></span> Performing Cluster Check <span class="token punctuation">(</span>using node 172.38.0.11:6379<span class="token punctuation">)</span>
M: 4562280ea4f7c7e49fcadfc299d0c9912d767988 172.38.0.11:6379
   slots:<span class="token punctuation">[</span>0-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span>5461 slots<span class="token punctuation">)</span> master
   1 additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 2f5df14d3bdb5c340a77cb0a59f564debc8474f8 172.38.0.14:6379
   slots: <span class="token punctuation">(</span>0 slots<span class="token punctuation">)</span> slave
   replicates 8cd3da0e9c72dab60380e6ef03dfb66352434ac8
S: f92d88b990e47738ccec9012b5b43d2ad1feae3d 172.38.0.16:6379
   slots: <span class="token punctuation">(</span>0 slots<span class="token punctuation">)</span> slave
   replicates d7f953003f939e0a6aec2796635d039acc61a538
M: d7f953003f939e0a6aec2796635d039acc61a538 172.38.0.12:6379
   slots:<span class="token punctuation">[</span>5461-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span>5462 slots<span class="token punctuation">)</span> master
   1 additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 8cd3da0e9c72dab60380e6ef03dfb66352434ac8 172.38.0.13:6379
   slots:<span class="token punctuation">[</span>10923-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span>5461 slots<span class="token punctuation">)</span> master
   1 additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 39422e8958039c54b850539f8bff28b0e424b7f5 172.38.0.15:6379
   slots: <span class="token punctuation">(</span>0 slots<span class="token punctuation">)</span> slave
   replicates 4562280ea4f7c7e49fcadfc299d0c9912d767988
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">>></span><span class="token operator">></span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">>></span><span class="token operator">></span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All 16384 slots covered.
/data <span class="token comment" spellcheck="true"># </span></code></pre>
<h1 id="十一、SpringBoot微服务打包Docker镜像"><a href="#十一、SpringBoot微服务打包Docker镜像" class="headerlink" title="十一、SpringBoot微服务打包Docker镜像"></a>十一、SpringBoot微服务打包Docker镜像</h1><p>1、构建SpringBoot项目。</p>
<p>2、打包应用。</p>
<pre><code>IDEA-&gt;右侧边栏Maven-&gt;项目名-&gt;Lifecycle-&gt;package

BUILD SUCCESS，即打包成功。</code></pre><p>3、编写Dockerfile。</p>
<pre><code>在打包成功的target目录下创建Dockerfile文件（代码高亮，需安装docker插件）
dockerfile文件内容如下：

FROM java:8

COPY *.jar /app.jar

CMD ["--server.port=8080"]

EXPOSE 8080\

ENTRYPOINT ["java","-jar","/app.jar"]
</code></pre><p>4、构建镜像。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /home/</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
docker-test-volume  mysql  <span class="token function">test</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir idea</span>
<span class="token punctuation">[</span>root@lskj home<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd idea/</span>
<span class="token punctuation">[</span>root@lskj idea<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls</span>
<span class="token punctuation">[</span>root@lskj idea<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># </span>

<span class="token comment" spellcheck="true">#将打包好的jar包和Dockerfile文件上传至idea目录。</span>
<span class="token punctuation">[</span>root@lskj idea<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker build -t test .</span></code></pre>
<p>5、发布运行。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@lskj idea<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># docker run -d --P --name test-springboot test</span></code></pre>

            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Docker/">
                                    <span class="chip bg-color">Docker</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    /* #vcomments .vwrap {
        box-sizing: border-box;
        padding: 0 0 44px;
        background-color: #F0FFF0;
    }
    #vcomments .vwrap .vheader{width: 80%;bottom:0;position: absolute;background: #F0FFF0;}

    #vcomments .vinput{padding:10px 15px; text-align: center;}

    #vcomments .vwrap .vheader .vinput{border-bottom:0px}

    #vcomments .vwrap .vedit .vctrl{margin-top:-44px;right:0;position:absolute;margin-right:-3px;}

    #vcomments  .vwrap .vrow{position:absolute;right:0;bottom:0;width:20%;padding-top:0px;}

    #vcomments  .vrow {font-size: 0;padding: 0px 0;}

    #vcomments  .vicon {margin-right: 15px;}

    #vcomments  .vrow .vcol.vcol-30{display: none}

    #vcomments  .vedit .vctrl span.vpreview-btn{display: none}

    #vcomments  .vrow .vcol.vcol-70{width: 100%;}

    #vcomments  .vsubmit.vbtn{border-radius: 0;padding: 0;color: #fff;line-height: 44px;width:100%;border: none;background:#00ecbc;}

    #vcomments  .vcards .vcard .vh .vhead .vsys{background: #F0FFF0;}

    #vcomments  .vcards .vcard .vh .vmeta .vat{font-size: 12px;display: block;margin-left: 15px;float: right;color: #fff;background-color: #00ecbc;line-height: 20px;padding: 0 6px;border-radius: 3px;}

    @media screen and (max-width: 520px){
    #vcomments  .vwrap .vheader .vinput{width: 33.33%;padding:10px 5px;}  
    } */

    #vcomments input[type=text],

    #vcomments input[type=email],

    #vcomments input[type=url],

    #vcomments textarea {
        box-sizing: border-box;
    }
    #vcomments .vwrap p {
        height: 20px;
        width: 20px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }
    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    /* 修复评论第一行位置错位 */
    .v .vlist .vcard {
    padding-top: 2.5em !important ;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        admin_email: '2292807998@qq.com',
        appId: 'vDtNtruYzjCbFJbWyeQ8Bybw-gzGzoHsz',
        appKey: 'TJv4iKCEAYMHDhy8V8IvAJGF',
        path: window.location.pathname,
        comment_count: true,
        notify: 'false' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'retro',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'ヾﾉ≧∀≦)o在这里可以留言评论喔！',

    });
    $(document).ready(function(){
        $("#vcomments").on('click', 'span.vat',function(){
            $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
            $('textarea#veditor').focus();
        })
    })
</script>
<!-- <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
<script type="text/javascript">
    jinrishici.load(function(result) {
        var jrsc_plac =  result.data.content + "\n「" + result.data.origin.title + "」" + result.data.origin.dynasty + " · " + result.data.origin.author
        document.getElementById("veditor").setAttribute("placeholder",jrsc_plac);
    });
</script> -->

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/archives/62511120/">
                    <div class="card-image">
                        
                        <img src="https://cdn.jsdelivr.net/gh/lskjwp/image@master/imageCover/css学习笔记.png" class="responsive-img" alt="css学习笔记">
                        
                        <span class="card-title">css学习笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            学习视频链接：黑马程序员pink老师
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-03-18
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CSS/" class="post-category">
                                    CSS
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CSS/">
                        <span class="chip bg-color">CSS</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/archives/8eda3648/">
                    <div class="card-image">
                        
                        <img src="https://cdn.jsdelivr.net/gh/lskjwp/image@master/imageCover/Redis学习笔记.jpg" class="responsive-img" alt="Redis学习笔记">
                        
                        <span class="card-title">Redis学习笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            学习视频链接：B站 遇见狂神说
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-11-20
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Redis/" class="post-category">
                                    Redis
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Redis/">
                        <span class="chip bg-color">Redis</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" >
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

    <div id="floating-toc-btn" class="hide-on-med-and-down" >
        <a class="btn-floating btn-large waves-effect waves-light" title="展开/关闭TOC">
            <i class="fas fa-list-ul" style="zoom: 0.88;"></i>
        </a>
    </div>
<!-- <div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div> -->


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="6668004913"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="/about" target="_blank">勇也很努力</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">317.4k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv" style="display: none;">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv" style="display:none">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "7";
                    var startDate = "1";
                    var startHour = "14";
                    var startMinute = "24";
                    var startSecond = "48";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:2292807998@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2292807998" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2292807998" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>
<script>
    /*
    修改不蒜子初始化计数
    */
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);  // 50ms周期检测函数
        var pvcountOffset = 3000;  // 初始化首次数据
        var uvcountOffset = 1100;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int); // 停止检测
            }
        }
    });
</script>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!" title="返回顶部">
        <i class="fas fa-arrow-up" style="zoom: 0.88;"></i>
    </a>
</div>

    <!-- <script src="/js/fireworks.js"></script> -->
    <!-- <script src="/js/cursor.js"></script> -->
    <!-- <script src="/js/click_show_text.js"></script> -->
    <!-- <script src="/js/snow.js"></script> -->


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    
    <script>
        (function (i, s, o, g, r, a, m) {
            i["DaoVoiceObject"] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o), m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            a.charset = "utf-8";
            m.parentNode.insertBefore(a, m)
        })(window, document, "script", ('https:' == document.location.protocol ? 'https:' : 'http:') +
            "//widget.daovoice.io/widget/6984b559.js", "daovoice")
        daovoice('init', {
            app_id: "f9383031"
        });
        daovoice('update');
    </script>
    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

    <script type="text/javascript">
        var OriginTitile=document.title,st;
        document.addEventListener("visibilitychange",function(){
            document.hidden?(document.title="ヽ(●-`Д´-)ノ你要玩捉迷藏嘛",clearTimeout(st)):(document.title="(Ő∀Ő3)ノ好哦！",st=setTimeout(function(){document.title=OriginTitile},3e3))
        })
    </script>

    <!--夜晚模式-->
    <script>
        if (localStorage.getItem('dark') === '1') {
        document.body.classList.add('dark');
        }
        else if (new Date().getHours() >= 22 || new Date().getHours() < 7) {
        document.body.classList.add('dark');
        } 
        else if (matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
        }
    </script>

    <!--全屏-->
    <script src="/js/fullscreen.js" type="module"></script>
    <a onclick="switchNightMode()" id="sma">
        <i class="fa fa-moon-o" id="nightMode" aria-hidden="true"></i>
    </a><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>

</html>
