<!DOCTYPE HTML>
<html lang="zh-CN">



<head><meta name="generator" content="Hexo 3.9.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta name="baidu-site-verification" content="code-p6MPyNrcYn">
    <meta charset="utf-8">
    <meta name="keywords" content="Oracle数据库学习笔记, HTML,CSS,JavaScript,JQuery,Java,Vue,学习笔记,生活随笔">
    <meta name="description" content="关闭一扇窗，另一扇等着你打开！往事如烟，浅笑而安。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Oracle数据库学习笔记 | lskj</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>
<style type="text/css" lang="css">
    #loading-container{
        position: fixed;
        top: 0;
        left: 0;
        min-height: 100vh;
        width: 100vw;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: #FFF;
        text-align: center;
        /* loader页面消失采用渐隐的方式*/
        -webkit-transition: opacity 1s ease;
        -moz-transition: opacity 1s ease;
        -o-transition: opacity 1s ease;
        transition: opacity 1s ease;
    }
    .loading-image{
        width: 120px;
        height: 50px;
        transform: translate(-50%);
    }
    
    .loading-image div:nth-child(2) {
        -webkit-animation: pacman-balls 1s linear 0s infinite;
        animation: pacman-balls 1s linear 0s infinite
    }

    .loading-image div:nth-child(3) {
        -webkit-animation: pacman-balls 1s linear .33s infinite;
        animation: pacman-balls 1s linear .33s infinite
    }

    .loading-image div:nth-child(4) {
        -webkit-animation: pacman-balls 1s linear .66s infinite;
        animation: pacman-balls 1s linear .66s infinite
    }

    .loading-image div:nth-child(5) {
        -webkit-animation: pacman-balls 1s linear .99s infinite;
        animation: pacman-balls 1s linear .99s infinite
    }
    
   .loading-image div:first-of-type {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_up .5s 0s infinite;
        animation: rotate_pacman_half_up .5s 0s infinite;
    }
    .loading-image div:nth-child(2) {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_down .5s 0s infinite;
        animation: rotate_pacman_half_down .5s 0s infinite;
        margin-top: -50px;
    }
    @-webkit-keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @-webkit-keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

    @keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}
    
    @-webkit-keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}

    @keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}
    
   
    .loading-image div:nth-child(3),
    .loading-image div:nth-child(4),
    .loading-image div:nth-child(5),
    .loading-image div:nth-child(6){
        background-color: #49b1f5;
        width: 15px;
        height: 15px;
        border-radius: 100%;
        margin: 2px;
        width: 10px;
        height: 10px;
        position: absolute;
        transform: translateY(-6.25px);
        top: 25px;
        left: 100px;
    }
    .loading-text{
        margin-bottom: 20vh;
        text-align: center;
        color: #2c3e50;
        font-size: 2rem;
        box-sizing: border-box;
        padding: 0 10px;
        text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    @media only screen and (max-width: 500px) {
         .loading-text{
            font-size: 1.5rem;
         }
    }
    .fadeout {
        opacity: 0;
        filter: alpha(opacity=0);
    }
    /* logo出现动画 */
    @-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}
    @keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);}}
 </style>
 <script>
(function () {
    const loaded = function(){
       setTimeout(function(){
            const loader = document.getElementById("loading-container");
            loader.className="fadeout" ;//使用渐隐的方法淡出loading page
            // document.getElementById("body-wrap").style.display="flex";
            setTimeout(function(){
                loader.style.display="none";
            },1000); 
        },1000);//强制显示loading page 1s  
    };
    loaded();
})()
 </script>
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="lskj" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"><style type="text/css" lang="css">
    #loading-container{
        position: fixed;
        top: 0;
        left: 0;
        min-height: 100vh;
        width: 100vw;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: #FFF;
        text-align: center;
        /* loader页面消失采用渐隐的方式*/
        -webkit-transition: opacity 1s ease;
        -moz-transition: opacity 1s ease;
        -o-transition: opacity 1s ease;
        transition: opacity 1s ease;
    }
    .loading-image{
        width: 120px;
        height: 50px;
        transform: translate(-50%);
    }
    
    .loading-image div:nth-child(2) {
        -webkit-animation: pacman-balls 1s linear 0s infinite;
        animation: pacman-balls 1s linear 0s infinite
    }

    .loading-image div:nth-child(3) {
        -webkit-animation: pacman-balls 1s linear .33s infinite;
        animation: pacman-balls 1s linear .33s infinite
    }

    .loading-image div:nth-child(4) {
        -webkit-animation: pacman-balls 1s linear .66s infinite;
        animation: pacman-balls 1s linear .66s infinite
    }

    .loading-image div:nth-child(5) {
        -webkit-animation: pacman-balls 1s linear .99s infinite;
        animation: pacman-balls 1s linear .99s infinite
    }
    
   .loading-image div:first-of-type {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_up .5s 0s infinite;
        animation: rotate_pacman_half_up .5s 0s infinite;
    }
    .loading-image div:nth-child(2) {
        width: 0;
        height: 0;
        border: 25px solid #49b1f5;
        border-right-color: transparent;
        border-radius: 25px;
        -webkit-animation: rotate_pacman_half_down .5s 0s infinite;
        animation: rotate_pacman_half_down .5s 0s infinite;
        margin-top: -50px;
    }
    @-webkit-keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @keyframes rotate_pacman_half_up {0% {transform: rotate(270deg)}50% {transform: rotate(1turn)}to {transform: rotate(270deg)}}

    @-webkit-keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}

    @keyframes rotate_pacman_half_down {0% {transform: rotate(90deg)}50% {transform: rotate(0deg)}to {transform: rotate(90deg)}}
    
    @-webkit-keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}

    @keyframes pacman-balls {75% {opacity: .7}to {transform: translate(-100px, -6.25px)}}
    
   
    .loading-image div:nth-child(3),
    .loading-image div:nth-child(4),
    .loading-image div:nth-child(5),
    .loading-image div:nth-child(6){
        background-color: #49b1f5;
        width: 15px;
        height: 15px;
        border-radius: 100%;
        margin: 2px;
        width: 10px;
        height: 10px;
        position: absolute;
        transform: translateY(-6.25px);
        top: 25px;
        left: 100px;
    }
    .loading-text{
        margin-bottom: 20vh;
        text-align: center;
        color: #2c3e50;
        font-size: 2rem;
        box-sizing: border-box;
        padding: 0 10px;
        text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    @media only screen and (max-width: 500px) {
         .loading-text{
            font-size: 1.5rem;
         }
    }
    .fadeout {
        opacity: 0;
        filter: alpha(opacity=0);
    }
    /* logo出现动画 */
    @-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}
    @keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);}}
 </style>
 <script>
(function () {
    const loaded = function(){
       setTimeout(function(){
            const loader = document.getElementById("loading-container");
            loader.className="fadeout" ;//使用渐隐的方法淡出loading page
            // document.getElementById("body-wrap").style.display="flex";
            setTimeout(function(){
                loader.style.display="none";
            },1000); 
        },1000);//强制显示loading page 1s  
    };
    loaded();
})()
 </script>
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>





 <div id="loading-container">
     <p class="loading-text">玩命加载中 . . . </p> 
     <div class="loading-image">
         <div></div>
         <div></div>
         <div></div>
         <div></div> 
         <div></div>
     </div>
 </div><body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!--动态背景-->
    <!-- <div id="bg"><canvas></canvas><canvas></canvas><canvas></canvas></div>
    <script src="/js/canva_moving_effect.js"></script> -->

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">lskj</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/galleries" class="waves-effect waves-light">
      
      <i class="fas fa-image" style="zoom: 0.6;"></i>
      
      <span>相册</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/navigate" class="waves-effect waves-light">
      
      <i class="fas fa-location-arrow" style="zoom: 0.6;"></i>
      
      <span>导航</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <!--全屏-->
  <li id="fullscreen_li" class="fullscreen"><a href="javascript:void(0);" class="modal-trigger waves-effect waves-light"><i id="fullscreen" class="fas fa-expand-arrows-alt" title="全屏" style="zoom: 0.65;"></i></a></li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">lskj</div>
        <div class="logo-desc">
            
            关闭一扇窗，另一扇等着你打开！往事如烟，浅笑而安。
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/galleries" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-image"></i>
			
			相册
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/navigate" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-location-arrow"></i>
			
			导航
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<!-- <div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/lskjwp/image/imageCover/Oracle%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.jpg')"> -->
    <div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/13.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Oracle数据库学习笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
        background-color: rgb(255, 255, 255,0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        background: linear-gradient(to bottom right,#61B5F3 0%, #26D6D1 100%);
        width: 35px;
        height: 35px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 35px;
        position: absolute;
        right: 0px;
        /* font-size: 1.4rem; */
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Oracle/">
                                <span class="chip bg-color">Oracle</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Oracle/" class="post-category">
                                Oracle
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:
                    2021-05-27
                </div>
                

                

                <!--添加作者信息--> 
                <div class="info-break-policy"> 
                     
                        <i class="fa fa-pencil"></i> 作者: 勇也很努力
                     
                </div>

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:
                    22.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:
                    91 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>学习视频链接：<a href="https://www.bilibili.com/video/BV1kx411s71n" target="_blank" rel="noopener">B站 动力节点</a></p>
<a id="more"></a>

<p><img src="/archives/4b0e1d36/SQL%EF%BC%88%E7%BB%93%E6%9E%84%E5%8C%96%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%EF%BC%89.png" alt="SQL分类"></p>
<h1 id="简单的SQL语句"><a href="#简单的SQL语句" class="headerlink" title="简单的SQL语句"></a>简单的SQL语句</h1><blockquote>
<p>表的创建</p>
</blockquote>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> EMP<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> DEPT<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> BONUS<span class="token punctuation">;</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> SALGRADE<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DEPT
       <span class="token punctuation">(</span>DEPTNO NUMBER<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">CONSTRAINT</span> PK_DEPT <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    DNAME VARCHAR2<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
    LOC VARCHAR2<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> EMP
       <span class="token punctuation">(</span>EMPNO NUMBER<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">CONSTRAINT</span> PK_EMP <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    ENAME VARCHAR2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    JOB VARCHAR2<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    MGR NUMBER<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    HIREDATE <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    SAL NUMBER<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    COMM NUMBER<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    DEPTNO NUMBER<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">CONSTRAINT</span> FK_DEPTNO <span class="token keyword">REFERENCES</span> DEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> BONUS
    <span class="token punctuation">(</span>
    ENAME VARCHAR2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token punctuation">,</span>
    JOB VARCHAR2<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>  <span class="token punctuation">,</span>
    SAL NUMBER<span class="token punctuation">,</span>
    COMM NUMBER
    <span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> SALGRADE
      <span class="token punctuation">(</span> GRADE NUMBER<span class="token punctuation">,</span>
    LOSAL NUMBER<span class="token punctuation">,</span>
    HISAL NUMBER <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote>
<p>数据</p>
</blockquote>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> DEPT <span class="token punctuation">(</span> DEPTNO<span class="token punctuation">,</span> DNAME<span class="token punctuation">,</span> LOC <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'ACCOUNTING'</span><span class="token punctuation">,</span> <span class="token string">'NEW YORK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> DEPT <span class="token punctuation">(</span> DEPTNO<span class="token punctuation">,</span> DNAME<span class="token punctuation">,</span> LOC <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'RESEARCH'</span><span class="token punctuation">,</span> <span class="token string">'DALLAS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> DEPT <span class="token punctuation">(</span> DEPTNO<span class="token punctuation">,</span> DNAME<span class="token punctuation">,</span> LOC <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'SALES'</span><span class="token punctuation">,</span> <span class="token string">'CHICAGO'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> DEPT <span class="token punctuation">(</span> DEPTNO<span class="token punctuation">,</span> DNAME<span class="token punctuation">,</span> LOC <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">40</span><span class="token punctuation">,</span> <span class="token string">'OPERATIONS'</span><span class="token punctuation">,</span> <span class="token string">'BOSTON'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">commit</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7369</span><span class="token punctuation">,</span> <span class="token string">'SMITH'</span><span class="token punctuation">,</span> <span class="token string">'CLERK'</span><span class="token punctuation">,</span> <span class="token number">7902</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'12/17/1980 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7499</span><span class="token punctuation">,</span> <span class="token string">'ALLEN'</span><span class="token punctuation">,</span> <span class="token string">'SALESMAN'</span><span class="token punctuation">,</span> <span class="token number">7698</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'02/20/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7521</span><span class="token punctuation">,</span> <span class="token string">'WARD'</span><span class="token punctuation">,</span> <span class="token string">'SALESMAN'</span><span class="token punctuation">,</span> <span class="token number">7698</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'02/22/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">1250</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7566</span><span class="token punctuation">,</span> <span class="token string">'JONES'</span><span class="token punctuation">,</span> <span class="token string">'MANAGER'</span><span class="token punctuation">,</span> <span class="token number">7839</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'04/02/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">2975</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7654</span><span class="token punctuation">,</span> <span class="token string">'MARTIN'</span><span class="token punctuation">,</span> <span class="token string">'SALESMAN'</span><span class="token punctuation">,</span> <span class="token number">7698</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'09/28/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">1250</span><span class="token punctuation">,</span> <span class="token number">1400</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7698</span><span class="token punctuation">,</span> <span class="token string">'BLAKE'</span><span class="token punctuation">,</span> <span class="token string">'MANAGER'</span><span class="token punctuation">,</span> <span class="token number">7839</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'05/01/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">2850</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7782</span><span class="token punctuation">,</span> <span class="token string">'CLARK'</span><span class="token punctuation">,</span> <span class="token string">'MANAGER'</span><span class="token punctuation">,</span> <span class="token number">7839</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'06/09/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">2450</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7788</span><span class="token punctuation">,</span> <span class="token string">'SCOTT'</span><span class="token punctuation">,</span> <span class="token string">'ANALYST'</span><span class="token punctuation">,</span> <span class="token number">7566</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'04/19/1987 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7839</span><span class="token punctuation">,</span> <span class="token string">'KING'</span><span class="token punctuation">,</span> <span class="token string">'PRESIDENT'</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'11/17/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7844</span><span class="token punctuation">,</span> <span class="token string">'TURNER'</span><span class="token punctuation">,</span> <span class="token string">'SALESMAN'</span><span class="token punctuation">,</span> <span class="token number">7698</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'09/08/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7876</span><span class="token punctuation">,</span> <span class="token string">'ADAMS'</span><span class="token punctuation">,</span> <span class="token string">'CLERK'</span><span class="token punctuation">,</span> <span class="token number">7788</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'05/23/1987 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">1100</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7900</span><span class="token punctuation">,</span> <span class="token string">'JAMES'</span><span class="token punctuation">,</span> <span class="token string">'CLERK'</span><span class="token punctuation">,</span> <span class="token number">7698</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'12/03/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">950</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7902</span><span class="token punctuation">,</span> <span class="token string">'FORD'</span><span class="token punctuation">,</span> <span class="token string">'ANALYST'</span><span class="token punctuation">,</span> <span class="token number">7566</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'12/03/1981 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> EMP <span class="token punctuation">(</span> EMPNO<span class="token punctuation">,</span> ENAME<span class="token punctuation">,</span> JOB<span class="token punctuation">,</span> MGR<span class="token punctuation">,</span> HIREDATE<span class="token punctuation">,</span> SAL<span class="token punctuation">,</span> COMM<span class="token punctuation">,</span>
DEPTNO <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">7934</span><span class="token punctuation">,</span> <span class="token string">'MILLER'</span><span class="token punctuation">,</span> <span class="token string">'CLERK'</span><span class="token punctuation">,</span> <span class="token number">7782</span><span class="token punctuation">,</span>  TO_Date<span class="token punctuation">(</span> <span class="token string">'01/23/1982 12:00:00 上午'</span><span class="token punctuation">,</span> <span class="token string">'MM/DD/YYYY HH:MI:SS AM'</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token number">1300</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">commit</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SALGRADE <span class="token punctuation">(</span> GRADE<span class="token punctuation">,</span> LOSAL<span class="token punctuation">,</span> HISAL <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SALGRADE <span class="token punctuation">(</span> GRADE<span class="token punctuation">,</span> LOSAL<span class="token punctuation">,</span> HISAL <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1201</span><span class="token punctuation">,</span> <span class="token number">1400</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SALGRADE <span class="token punctuation">(</span> GRADE<span class="token punctuation">,</span> LOSAL<span class="token punctuation">,</span> HISAL <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1401</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SALGRADE <span class="token punctuation">(</span> GRADE<span class="token punctuation">,</span> LOSAL<span class="token punctuation">,</span> HISAL <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2001</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> SALGRADE <span class="token punctuation">(</span> GRADE<span class="token punctuation">,</span> LOSAL<span class="token punctuation">,</span> HISAL <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> 
<span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3001</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">commit</span><span class="token punctuation">;</span></code></pre>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p><strong>数据库中所有数据类型的默认值都是NULL</strong></p>
<p><strong>Oracle中的主要的数据类型：</strong></p>
<ul>
<li>字符型<ul>
<li>固定长度的字符类型，经常被定义成CHAR(N)形式，N表示占用的字节数。最大长度是2000字节。</li>
<li>变长的字符类型，定义格式是VARCHAR2(N)，N表示最多可占用的字节数，最大长度是4000字节。</li>
</ul>
</li>
<li>数值型，NUMBER</li>
<li>日期型，用于定义日期时间的数据，长度是7个字节，默认格式是DD-MON-RR，比如11-APR-17</li>
</ul>
<blockquote>
<p><strong>字符型</strong></p>
<p>VARCHAR(10)定长的字符型数据</p>
<p>CHAR(2)定长的字符型数据</p>
<p>VARCHAR2(20)变长的字符型数据</p>
<p><strong>数值型</strong></p>
<p>NUMBER(4)不带小数点的数值</p>
<p>NUMBER(8,2)数据的总长度是8位，小数点后占两位</p>
</blockquote>
<h2 id="SQL语句的书写规则"><a href="#SQL语句的书写规则" class="headerlink" title="SQL语句的书写规则"></a>SQL语句的书写规则</h2><p>SQL被称为结构化查询语言（Structured Query Language），SQL是操作和检索关系型数据库的标准语言，使用SQL语句，程序员和数据库管理员可以完成如下任务：</p>
<ul>
<li>改变数据库的结构</li>
<li>更改系统的安全设置</li>
<li>增加用户对数据库或表的许可权限</li>
<li>在数据库中检索需要的信息</li>
<li>对数据库的信息进行更新</li>
</ul>
<p><strong>Sql语句的书写规则</strong></p>
<ul>
<li>在Oracle数据库中，sql语句大小写不敏感</li>
<li>sql语句可单行或多行书写</li>
<li>在sql语句中，关键字不能跨多行或缩写</li>
<li>为了提高可读性，一般关键字大写，其它小写</li>
<li>子句通常位于独立行，便于编辑，提高可读性</li>
<li>空格和缩进是程序易读</li>
</ul>
<h2 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h2><p>在查询的过程中，对于数值型的数据，可以执行+，-，*，/运算；也可以给查询的字段起别名，有不同的方式，可以不用””，可以用””，可以用as，可以不用as。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> EMPNO 员工编号<span class="token punctuation">,</span>ENAME 员工姓名<span class="token punctuation">,</span>SAL <span class="token string">"月薪"</span><span class="token punctuation">,</span>SAL<span class="token operator">*</span><span class="token number">12</span> <span class="token string">"年薪"</span><span class="token punctuation">,</span>COMM <span class="token string">"奖金"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>SAL<span class="token operator">*</span><span class="token number">12</span> <span class="token operator">+</span> COMM<span class="token punctuation">)</span> <span class="token string">"年收入"</span> <span class="token keyword">FROM</span> EMP<span class="token punctuation">;</span></code></pre>
<p><strong>select语句中的算数表达式</strong></p>
<ul>
<li>对NUMBER型数据可以使用算数操作符创建表达式（+ - * /）</li>
<li>对DATE型数据可以使用部分算数操作符创建表达式（+ -）</li>
</ul>
<p>在算术表达式中出现NULL，得到的结果就是NULL，NULL不等于0.0</p>
<blockquote>
<p><strong>对于日期的数据可以使用+ -运算符</strong></p>
<ul>
<li><p>一个日期+-一个数值（就是+-一个天数），得到一个新的日期</p>
<pre class=" language-sq1"><code class="language-sq1">SELECT EMPNO,ENAME,HIREDATE "雇佣日期",(HIREDATE + 90) "转正日期" FROM EMP;</code></pre>
</li>
<li><p>两个日期型的数据相减，得到的是两者之间相差的天数</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--SYSDATE取得当前的日期</span>
<span class="token keyword">SELECT</span> EMPNO<span class="token punctuation">,</span>ENAME<span class="token punctuation">,</span><span class="token punctuation">(</span>SYSDATE <span class="token operator">-</span> HIREDATE<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">365</span> <span class="token string">"工作的年限"</span> <span class="token keyword">FROM</span> EMP<span class="token punctuation">;</span></code></pre>
</li>
<li><p>两个日期型的数据不能相加，日期型的数据不能进行乘除运算</p>
</li>
</ul>
</blockquote>
<p><strong>字符串的连接操作符</strong></p>
<ul>
<li>将列或字符与其它列连接</li>
<li>用双竖线表示（||）</li>
<li>产生的结果列是另一个字符表达式</li>
</ul>
<blockquote>
<p><strong>用||可以把两列或多列查询结果合并到一起</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> EMPNO<span class="token punctuation">,</span>ENAME<span class="token punctuation">,</span>EMPNO<span class="token operator">||</span>ENAME <span class="token keyword">FROM</span> EMP<span class="token punctuation">;</span></code></pre>
<p><strong>在连接表达式中出现字符数据，字符型的数据必须要使用，在连接表达式中出现null，就是原来的字符型数据</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> EMPNO <span class="token operator">||</span> <span class="token string">'的经理是'</span> <span class="token operator">||</span> MGR <span class="token string">"从属关系"</span> <span class="token keyword">FROM</span> EMP<span class="token punctuation">;</span></code></pre>
</blockquote>
<p><strong>空值的使用</strong></p>
<ul>
<li>空值是指不可用、未分配的值</li>
<li>空值不等于零或空格</li>
<li>任意类型都可以支持空值</li>
</ul>
<p><strong>空值的运算表达式</strong></p>
<ul>
<li>包括空值的任何算术表达式都等于空</li>
<li>包括空值的连接表达式等于与空字符串连接，也就是原来的字符串</li>
</ul>
<p><strong>定义字段的别名</strong></p>
<ul>
<li>改变列的标题头</li>
<li>用于表示计算结果的含义</li>
<li>作为列的别名</li>
<li>如果别名中使用特殊字符，或者是强制大小写敏感，或有空格时，都需要加双引号</li>
</ul>
<p><strong>文本字符串</strong></p>
<ul>
<li>文本字符串是一个包括在SELECT查询列表中的字符，表达式或数字</li>
<li>日期和字符型文本字符串必须用单引号括起来</li>
<li>没返回一条记录文本字符串被显示一次</li>
</ul>
<p><strong>去除单列重复的数据</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> DEPTNO <span class="token keyword">FROM</span> EMP<span class="token punctuation">;</span></code></pre>
<p><strong>去除多列重复的数据</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> JOB<span class="token punctuation">,</span>DEPTNO <span class="token keyword">FROM</span> EMP<span class="token punctuation">;</span></code></pre>
<p>DISTINCT的作用范围是后面所有字段的组合。</p>
<p><strong>使用WHERE子句对数据进行过滤</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> DEPTNO <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></code></pre>
<ul>
<li><p>对于字符型的数据和日期型的数据必须要使用<code>''</code>，字符型的数据对大小写是敏感的。</p>
</li>
<li><p>对于日期型的数据，格式是敏感的，使用日期型数据的格式是DD-MM-YYYY（日-月-年）</p>
</li>
</ul>
<blockquote>
<p><strong>Where中的字符串和日期值</strong></p>
<ul>
<li>字符串和日期要用单引号括起来</li>
<li>字符串是大小写敏感的，日期值是格式敏感的</li>
<li>缺省的日期格式是’DD-MON-YY’</li>
</ul>
</blockquote>
<p><strong>改变当前会话中的日期格式</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">session</span> <span class="token keyword">set</span> nis_date_format<span class="token operator">=</span><span class="token string">"YYYY-MM-DD HH:MI:SS"</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> HIREDATE <span class="token operator">=</span> <span class="token string">'20-2月-1981'</span>；

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> HIREDATE <span class="token operator">=</span> <span class="token string">'1980-12-17'</span><span class="token punctuation">;</span></code></pre>
<p><strong>LIKE用于字符型数据的查询，可以执行模糊查询</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> ENAME <span class="token operator">LIKE</span> <span class="token string">'%A%'</span><span class="token punctuation">;</span></code></pre>
<p><code>%</code>表示0个或多个任意的字符。</p>
<p><code>_</code>下划线表示一个字符。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> ENAMe <span class="token operator">LIKE</span> <span class="token string">'_A%'</span><span class="token punctuation">;</span></code></pre>
<p>若查询的字符型数据中含有特殊字符，例如%</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> ENAME <span class="token operator">LIKE</span> <span class="token string">'%\%%'</span> <span class="token keyword">ESCAPE</span> <span class="token string">'\'</span><span class="token punctuation">;</span></code></pre>
<p><code>ESCAPE '\'</code>指定以<code>\</code>为转义符。</p>
<p><strong>对于空值，要使用IS NULL进行比较</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> COMM <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></code></pre>
<p><strong>使用NOT运算符</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> SQL <span class="token operator">NOT</span> <span class="token operator">BETWEEN</span> <span class="token number">2000</span> <span class="token operator">AND</span> <span class="token number">3000</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> JOB <span class="token operator">NOT</span> <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'MANAGER'</span><span class="token punctuation">,</span><span class="token string">'CLERK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> COMM <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span></code></pre>
<p><strong>优先级规则（括号将跨越所有优先级规则）</strong></p>
<table>
<thead>
<tr>
<th align="center">次序</th>
<th align="center">运算符</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">所有的比较运算</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">NOT</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">AND</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">OR</td>
</tr>
</tbody></table>
<p><strong>对查询后的数据进行排序，使用ORDER BY子句</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--默认按照指定的字段升序排列</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> SAL<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--指定字段降序排序</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> SAL <span class="token keyword">ASC</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--可以按照多个字段进行排列</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> DEPTNO<span class="token punctuation">,</span>SAL<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--使用字段的别名来进行排序</span>
<span class="token keyword">SELECT</span> EMPNO<span class="token punctuation">,</span>ENAME<span class="token punctuation">,</span><span class="token punctuation">(</span>SAL <span class="token operator">*</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token string">"年薪"</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token string">"年薪"</span><span class="token punctuation">;</span></code></pre>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>函数适用于执行数据处理和复杂运算的。通过对一组数据进行一系列的运算，得到一个最终的需要输出的结果。函数通常都会有一个或多个输入，被称作函数的参数。在函数的内部对输入的参数进行逻辑计算，最终会得到一个或多个值，但是只有一个值作为函数的计算结果返回给客户。</p>
<p>函数可以出现在sql语句的各个位置，最常见的是出现在查询列表中。</p>
<blockquote>
<p>两种SQL函数</p>
</blockquote>
<ul>
<li>根据函数对多行输入数据的处理方式，函数分为单行函数和多行函数。</li>
<li>单行函数：每行作为一个输入参数，经过函数的计算得到每行的计算结果。单行函数执行的操作影响表中每一行的显示效果。<strong>每行都会得到相应的计算结果</strong></li>
<li>多行函数：对多行输入值进行计算，得到多行对应的一个结果。</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--单行函数：每次取一条记录，作为函数的参数，得到这条记录对应的单个结果</span>
<span class="token keyword">SELECT</span> ENAME<span class="token punctuation">,</span>LENGTH<span class="token punctuation">(</span>ENAME<span class="token punctuation">)</span> <span class="token keyword">FROM</span> EMP<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--多行函数：一次性把多条记录当作参数输入给函数，得到多条记录对应的单个结果</span>
<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>SAL<span class="token punctuation">)</span> <span class="token keyword">FROM</span> EMP<span class="token punctuation">;</span></code></pre>
<p>单行函数分为五中类型：</p>
<ul>
<li>字符函数</li>
<li>数字函数</li>
<li>日期函数</li>
<li>转换函数</li>
<li>其他函数</li>
</ul>
<blockquote>
<p>字符函数</p>
</blockquote>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--大小写控制函数</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EMP <span class="token keyword">WHERE</span> ENAME <span class="token operator">=</span> UPPER<span class="token punctuation">(</span><span class="token string">'smith'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--lower('Hello World') 转小写</span>
<span class="token comment" spellcheck="true">--upper('Hello World') 转大写</span>
<span class="token keyword">select</span> lower<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span> 转小写<span class="token punctuation">,</span> upper<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span> 转大写 <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--initcap: 首字母大写  </span>
<span class="token keyword">select</span> initcap<span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span> 首字符大写 <span class="token keyword">from</span> dual<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--字符控制函数  </span>
<span class="token comment" spellcheck="true">-- concat: 字符连接函数, 等同于  ||  </span>
<span class="token keyword">select</span> concat<span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span><span class="token string">' World'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">--substr:求母串中的某个子串  </span>
<span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>  
<span class="token keyword">select</span> substr<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">--length和lengthb: 字符数和字节数  </span>
<span class="token keyword">select</span> length<span class="token punctuation">(</span><span class="token string">'China'</span><span class="token punctuation">)</span> 字符数<span class="token punctuation">,</span> lengthb<span class="token punctuation">(</span><span class="token string">'China'</span><span class="token punctuation">)</span> 字节数  <span class="token keyword">from</span> dual<span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">--instr:在母串中，查找子串的位置  </span>
<span class="token keyword">select</span> instr<span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">,</span><span class="token string">'ll'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">--lpad,rpad: 左右填充,将abcd用*填充到10位  </span>
<span class="token keyword">select</span> lpad<span class="token punctuation">(</span><span class="token string">'abcd'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span> 左填充<span class="token punctuation">,</span> rpad<span class="token punctuation">(</span><span class="token string">'abcd'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span> 右填充 <span class="token keyword">from</span> dual<span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">--trim: 去掉字符串前后指定的字符  </span>
<span class="token keyword">select</span> trim<span class="token punctuation">(</span><span class="token string">'H'</span> <span class="token keyword">from</span> <span class="token string">'Hello WorldH'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">--replace:字符串替换函数  </span>
<span class="token keyword">select</span> replace<span class="token punctuation">(</span><span class="token string">'Hello Wordl'</span><span class="token punctuation">,</span><span class="token string">'l'</span><span class="token punctuation">,</span><span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span></code></pre>
<blockquote>
<p>数字函数</p>
</blockquote>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--数字函数  </span>
<span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">45.926</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> 四舍五入<span class="token punctuation">,</span> trunc<span class="token punctuation">(</span><span class="token number">45.926</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>  截断 <span class="token punctuation">,</span>mod<span class="token punctuation">(</span><span class="token number">1600</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span> 求于 <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--ROUND函数  </span>
<span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">45.923</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> 整数位<span class="token punctuation">,</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">45.923</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 十位<span class="token punctuation">,</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">45.923</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> 百位 <span class="token keyword">from</span> dual<span class="token punctuation">;</span></code></pre>
<blockquote>
<p>日期函数</p>
</blockquote>
<p><strong>日期的运算</strong></p>
<ul>
<li>日期类型的数据可以使用算数运算符进行计算</li>
<li>从日期中加或减一个数值，以得到一个新的日期结果值</li>
<li>两个日期相减以便得到它们相差多少天</li>
<li><strong>注意：日期不能加另一个日期，日期也不支持乘除运算</strong></li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--日期函数</span>
<span class="token comment" spellcheck="true">--显示当前日期</span>
<span class="token keyword">select</span> sysdate <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--显示时间部分</span>
<span class="token keyword">select</span> to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--显示昨天，今天和明天，加减数字仍未日期</span>
<span class="token keyword">select</span> sysdate<span class="token number">-1</span> 昨天<span class="token punctuation">,</span> sysdate 今天<span class="token punctuation">,</span> sysdate<span class="token operator">+</span><span class="token number">1</span> 明天 <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--两个日期相减，结果为相差的天数，查询员工信息，显示员工工龄。两个日期不能相加</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>sysdate<span class="token operator">-</span>hiredate 天 <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--查询员工信息，显示员工工龄,分别按照天，星期，月显示</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>sysdate<span class="token operator">-</span>hiredate 天<span class="token punctuation">,</span><span class="token punctuation">(</span>sysdate<span class="token operator">-</span>hiredate<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">7</span> 星期<span class="token punctuation">,</span><span class="token punctuation">(</span>sysdate<span class="token operator">-</span>hiredate<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">30</span> 月 <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--months_between:两个日期相差的月数</span>
<span class="token keyword">select</span> <span class="token punctuation">(</span>sysdate<span class="token operator">-</span>hiredate<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">30</span> 方式一<span class="token punctuation">,</span>months_between<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span>hiredate<span class="token punctuation">)</span> 方式二 <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--add_months:在指定日期上加上若干个月</span>
<span class="token keyword">select</span> add_months<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> 下个月<span class="token punctuation">,</span>add_months<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span> <span class="token string">"123个月后"</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--last_day: 某个日期当月的最后一天</span>
<span class="token keyword">select</span> last_day<span class="token punctuation">(</span>sysdate<span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--next_day:下周六</span>
<span class="token keyword">select</span> next_day<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'星期五'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--对日期进行四舍五入</span>
<span class="token keyword">select</span> <span class="token function">round</span><span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'MONTH'</span><span class="token punctuation">)</span> 月<span class="token punctuation">,</span><span class="token function">round</span><span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'YEAR'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--对日期进行截断</span>
<span class="token keyword">select</span> trunc<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'MONTH'</span><span class="token punctuation">)</span> 月<span class="token punctuation">,</span>trunc<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'YEAR'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--日期格式 </span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> hiredate<span class="token operator">=</span>to_date<span class="token punctuation">(</span><span class="token string">'1982-01-23'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre>
<p><strong>日期函数</strong></p>
<table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">months_between</td>
<td align="center">两日期相差多少月</td>
</tr>
<tr>
<td align="center">add_months</td>
<td align="center">在一个日期上加或减若干个月到新的日期</td>
</tr>
<tr>
<td align="center">next_day</td>
<td align="center">取得从当前日期开始遇到的第一个指定星期几的日期</td>
</tr>
<tr>
<td align="center">last_day</td>
<td align="center">计算指定日期所在月份的最后一天的日期</td>
</tr>
<tr>
<td align="center">round</td>
<td align="center">取得按年或月四舍五入得到的新日期</td>
</tr>
<tr>
<td align="center">trunc</td>
<td align="center">取得按年或月截取得到的新日期</td>
</tr>
</tbody></table>
<blockquote>
<p>转换函数</p>
</blockquote>
<p>转换有两种方式，隐式转换和手动转换。</p>
<p><strong>使用to_char函数将日期作为字符串显示</strong></p>
<p><code>to_char(date,'fmt')</code></p>
<ul>
<li>对于日期型的数据必须用单引号括起来，并且是大小写敏感</li>
<li>可包含任何有效的日期格式</li>
</ul>
<p>在转换日期位字符串时，日期中年，月，日，时，分，秒都需要相应的格式控制符来控制转换的显示格式。</p>
<table>
<thead>
<tr>
<th align="center">格式控制符</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">YYYY，YYY，YY</td>
<td align="center">分别代表4位，3位，2位的数字年份</td>
</tr>
<tr>
<td align="center">YEAR</td>
<td align="center">年的拼写</td>
</tr>
<tr>
<td align="center">MM</td>
<td align="center">数字月</td>
</tr>
<tr>
<td align="center">MONTH</td>
<td align="center">月份的全拼名称</td>
</tr>
<tr>
<td align="center">MON</td>
<td align="center">月份的缩写</td>
</tr>
<tr>
<td align="center">DD</td>
<td align="center">数字日</td>
</tr>
<tr>
<td align="center">DAY</td>
<td align="center">星期的全拼</td>
</tr>
<tr>
<td align="center">DY</td>
<td align="center">星期的缩写</td>
</tr>
<tr>
<td align="center">AM</td>
<td align="center">表示上午或下午</td>
</tr>
<tr>
<td align="center">HH24，HH12</td>
<td align="center">24小时制或12小时制</td>
</tr>
<tr>
<td align="center">MI</td>
<td align="center">分钟</td>
</tr>
<tr>
<td align="center">SS</td>
<td align="center">秒钟</td>
</tr>
<tr>
<td align="center">SP</td>
<td align="center">数字的拼写</td>
</tr>
<tr>
<td align="center">TH</td>
<td align="center">数字的序数词</td>
</tr>
<tr>
<td align="center">”特殊字符“</td>
<td align="center">在日期时间中加入特殊的字符</td>
</tr>
</tbody></table>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--2021/5/18 1 2021-05-18 17:24:41 下午 星期二</span>
<span class="token keyword">select</span> sysdate<span class="token punctuation">,</span>to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss am day'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">-- 查询当前日期：显示:  2021-05-18 17:26:56 今天是 星期二</span>
<span class="token keyword">select</span> to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd hh24:mi:ss "今天是"day'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span> </code></pre>
<p><strong>使用to_char函数将数字作为字符显示</strong></p>
<p><code>to_char(number,'fmt')</code></p>
<table>
<thead>
<tr>
<th align="center">9</th>
<th align="center">代表一个数字（有数字就显示，没有就不显示）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">强制显示0</td>
</tr>
<tr>
<td align="center">$</td>
<td align="center">放置一个$符</td>
</tr>
<tr>
<td align="center">L</td>
<td align="center">放置一个本地货币符</td>
</tr>
<tr>
<td align="center">.</td>
<td align="center">显示小数点</td>
</tr>
<tr>
<td align="center">,</td>
<td align="center">显示千位指示符</td>
</tr>
</tbody></table>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--查询员工信息，显示员工的编号，姓名，月薪,要求有货币代码(L)，千位符(,)，小数点(.), </span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>to_char<span class="token punctuation">(</span>sal<span class="token punctuation">,</span><span class="token string">'L9,999.99'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></code></pre>
<p><strong>to_number和to_date函数</strong></p>
<ul>
<li>使用to_number函数将字符转换为数字，<code>to_number(char[,'fmt'])</code></li>
<li>使用to_date函数将字符转换为日期，<code>to_date(char[,'fmt'])</code></li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--to_number，把字符型的数据转换为数值，字符的格式和模板的模式必须要一致</span>
<span class="token keyword">select</span> to_number<span class="token punctuation">(</span><span class="token string">'$800.00'</span><span class="token punctuation">,</span><span class="token string">'$999,999.00'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--to_date，把字符型的数据转换为日期型的数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> hiredate <span class="token operator">=</span> to_date<span class="token punctuation">(</span><span class="token string">'1981-2-20'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote>
<p>其他函数</p>
</blockquote>
<ul>
<li>和空值相关的函数</li>
<li><code>nvl(expr1,expr2)</code></li>
<li><code>nvl2(expr1,expr2,expr3)</code></li>
<li><code>nullif(expr1,expr2)</code></li>
<li><code>coalesce(expr1,expr2,...,exprn)</code></li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--在算术表达式中出现null，得到的结果就是null</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>comm<span class="token punctuation">,</span><span class="token punctuation">(</span>sal<span class="token operator">*</span><span class="token number">12</span><span class="token operator">+</span>comm<span class="token punctuation">)</span> <span class="token string">"年收入"</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></code></pre>
<p><strong>nvl函数</strong></p>
<p>将空值转换为实际的值。</p>
<p><code>nvl(comm,0)</code>如果comm字段为null，就用0替换该null</p>
<ul>
<li>数据格式可以是日期，字符，数字</li>
<li>数据类型必须匹配，否则出错<ul>
<li><code>nvl(comm,0)</code></li>
<li><code>nvl(hiredate,'01-JAN-97')</code></li>
<li><code>nvl(job,'No Job Yet')</code></li>
</ul>
</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>comm<span class="token punctuation">,</span><span class="token punctuation">(</span>sal<span class="token operator">*</span><span class="token number">12</span><span class="token operator">+</span>nvl<span class="token punctuation">(</span>comm<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token string">"年收入"</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--将7654的job和hiredate暂时改为null进行测试</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>nvl<span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token string">'还没有工作'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7654</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>hiredate<span class="token punctuation">,</span>nvl<span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span><span class="token string">'1-1月-1987'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7654</span><span class="token punctuation">;</span></code></pre>
<p><strong>nvl2函数</strong></p>
<p><code>nvl2(expr,expr1,expr2)</code></p>
<ul>
<li>如果expr不为null，返回expr1；若为null，返回expr2</li>
<li>expr可以为任何数据类型</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>nvl2<span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token string">'有工作'</span><span class="token punctuation">,</span><span class="token string">'没工作'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7654</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>nvl2<span class="token punctuation">(</span>job<span class="token punctuation">,</span>job<span class="token punctuation">,</span><span class="token string">'没工作'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></code></pre>
<p><strong>nullif</strong></p>
<p><code>nullif(expr1,expr2)</code>比较两个表达式，如果相等返回空值，如果不等返回第一个表达式。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span><span class="token keyword">nullif</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>ename<span class="token punctuation">)</span><span class="token punctuation">,</span>length<span class="token punctuation">(</span>ename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">nullif</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>ename<span class="token punctuation">)</span><span class="token punctuation">,</span>length<span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></code></pre>
<p><strong>case表达式</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--case实现if...else if...else的功能</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>
        <span class="token keyword">case</span> job
            <span class="token keyword">when</span> <span class="token string">'CLERK'</span> <span class="token keyword">then</span> <span class="token number">1.10</span> <span class="token operator">*</span> sal
            <span class="token keyword">when</span> <span class="token string">'MANAGER'</span> <span class="token keyword">then</span> <span class="token number">1.3</span> <span class="token operator">*</span> sal
            <span class="token keyword">when</span> <span class="token string">'SALESMAN'</span> <span class="token keyword">then</span> <span class="token number">1.4</span> <span class="token operator">*</span> sal
            <span class="token keyword">else</span> sal
        <span class="token keyword">end</span> <span class="token keyword">as</span> <span class="token string">"修订工资数"</span>
<span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">=</span> <span class="token string">'SMITH'</span><span class="token punctuation">;</span></code></pre>
<p><strong>decode函数</strong></p>
<p>decode函数类似于一系列case或if-then-else语句</p>
<pre><code>decode(col/expression,search1,result1
       [,search2,result2,...,]
       [,default])</code></pre><pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>esal<span class="token punctuation">,</span>
    decode<span class="token punctuation">(</span>job<span class="token punctuation">,</span><span class="token string">'CLERK'</span><span class="token punctuation">,</span>sal <span class="token operator">*</span> <span class="token number">1.10</span><span class="token punctuation">,</span>
           <span class="token string">'MANAGER'</span><span class="token punctuation">,</span>sal <span class="token operator">*</span> <span class="token number">1.30</span><span class="token punctuation">,</span>
           <span class="token string">'SALESMAN'</span><span class="token punctuation">,</span>sal <span class="token operator">*</span> <span class="token number">1.40</span><span class="token punctuation">,</span>
           sal<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"修订工资数"</span>
<span class="token keyword">from</span> emp <span class="token keyword">where</span> ename <span class="token operator">=</span> <span class="token string">'SMITH'</span><span class="token punctuation">;</span></code></pre>
<p><strong>嵌套函数</strong></p>
<ul>
<li>单行函数可被嵌入到任何层</li>
<li>嵌套函数从最深层到最低层求值</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> ename<span class="token punctuation">,</span>job<span class="token punctuation">,</span>nvl<span class="token punctuation">(</span>to_char<span class="token punctuation">(</span>job<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'还没有工作'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">"结果"</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> job <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span></code></pre>
<p><strong>分组函数</strong></p>
<p>分组函数就是多行函数。分组函数对多行输入值进行计算，得到多行对应的单行结果。在通常的情况下，会对一个表总的数据进行分组，得到多组数据，每个组中包括一行或多行数据。分组函数对每组记录分别进行计算，每组返回一个结果。最终产生多个组对应的数据集合。分组有多少，最终的结果集就有多少行。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></code></pre>
<blockquote>
<p>常用分组函数</p>
</blockquote>
<ul>
<li><code>avg([distinct|all]n)</code></li>
<li><code>count({*|[distinct|all]expr})</code></li>
<li><code>max([distinct|all]expr)</code></li>
<li><code>min([distinct|all]expr)</code></li>
<li><code>sum([distinct|all]n)</code></li>
</ul>
<p>使用avg函数可以求出一组数据的平均值，而sum可以求出一组数的总和。<strong>这两个函数都是针对数值类型的数据的</strong></p>
<p>使用max函数可以求出一组数据中的最大值，min求出最小值这两个函数可以适用于任何数据类型。对于日期类型，最早的日期被认为是最小的值；对于字符型的数据，采用ASCII码值比较的方式。</p>
<p>count函数是用于计算符合条件的数据的条数。count有两种用法：<code>count(*)</code>和<code>count(字段)</code>，并且结果可能不同。<code>count(*)</code>求出所有符合条件的记录条数；而<code>count(字符)</code>这是求出所有符合条件并且字段值是非空的记录数。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></code></pre>
<p><strong>所有的组函数都是忽略空值的</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--按照人数计算平均奖金</span>
<span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>comm<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>nvl<span class="token punctuation">(</span>comm<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span></code></pre>
<p><strong>group by子句</strong></p>
<p>除了对整个表的数据进行统计计算外，更多的需要是根据用户的实际需求对数据进行分组，然后对每个分组进行组函数计算</p>
<pre><code>select column,group_funtion
from table
[where condition]
[group by group_by_expression]
[order by column];</code></pre><ul>
<li>使用group by子句将表中的数据分成多个小组。分组后的数据执行组函数计算，结果返回给客户。最终的结果自动按照分组子分组进行升序排列</li>
<li>组函数忽略空值，可以使用nvl，nvl2，coalesce函数处理空值</li>
<li>结果集隐式按升序排列，如果需要改变排序方式可以使用order by子句</li>
</ul>
<blockquote>
<p>使用group by子句</p>
</blockquote>
<ul>
<li>出现在select列表中的字段，<strong>如果出现的位置不是在组函数中，那么必须出现在group by子句中</strong></li>
<li><strong>也可以只出现在group by子句中</strong></li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span>
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--按照多个字段进行分组</span>
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span>job<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">,</span>job <span class="token keyword">order</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--多分组后的数据进行过滤，过滤大于等于3000的记录，不能使用where子句，而是使用having子句</span>
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">group</span> <span class="token keyword">by</span> deptno <span class="token keyword">having</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">3000</span> <span class="token keyword">order</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--先使用where对数据过滤，过滤后用group by分组，分组后的数据用having在过滤</span>
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> deptno
<span class="token keyword">having</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">3000</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> deptno<span class="token punctuation">;</span></code></pre>
<p>组函数也可以嵌套，在组函数嵌套时，必须要使用group by。组函数最多能嵌套两层。</p>
<h1 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h1><p>用单个的select语句从多个表中查询相关的数据。在多表查询时，如果不加入等值条件，会产生笛卡尔乘积。</p>
<p>多表查询分为不同的标准：</p>
<ul>
<li><p>SQL1992标准</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--等值查询，在父子表的关系上，用=来连接两个表的两个字段或多个表的多个字段。</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span><span class="token punctuation">,</span>dept <span class="token number">d</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--非等值查询，两个表之间没有父子关系，用!=来连接两个表</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>sal<span class="token punctuation">,</span>s<span class="token punctuation">.</span>grade<span class="token punctuation">,</span>s<span class="token punctuation">.</span>losal<span class="token punctuation">,</span>s<span class="token punctuation">.</span>hisal
<span class="token keyword">from</span> emp <span class="token number">e</span><span class="token punctuation">,</span>salgrade s
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>sal <span class="token operator">between</span> s<span class="token punctuation">.</span>losal <span class="token operator">and</span> s<span class="token punctuation">.</span>hisal <span class="token operator">and</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--自连接，通过别名，将一个表虚拟成两个表，然后在这两个表上做等值查询</span>
<span class="token keyword">select</span>  <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span>m<span class="token punctuation">.</span>empno<span class="token punctuation">,</span>m<span class="token punctuation">.</span>ename
<span class="token keyword">from</span> emp <span class="token number">e</span><span class="token punctuation">,</span>emp m
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>mgr <span class="token operator">=</span> m<span class="token punctuation">.</span>empno <span class="token operator">and</span> <span class="token number">e</span><span class="token punctuation">.</span>empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--外连接：在等值查询的基础之上，可以查询不满足等值条件的数据</span>
<span class="token comment" spellcheck="true">--左外连接，可以把右边的表中不满足等值条件的数据查询出来</span>
<span class="token keyword">select</span>  <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span><span class="token punctuation">,</span>dept <span class="token number">d</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token keyword">select</span>  <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span><span class="token punctuation">,</span>dept <span class="token number">d</span>
<span class="token keyword">where</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--右外连接，可以把左边表中不满足等值条件的数据查询出来</span>
<span class="token keyword">select</span>  <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span><span class="token punctuation">,</span>dept <span class="token number">d</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span>  <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span><span class="token punctuation">,</span>dept <span class="token number">d</span>
<span class="token keyword">where</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--+号不能出现在=号两边</span></code></pre>
</li>
<li><p>SQL1999标准</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--交叉连接，相当于sql92标准等值查询时没有给出正确的等值条件，会产生笛卡尔乘积</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">cross</span> <span class="token keyword">join</span> dept <span class="token number">d</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--自然连接：在父子表关系上，自动的匹配两个表中列名完整相同的字段（参照列），在这些相同名称的字段上做等值查询</span>
<span class="token comment" spellcheck="true">--参照列上不能使用前缀</span>
<span class="token comment" spellcheck="true">--自然连接的缺陷：1、会把所有的参照列都作为等值条件；2、如果参照列的类型不同，查询会报错</span>
<span class="token comment" spellcheck="true">--当两个表中没有参照列时，自然查询会产生笛卡尔乘积</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">natural</span> <span class="token keyword">join</span> dept <span class="token number">d</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--join...using，在自然连接的基础上，加以改进，使用指定的参照列来作为等值条件</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">join</span> dept <span class="token number">d</span> <span class="token keyword">using</span><span class="token punctuation">(</span>deptno<span class="token punctuation">)</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--join...on，使用on里面指定的条件作为查询条件（on里面的条件可以是任意条件）</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">join</span> dept <span class="token number">d</span> <span class="token keyword">on</span> <span class="token punctuation">(</span><span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--使用join...on做n个表的等值查询，需要n-1个join...on子句</span>

<span class="token comment" spellcheck="true">--使用join...on做非等值查询</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span>s<span class="token punctuation">.</span>grade<span class="token punctuation">,</span>s<span class="token punctuation">.</span>losal<span class="token punctuation">,</span>s<span class="token punctuation">.</span>hisal
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">join</span> salgrade s <span class="token keyword">on</span> <span class="token punctuation">(</span><span class="token number">e</span><span class="token punctuation">.</span>sal <span class="token operator">between</span> s<span class="token punctuation">.</span>losal <span class="token operator">and</span> s<span class="token punctuation">.</span>hisal<span class="token punctuation">)</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--outer join ...on 外连接</span>
<span class="token comment" spellcheck="true">--left outer join ...on() 可以把左边表种不满足等值条件的数据查询出来</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> dept <span class="token number">d</span> <span class="token keyword">on</span> <span class="token punctuation">(</span><span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> dept <span class="token number">d</span>
<span class="token keyword">left</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> emp <span class="token number">e</span> <span class="token keyword">on</span> <span class="token punctuation">(</span><span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--right outer join ...on()可以把右边表中不满足等值条件的数据查询处理啊</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">right</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> dept <span class="token number">d</span> <span class="token keyword">on</span> <span class="token punctuation">(</span><span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> dept <span class="token number">d</span>
<span class="token keyword">right</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> emp <span class="token number">e</span> <span class="token keyword">on</span> <span class="token punctuation">(</span><span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--full outer join ...on()可以把左右两边表中不满足等值条件的数据查询出来</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">,</span><span class="token number">d</span><span class="token punctuation">.</span>dname
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">full</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> dept <span class="token number">d</span> <span class="token keyword">on</span> <span class="token punctuation">(</span><span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
</ul>
<p><strong>使用union把两个结果集合并成一个结果集</strong>，两个查询语句的结果集必须要一致才能合并。</p>
<ul>
<li>结果集一致指的是查询字段的个数、字段的类型，字段的顺序必须要一致。</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--使用查询语句来创建表（复制表及其数据，但是并没有复制主外键）</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> dept_bak
<span class="token keyword">as</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--union，会去除重复的数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept_bak
<span class="token keyword">union</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--union all，不会去除重复的数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept_bak
<span class="token keyword">union</span> <span class="token keyword">all</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span></code></pre>
<blockquote>
<p>子查询</p>
</blockquote>
<p>子查询的分类，就是根据子查询的返回结果来区分的</p>
<ul>
<li><p>单行子查询：返回单行，使用单行比较运算符</p>
</li>
<li><p>多行子查询：返回多行，使用多行比较运算符</p>
<p>any和all一般不单独使用，通常是和”&gt;“或”&lt;”搭配使用</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">in</td>
<td align="center">等于列表中的任何值</td>
</tr>
<tr>
<td align="center">any</td>
<td align="center">将值与子查询返回的任意一个值进行比较</td>
</tr>
<tr>
<td align="center">all</td>
<td align="center">比较子查询返回的每一个值</td>
</tr>
</tbody></table>
</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--查询比7566员工的工资高的人的信息</span>
<span class="token comment" spellcheck="true">--为了给主查询提供条件，而首先执行的一个查询，被称为子查询（子查询是用来给主查询提供查询条件的）</span>
<span class="token comment" spellcheck="true">--子查询通常出现在比较运算符的右边，并且用()包围起来，便于理解</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp
<span class="token keyword">where</span> sal <span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7566</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--单行单列子查询，要使用单行比较运算符</span>
<span class="token comment" spellcheck="true">--子查询中使用了组函数，但是子查询的结果依旧是单行单列，仍然可以使用单行比较操作符</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp
<span class="token keyword">where</span> sal <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span>  emp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--单行多列子查询</span>
<span class="token keyword">select</span> mgr<span class="token punctuation">,</span>job <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">6379</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--子查询返回的结果是多行单列，就不能使用单行比较操作符</span>
<span class="token comment" spellcheck="true">--多行单列子查询，要使用多行比较运算符，in\all\any</span>
<span class="token comment" spellcheck="true">--使用in运算符</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>job<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>sal
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>job <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> job <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--使用all运算符</span>
<span class="token comment" spellcheck="true">--> all，大于子查询的最大值</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>sal <span class="token operator">></span> <span class="token keyword">all</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--&lt; all，小于子查询的最小值</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>sal <span class="token operator">&lt;</span> <span class="token keyword">all</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--any</span>
<span class="token comment" spellcheck="true">--> any，大于子查询的最小值</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>sal <span class="token operator">></span> <span class="token keyword">any</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--&lt; any，小于子查询的最大值</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>sal <span class="token operator">&lt;</span> <span class="token keyword">any</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--多行多列子查询</span>
<span class="token keyword">select</span> mgr<span class="token punctuation">,</span>job <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7566</span> <span class="token operator">or</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--成对的比较</span>
<span class="token comment" spellcheck="true">--查询和7566，7369同经理同职位的员工的信息</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>mgr<span class="token punctuation">,</span>job
<span class="token keyword">from</span> emp
<span class="token keyword">where</span> <span class="token punctuation">(</span>mgr<span class="token punctuation">,</span>job<span class="token punctuation">)</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> mgr<span class="token punctuation">,</span>job <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7566</span> <span class="token operator">or</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">)</span>
<span class="token operator">and</span> empno <span class="token operator">!=</span> <span class="token number">7566</span> <span class="token operator">and</span> empno <span class="token operator">!=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--非成对的比较，把多行多列的子查询拆分成两个多行单列的子查询，分别使用in运算</span>
<span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename<span class="token punctuation">,</span>mgr<span class="token punctuation">,</span>job
<span class="token keyword">from</span> emp
<span class="token keyword">where</span> mgr <span class="token operator">in</span><span class="token punctuation">(</span><span class="token keyword">select</span> mgr <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7566</span> <span class="token operator">or</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">)</span>
<span class="token operator">and</span> job <span class="token operator">in</span><span class="token punctuation">(</span><span class="token keyword">select</span> job <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7566</span> <span class="token operator">or</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">)</span>
<span class="token operator">and</span> empno <span class="token operator">!=</span> <span class="token number">7566</span> <span class="token operator">and</span> empno <span class="token operator">!=</span> <span class="token number">7369</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--子查询出现在having中</span>
<span class="token comment" spellcheck="true">--having对分组后的数据进行过滤</span>
<span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span>
<span class="token keyword">from</span> emp
<span class="token keyword">group</span> <span class="token keyword">by</span> deptno
<span class="token keyword">having</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--子查询出现在form后面，用来提供数据源的，子查询被虚拟成一个表</span>
<span class="token keyword">select</span> 部门编号<span class="token punctuation">,</span>maxsal<span class="token punctuation">,</span>avgsal
<span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> deptno 部门编号<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> maxsal<span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> minsal<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> avgsal<span class="token punctuation">,</span><span class="token function">sum</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> sumsal
      <span class="token keyword">from</span> emp
     <span class="token keyword">where</span> deptno <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>
     <span class="token keyword">group</span> <span class="token keyword">by</span> deptno<span class="token punctuation">)</span>
<span class="token keyword">where</span> 部门编号 <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></code></pre>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>把多个相关的操作捆绑成一个逻辑单元，要么全都成功，要么全都失败。</p>
<ul>
<li><p>事务开始于第一个操作</p>
</li>
<li><p>事务结束于</p>
<ul>
<li>提交结束，所有的操作都成功；回滚结束，所有的操作都失败，回滚到事务开始之前的状态。</li>
<li>DDL或DCL语句（隐式的提交事务）</li>
<li>用户连接异常，或者用户断开连接（隐式回滚）</li>
<li>系统崩溃（隐式的回滚）</li>
</ul>
</li>
<li><p>事务会在多种情况下结束。通常应该由产生事务的用户回话通过命令显示的控制事务的结束（commit和rollback），这样可以保证事务中数据改变的可控性。</p>
</li>
<li><p>除了用户直接控制事务外，其它的情况会隐式的结束事务。由于隐式结束事务的不可预料性，应尽量避免隐式的结束事务。</p>
</li>
</ul>
<p><strong>commit和rollback的优点</strong></p>
<p>oracle中控制事务的主要命令是commit和rollback命令，还有一个辅助的savepoint命令。</p>
<p>使用commit和rollback来控制事务，有如下的好处</p>
<ul>
<li>保证数据一致性，修改过的数据（不一致的数据）在没有提交之前其它的用户是不能看到的</li>
<li>在数据永久生效前重新查看修改的数据</li>
<li>将相关的操作组织在一起。一个事务中的相关数据改变或者全部成功，或者全部失败</li>
</ul>
<p><strong>事务的自动处理</strong></p>
<ul>
<li><p>使用commit和rollback命令可以显示的控制事务的结束。另外在一些时候，事务也会隐式的结束。隐式结束事务有两种方式：隐式提交和隐式回滚</p>
</li>
<li><p>当下列情况发生时，事务自动隐式提交：</p>
<ul>
<li>执行一个DDL语句</li>
<li>执行一个DCL语句</li>
<li>从SQL*Plus正常退出</li>
</ul>
</li>
<li><p>当从SQL*Plus中强行退出，客户端到服务器端的连接异常中断，或系统失败时，事务自动隐式回滚</p>
</li>
</ul>
<p><strong>回退到指定的标记点上</strong></p>
<ul>
<li>通过存储点在当前的事务中创建标记点</li>
<li>可回退到存储点指定的标记点</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--在事务中使用标记点</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">'人事部'</span><span class="token punctuation">,</span><span class="token string">'NEW YORK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">savepoint</span> <span class="token number">a</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">savepoint</span> <span class="token number">b</span><span class="token punctuation">;</span>
<span class="token keyword">update</span> dept <span class="token keyword">set</span> dname <span class="token operator">=</span> <span class="token string">'销售部'</span> <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
<span class="token keyword">rollback</span> <span class="token keyword">to</span> <span class="token number">b</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
<span class="token keyword">rollback</span> <span class="token keyword">to</span> <span class="token number">a</span><span class="token punctuation">;</span></code></pre>
<h1 id="DML语句"><a href="#DML语句" class="headerlink" title="DML语句"></a>DML语句</h1><p>DML语句，会引起数据库中发生一个事务。</p>
<p><strong>插入语句</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--第一个执行的DML语句会引起事务</span>
<span class="token comment" spellcheck="true">--在事务没有结束之前，只有当前用户可以看到对数据库的修改操作，其它用户是看不到的</span>
<span class="token comment" spellcheck="true">--事务可以以回滚的方式结束，所有的操作被放弃，回滚到事务开始之前的状态</span>
<span class="token comment" spellcheck="true">--事务也可以以提交的方式结束，对数据库的修改被永久的保存，其它用户可以看到被修改的数据</span>

<span class="token comment" spellcheck="true">--插入数据时，不指定插入的字段，则表示要插入全部的字段</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept<span class="token punctuation">(</span>deptno<span class="token punctuation">,</span>dname<span class="token punctuation">,</span>loc<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token string">'销售部'</span><span class="token punctuation">,</span><span class="token string">'NEW YORK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--回滚</span>
<span class="token keyword">rollback</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--提交</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--一次性插入多条数据（复制表中的数据，把查询结果当作数据插入到表中）</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept_bak <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept<span class="token punctuation">;</span></code></pre>
<p><strong>更新语句</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--使用update语句时，在事务没有结束之前，该条数据会被锁住，其它的用户无法修改这条数据</span>
<span class="token comment" spellcheck="true">--事务结束之后，该条数据的锁被放开，其它用户才可以操作这条数据</span>
<span class="token keyword">update</span> dept <span class="token keyword">set</span> dname <span class="token operator">=</span> <span class="token string">'人事部'</span><span class="token punctuation">,</span>loc <span class="token operator">=</span> <span class="token string">'DALLAS'</span> <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></code></pre>
<p><strong>删除语句</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></code></pre>
<p><strong>合并语句</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">MERGE</span> <span class="token keyword">INTO</span> table_name alias1 
<span class="token keyword">USING</span> <span class="token punctuation">(</span><span class="token keyword">table</span><span class="token operator">|</span><span class="token keyword">view</span><span class="token operator">|</span>sub_query<span class="token punctuation">)</span> alias2
<span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token keyword">join</span> condition<span class="token punctuation">)</span> 
<span class="token keyword">WHEN</span> <span class="token keyword">MATCHED</span> <span class="token keyword">THEN</span> 
 <span class="token keyword">UPDATE</span> table_name 
 <span class="token keyword">SET</span> col1 <span class="token operator">=</span> col_val1<span class="token punctuation">,</span> 
   col2 <span class="token operator">=</span> col_val2 
<span class="token keyword">WHEN</span> <span class="token operator">NOT</span> <span class="token keyword">MATCHED</span> <span class="token keyword">THEN</span> 
 <span class="token keyword">INSERT</span> <span class="token punctuation">(</span>column_list<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>column_values<span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre>
<p>根据条件在表中执行修改或插入数据的功能，如果插入的数据行在目的表中存在就执行update，如果不存在则执行insert。</p>
<ul>
<li>避免了单独的修改</li>
<li>增强性能和应用性</li>
<li>在数据仓库应用程序中尤为有用</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">merge</span> <span class="token keyword">into</span> dept_back <span class="token number">d</span>
<span class="token keyword">using</span> dept s
<span class="token keyword">on</span><span class="token punctuation">(</span><span class="token number">d</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> s<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span>
<span class="token keyword">when</span> <span class="token keyword">matched</span> <span class="token keyword">then</span>
    <span class="token keyword">update</span> <span class="token keyword">set</span>
        <span class="token number">d</span><span class="token punctuation">.</span>dname <span class="token operator">=</span> s<span class="token punctuation">.</span>sname<span class="token punctuation">,</span>
        <span class="token number">d</span><span class="token punctuation">.</span>loc <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>loc
<span class="token keyword">when</span> <span class="token operator">not</span> <span class="token keyword">matched</span> <span class="token keyword">then</span>
    <span class="token keyword">insert</span> <span class="token keyword">values</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span>s<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>s<span class="token punctuation">.</span>loc<span class="token punctuation">)</span></code></pre>
<h1 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h1><p>创建表，必须具有</p>
<ul>
<li>创建表的权限</li>
<li>足够的存储区域</li>
</ul>
<blockquote>
<p>数据类型</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">数据类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">varchar2(size)</td>
<td align="center">可变长字符串</td>
</tr>
<tr>
<td align="center">char(size)</td>
<td align="center">定长字符串</td>
</tr>
<tr>
<td align="center">number(p.s)</td>
<td align="center">数字值</td>
</tr>
<tr>
<td align="center">date</td>
<td align="center">日期值</td>
</tr>
<tr>
<td align="center">long</td>
<td align="center">变长度的字符串，最大字节数可达2GB</td>
</tr>
<tr>
<td align="center">clob</td>
<td align="center">单位字符串数据最大字节数4G</td>
</tr>
<tr>
<td align="center">raw and long raw</td>
<td align="center">存储二进制数据的可变长度字符串</td>
</tr>
<tr>
<td align="center">blob</td>
<td align="center">二进制数据，最大字节数4G</td>
</tr>
<tr>
<td align="center">bfile</td>
<td align="center">二进制数据外部存储，最大字节数4G</td>
</tr>
</tbody></table>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--建表语句</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>
    sid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    sname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    grade <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sex char<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">'男'</span><span class="token punctuation">,</span>
    birthday <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--插入数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">,</span><span class="token string">'1班'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'12-8月-1987'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>grade<span class="token punctuation">,</span>birthday<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'test02'</span><span class="token punctuation">,</span><span class="token string">'2班'</span><span class="token punctuation">,</span>to_date<span class="token punctuation">(</span><span class="token string">'1987-12-8'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span></code></pre>
<p>在不影响数据的情况下，对表做出修改，对表的修改主要是对字段的修改。</p>
<p><strong>主要的操作：</strong></p>
<blockquote>
<p>1、添加字段。添加字段，总是可以成功，新添加的字段出现在表的最后面。</p>
</blockquote>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">add</span> tel varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote>
<p>2、修改字段（修改字段的类型，修改字段的长度）。在该字段没有数据的时候，字段的类型、字段的长度都是可以修改的。</p>
</blockquote>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">modify</span> tel <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>对于缺省值的修改，不会影响已经存在的数据，只会对以后插入的数据产生影响。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">modify</span> sex char<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">'女'</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>grade<span class="token punctuation">,</span>birthday<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'test03'</span><span class="token punctuation">,</span><span class="token string">'1班'</span><span class="token punctuation">,</span>to_date<span class="token punctuation">(</span><span class="token string">'1987-12-8'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>当该字段有数据时，字段的类型是不能修改的。字段的长度是可以修改的，增大总是可以的，减小时需要看数据的实际长度。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">modify</span> grade varchar2<span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote>
<p>3、删除字段，将该字段下的所有数据一并删除。</p>
</blockquote>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> student <span class="token keyword">drop</span> <span class="token keyword">column</span> tel<span class="token punctuation">;</span></code></pre>
<p><strong>在建表时使用子查询</strong></p>
<p>语法：</p>
<pre><code>create table table_name 
    [column(,column...)]
as
subquery;</code></pre><ul>
<li>新建的字段列表必须与子查询中的字段列表匹配</li>
<li>字段列表可以省略</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> student_bak
<span class="token keyword">as</span>
<span class="token keyword">select</span> sid<span class="token punctuation">,</span>sname <span class="token keyword">from</span> student<span class="token punctuation">;</span></code></pre>
<p><strong>删除表的数据</strong></p>
<p>在删除数据的时候，可以使用delete语句，但是效率不高。</p>
<blockquote>
<p>truncate table比delete删除速度快，但是该命令需慎用</p>
</blockquote>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">truncate</span> <span class="token keyword">table</span> table_name<span class="token punctuation">;</span></code></pre>
<ul>
<li>清除表中所有的记录</li>
<li>是DDL语句，不可以回滚，而delete语句可以回滚</li>
<li>释放表的存储空间，delete命令不释放空间</li>
</ul>
<p><strong>删除表</strong></p>
<ul>
<li>表中所有的数据将被删除</li>
<li>没有完成的事务被提交</li>
<li>所有相关的索引被删除</li>
<li>不能回退</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> table_name<span class="token punctuation">;</span></code></pre>
<p><strong>改变对象的名称</strong></p>
<ul>
<li>在Oracle中，对象的名称可以方便的进行修改。通过一个DDL语句的<code>rename</code>命令可以改变一个数据库对象的名称</li>
<li>使用<code>rename</code>语句改变对象名称，可以修改表、视图、序列或同义词的名称</li>
<li>必须是对象的所有者，即使是DBA也不可以</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">rename</span> old_name <span class="token keyword">to</span> new_name<span class="token punctuation">;</span>

tename student <span class="token keyword">to</span> student_new<span class="token punctuation">;</span></code></pre>
<p><strong>约束</strong></p>
<p>约束是在表上强制执行的数据校验规则，被插入，修改或删除的数据必须符合相关字段上设置的这些校验条件，也就是约束条件。</p>
<p>约束条件可以时构建在一个表的单个字段上，也可以构建在一个表的多个字段上。</p>
<p>当表中数据有相互依赖性时，可以保护相关的数据不被删除。</p>
<p>Oracle支持下面5类完整性约束：</p>
<ul>
<li>not null非空</li>
<li>unique key唯一键</li>
<li>primary key主键</li>
<li>foreign key外键</li>
<li>check 检察</li>
</ul>
<p>约束必须要建立在表上，但是约束时一个独立的数据库对象，没有表，也就没有约束。</p>
<p>创建约束的操作，可以在建表时把约束创建处理，也可以在建好表之后，通过alter table来给表添加约束。</p>
<p>约束也是一个独立的数据库对象，也需要命名，有两种方式：</p>
<p>1、给约束取名。</p>
<p>2、让oracle给约束取名。</p>
<p>非空约束，是唯一个可以定义在列级的约束（只能看守一个字段），确保该字段的数据不能为空。</p>
<p>除了主键约束外，一个表中可以同时存在多种相同类型的约束。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>
    sid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    sname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    grade <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    sex char<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">'男'</span><span class="token punctuation">,</span>
    birthday <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><strong>唯一约束，保证该字段的数据不能重复，或字段组合不能重复，但是可以为null</strong></p>
<p>一个表中也可以同时存在多个唯一约束。</p>
<p>唯一约束可以作用在单个字段上（称为列级约束）</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>
    sid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    sname varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    email varhcar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    constraints email_uni <span class="token keyword">unique</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">,</span><span class="token string">'test@qq.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">,</span><span class="token string">'test2@qq.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><strong>唯一约束也可以同时作用在多个字段上（称为表级约束）</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>
    sid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    first_name varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    last_name varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    constraints name_uni <span class="token keyword">unique</span> <span class="token punctuation">(</span>first_name<span class="token punctuation">,</span>last_name<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'02'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'01'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><strong>主键约束：从功能上说，相当于非空且唯一</strong></p>
<p>通过主键可以唯一确定一条记录。</p>
<p>在一个表中只能有一个主键约束。</p>
<p>一个实体中什么样的数据可以被确定为主键？</p>
<p>不要使用实体的业务数据来当作主键，因为业务数据是可以编号的，应该用一个和实体无关的流水号来当作表的主键。</p>
<p>主键约束作用在单个字段上。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>
    sid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sname varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    constraints pk_stu <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>sid<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>主键约束同时作用在多个字段上。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> student<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>
    first_name varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    last_name varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    grade varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    constraints pk_stu <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>first_name<span class="token punctuation">,</span>last_name<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'01'</span><span class="token punctuation">,</span><span class="token string">'java'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'02'</span><span class="token punctuation">,</span><span class="token string">'python'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'java'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'02'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'java'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'c++'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'javascript'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token string">'java'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><strong>外键约束</strong></p>
<p>一对多（多对一）用主外键来实现。</p>
<p>外键约束可以重复，可以为null。</p>
<p>外键约束关系到两个表的两个字段之间的关系。</p>
<p>在外键约束下，在建表时，须先建立父表，在建立.子表。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> dept1<span class="token punctuation">(</span>
    deptno number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    dname varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> empl1<span class="token punctuation">(</span>
    empno number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    ename varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    job varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dept_no number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    constraints fk_emp <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>dept_no<span class="token punctuation">)</span> <span class="token keyword">references</span> dept1 <span class="token punctuation">(</span>deptno<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>在外键约束下，在添加数据时，要先添加父表数据，后添加子表数据。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> dept1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'人事部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'销售部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> dept1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'研发部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> empl1 <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">,</span><span class="token string">'销售员'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> empl1 <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'test02'</span><span class="token punctuation">,</span><span class="token string">'工程师'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> empl1 <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'test03'</span><span class="token punctuation">,</span><span class="token string">'人事经理'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> empl1 <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'test04'</span><span class="token punctuation">,</span><span class="token string">'销售员'</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>在外键约束下，删除数据时，要先删除子表数据，后删除父表数据。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> empl1 <span class="token keyword">where</span> dept_no <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> <span class="token keyword">from</span> dept1 <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></code></pre>
<p>在外键约束下，删除表时，要先删除子表，后删除父表。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> empl1<span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> dept1<span class="token punctuation">;</span></code></pre>
<p>父表中的什么样的字段可以被其它表引为外键？<br>父表中的主键或唯一键可以被其他表作为外键。</p>
<p>在建立好表之后，通过alter table给表添加约束。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--一对一，用主外键来实现，在外键上同时设置唯一约束</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> card<span class="token punctuation">(</span>
    cid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    cname varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> person<span class="token punctuation">(</span>
    pid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    pname varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    constraints fk_per_card <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>cid<span class="token punctuation">)</span> <span class="token keyword">references</span> card<span class="token punctuation">(</span>cid<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">constraint</span> cid_uni <span class="token keyword">unique</span> <span class="token punctuation">(</span>cid<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> card <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'身份证'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> card <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'身份证'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> card <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> card <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'test02'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment" spellcheck="true">--多对多关系的实现，要引入关系表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> student<span class="token punctuation">(</span>
    sid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    sname varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> course<span class="token punctuation">(</span>
    cid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    cname varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--1、关系表中可以用上面两个表中的主键当作外键，同时又把外键当作联合主键</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> stu_cour<span class="token punctuation">(</span>
    sid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">constraint</span> fk1 foregin <span class="token keyword">key</span> <span class="token punctuation">(</span>sid<span class="token punctuation">)</span> <span class="token keyword">references</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">constraint</span> fk2 foregin <span class="token keyword">key</span> <span class="token punctuation">(</span>cid<span class="token punctuation">)</span> <span class="token keyword">references</span> course<span class="token punctuation">(</span>cid<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">constraint</span> pk_stu_cour <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>sid<span class="token punctuation">,</span>cid<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--2、关系表中可以用上面两个表中的主键当作外键，关系表中有自己独立的主键</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> stu_cour<span class="token punctuation">(</span>
    scid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
    sid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cid number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">constraint</span> fk1 foregin <span class="token keyword">key</span> <span class="token punctuation">(</span>sid<span class="token punctuation">)</span> <span class="token keyword">references</span> student <span class="token punctuation">(</span>sid<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">constraint</span> fk2 foregin <span class="token keyword">key</span> <span class="token punctuation">(</span>cid<span class="token punctuation">)</span> <span class="token keyword">references</span> course<span class="token punctuation">(</span>cid<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'test01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'test02'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'test03'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'java'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> stu_cour <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> stu_cour <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> stu_cour <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h1 id="数据库对象"><a href="#数据库对象" class="headerlink" title="数据库对象"></a>数据库对象</h1><table>
<thead>
<tr>
<th align="center">对象名称</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">表</td>
<td align="center">基本的数据存储对象，以行和列的形式存在</td>
</tr>
<tr>
<td align="center">约束</td>
<td align="center">执行数据校验，保证数据完整性的对象</td>
</tr>
<tr>
<td align="center">视图</td>
<td align="center">一个或多个表数据的显示</td>
</tr>
<tr>
<td align="center">索引</td>
<td align="center">用于提高查询的速度</td>
</tr>
<tr>
<td align="center">同义词</td>
<td align="center">对象的别名</td>
</tr>
</tbody></table>
<p><strong>数据库对象的命名规则</strong></p>
<ul>
<li>必须以字母开头</li>
<li>可包括数字（0-9），字母（a-z）和三个特殊字符（# _ $)</li>
<li>不要使用oracle的保留字</li>
<li>同一用户下的对象不能同名，即使是不同的对象类型</li>
</ul>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>什么是索引？</p>
<ul>
<li>方案（schema）中的一个数据库对象</li>
<li>在Oracle数据库中用来加速对表的查询</li>
<li>通过使用快速路径访问方法快速定位数据，减少了磁盘的I/O</li>
<li>索引是独立的数据库对象，并不与表存储在一起，而是与表独立存放</li>
<li>索引记录了表的索引字段的值，也就是关键字，关键字始终与表的索引字段值相同，这种同步由Oracle数据库自动维护</li>
</ul>
<p><strong>创建索引有两种方式</strong>：</p>
<ul>
<li><p>自动创建：Oracle会自动为主键和唯一键创建索引</p>
<p>自动创建的索引是无法手动删除的，但是在删除主键约束、唯一约束时，对应的索引会被自动的删除。</p>
</li>
<li><p>手动创建约束，表中什么样的字段应该添加索引</p>
<p>查询时，经常被用来作为查询条件的字段，应该添加索引</p>
</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--创建索引</span>
<span class="token keyword">create</span> <span class="token keyword">index</span> ename_index <span class="token keyword">on</span> emp <span class="token punctuation">(</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--删除索引</span>
<span class="token keyword">drop</span> <span class="token keyword">index</span> ename_index<span class="token punctuation">;</span></code></pre>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图也就是虚表，实际上是一个命名的查询，用于改变数据的显示形式，简化查询。访问视图与表的访问方式是一样的。</p>
<p>任何有效的查询语句，无论是多么复杂，都可以被创建成一个视图。</p>
<p><strong>视图的好处</strong>：</p>
<ul>
<li>可以限制对数据的访问，让用户通过视图可以看到表中的一部分数据</li>
<li>可以使复杂的查询变得简单</li>
<li>提供了数据的独立性，用户不用知道数据来源于哪</li>
<li>提供了对相同数据的不同显示</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">view</span> emp_view
<span class="token keyword">as</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--在子查询中使用别名创建视图</span>
<span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">view</span> emp_v
<span class="token punctuation">(</span>empno_v<span class="token punctuation">,</span>ename_v<span class="token punctuation">,</span>job_v<span class="token punctuation">,</span>年薪<span class="token punctuation">)</span>
<span class="token keyword">as</span>
<span class="token keyword">select</span>  <span class="token number">e</span><span class="token punctuation">.</span>empno<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>ename<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>job<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span>sal<span class="token operator">*</span><span class="token number">12</span> <span class="token keyword">as</span> <span class="token string">"年薪"</span>
<span class="token keyword">from</span> emp <span class="token number">e</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--在视图中的列名使用的是子查询中列的别名</span>
<span class="token comment" spellcheck="true">--在create view语句中字段与子查询中的字段必须匹配</span>
<span class="token comment" spellcheck="true">--在create view语句中字段与子查询中的字段必须匹配</span></code></pre>
<p>删除视图，会影响原来的数据吗？</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">view</span> emp_view<span class="token punctuation">;</span></code></pre>
<p>视图是一个（虚）表，对表插入数据，也可以对视图插入数据。</p>
<p>对视图插入数据，数据会被插入到源表中。</p>
<p><strong>禁止对视图执行DML操作</strong></p>
<ul>
<li><p>通过设置with read only选项可以禁止对视图执行DML操作</p>
</li>
<li><p>当用户禁止对视图操作后，任何对视图执行的DML操作都将导致Oracle错误</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">view</span> v_empinfo
<span class="token keyword">as</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> sal <span class="token operator">></span> <span class="token number">2000</span>
<span class="token keyword">with</span> <span class="token keyword">read</span> only<span class="token punctuation">;</span></code></pre>
</li>
</ul>
<blockquote>
<p>TON—P分析法</p>
</blockquote>
<p>行内视图，就是出现在from后面的子查询，也就是一个视图，但是该视图没有命名，不会在数据库中保存</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--查询工资最高的前三个人的信息，这种方式被称为TOP-N分析法</span>
<span class="token keyword">select</span> rownum<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span>
<span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token keyword">order</span> <span class="token keyword">by</span> sal <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token number">e</span>
<span class="token keyword">where</span> rownum <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span></code></pre>
<p><strong>rownum只能适用于&lt;=的情况，不能适用于&gt;=的情况。</strong></p>
<p>数据的插入顺序决定了查询数据时的顺序，也就是决定了rownum的顺序。</p>
<p>（1）rownum对于等于某值的查询条件</p>
<p>如果希望找到学生表中第一条学生的信息，可以使用rownum=1作为条件。但是想找到学生表中第二条学生的信息，使用rownum=2结果查不到数据。因为rownum都是从1开始，但是1以上的自然数在rownum做等于判断时认为都是false条件，所以无法查到rownum=n（n&gt;1的自然数）。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--可以查到数据</span>
<span class="token keyword">select</span> rownum<span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> student t <span class="token keyword">where</span> rownum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--查询不到数据</span>
<span class="token keyword">select</span> rownum<span class="token punctuation">,</span>t<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> student t <span class="token keyword">where</span> rownum <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></code></pre>
<p>（2）rownum对于大于某值的查询条件</p>
<p>如果想找到从第二行记录以后的记录，当使用rownum&gt;2是查询不出记录的，原因是由于rownum是一个总是从1开始的伪列，Oracle认为rownum &gt; n（n&gt;1的自然数）这种条件依旧不成立，所以查询不到记录。</p>
<p>（3）rownum对于小于某值的查询条件</p>
<p>如果想找到第三条记录以前的记录，当使用rownum&lt;3是能得到2条记录的。显然rownum对于rownum &lt; n（n&gt;1的自然数）的条件是成立的，所以可以找到记录。</p>
<p>（4）可能有时需要查询rownum在某区间的数据，从上面可以看出rownum对小于某值的查询条件是认为true的，rownum对于大于某值的查询条件直接认为是false的，但是可以间接的让它转为认为是true的。那就必须使用子查询。例如要查询rownum在第二行到第三行之间的数据，包括第二行和第三行数据，那么先让它返回小于等于3的记录行，然后再主查询中判断新的rownum的别名列大于等于2的记录行。但是这样的操作会在大数据集中影响速度。</p>
<p>（5）rownum和排序</p>
<p>Oracle中的rownum是在取数据时产生的序号，所以想对指定排序的数据去指定rownum行数据就必须注意了。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> rownum<span class="token punctuation">,</span>id<span class="token punctuation">,</span>name <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">order</span> <span class="token keyword">by</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>rownum并不是按照name列来生成的序号，是系统按照记录插入时的顺序给记录排的号，rowid也是顺序分配的。为了解决这个问题，必须使用子查询。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--可以使用rowid来获得数据的修改权限</span>
<span class="token keyword">select</span> rowid<span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp <span class="token number">e</span><span class="token punctuation">;</span></code></pre>
<p>对于rownum来说Oracle系统顺序分配为查询返回的行的编号，返回的第一行分配的是1，第二行是2，依次类推，这个伪字段可以用于限制查询返回的总行数，而且rownum不能以任何表的名称作为前缀。</p>
<p>rowid是物理地址，用于定位Oracle中具体数据的物理存储位置。</p>
<h2 id="同义词"><a href="#同义词" class="headerlink" title="同义词"></a>同义词</h2><p>同义词，就是数据库对象的一个别名，可以简化访问其它用户的数据库对象。</p>
<p>通过使用同义词，可以：</p>
<ul>
<li>简化了引用另一个用户对象的方法（用户名.对象名）</li>
<li>缩短了对象名称的长度</li>
<li>同时屏蔽了对象的名称，使用户不知道最终的数据来源于哪个对象</li>
</ul>
<p><strong>语法</strong>：</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> synonym synonym_name <span class="token keyword">for</span> object<span class="token punctuation">;</span></code></pre>
<p><strong>创建和删除同义词</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--创建表的别名</span>
<span class="token keyword">create</span> synonym dual_1 <span class="token keyword">for</span> sys<span class="token punctuation">.</span>dual<span class="token punctuation">;</span>
<span class="token keyword">select</span> sysdate <span class="token keyword">from</span> dual_1<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--删除同义词</span>
<span class="token keyword">drop</span> synonym dual_1<span class="token punctuation">;</span></code></pre>
<h2 id="序列"><a href="#序列" class="headerlink" title="序列"></a>序列</h2><p>用来维护数据库的主键数据。</p>
<ul>
<li>nextval，currval的使用</li>
<li>select *.currval from sys.dual;</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--</span>
<span class="token keyword">create</span> sequence seq_stu
minvalue <span class="token number">1</span>
maxvalue <span class="token number">9999</span>
<span class="token keyword">start</span> <span class="token keyword">with</span> <span class="token number">1</span>
increment <span class="token keyword">by</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--使用序列</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span>seq_stu<span class="token punctuation">.</span>nextval<span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>

<span class="token keyword">select</span> seq_stu<span class="token punctuation">.</span>currval <span class="token keyword">from</span> sys<span class="token punctuation">.</span>dual<span class="token punctuation">;</span></code></pre>
<h1 id="数据库设计范式"><a href="#数据库设计范式" class="headerlink" title="数据库设计范式"></a>数据库设计范式</h1><p><strong>第一范式</strong>：一个表中不能包含重复的数据列。</p>
<p>一个表中不能包含重复的数据列。一个实体不能包含重复的属性（消除重复数据组，没有重复的属性和属性组）。</p>
<p><strong>第二范式</strong>：所有的非主键字段必须完全依赖于表（实体）的主键。</p>
<p><strong>第三范式</strong>：非主键字段不能依赖于其它的非主键字段，即非主键字段之间不存在着传递依赖。</p>
<p>非主键属性不能依赖于其它的非主键属性。换句话说就是非主键属性之间不能存在传递依赖。</p>
<h1 id="PL-SQL"><a href="#PL-SQL" class="headerlink" title="PL/SQL"></a>PL/SQL</h1><p>PL/SQL也是一种程序语言，被称作支持SQL的程序语言（Program Language），是Oracle数据库对SQL语句的扩展，在普通的SQL语言中增加了编程语言的特点。</p>
<p>数据操作和查询语句被包含在PL/SQL代码的过程性单元中，经过逻辑判断、循环等操作完成复杂的功能或者计算。</p>
<p>使用PL/SQL可以编写具有很多高级功能的程序，虽然这些功能可以通过多个SQL语句来完成同样的功能，但是PL/SQL具有以下的优点：</p>
<ul>
<li>使一组语句功能形成模块化程序开发</li>
<li>使用过程性语言控制程序结构</li>
<li>可以对程序中的错误进行处理</li>
<li>具有较好的可移植性</li>
<li>集成在数据库中，调用更快</li>
<li>减少了网络的交互，有助于提高程序性能</li>
</ul>
<p><strong>PL/SQL提供的新特性</strong></p>
<p>PL/SQL提供了一些新的特性，可以进行复杂的信息处理</p>
<ul>
<li>软件包</li>
<li>触发器</li>
<li>存储过程</li>
<li>函数</li>
<li>异常处理</li>
</ul>
<p>PL/SQL可以使用所有的SQL数据操作，游标控制和事务控制命令，以及所有的SQL函数和运算符。PL/SQL完全支持SQL数据类型。</p>
<blockquote>
<p>SQL，SQL*Plus，PL/SQL之间的关系</p>
</blockquote>
<p>可以把Oracle数据库看作餐馆的厨房，而<code>SQL*Plus</code>是将菜单（脚本，命令或程序）送进厨房（即数据库）的服务员。在厨房中有两个厨师，SQL和PL/SQL。作为服务员的<code>SQL*Plus</code>知道它可以处理哪些命令，哪些命令要交给厨师处理。</p>
<p>在<code>SQL*Plus</code>提示符下输入的执行命令或程序就像顾客点的蔡，对于每个顾客点的蔡，厨师都知道如何及逆行处理，就像在厨师心中的菜谱一样，PL/SQL也存储常用命令的食谱（这些元素称为触发器，存储函数，存储过程，软件包）。</p>
<p>有些大菜需要多个厨师共同处理，大多数的程序都是结合了SQL和PL/SQL，并在它们之间来回的传递信息，从而处理脚本或程序。顾客点的菜做好之后，再由作为服务员的<code>SQL*Plus</code>将执行的结果显示给用户。</p>
<h2 id="PL-SQL块的基本结构"><a href="#PL-SQL块的基本结构" class="headerlink" title="PL/SQL块的基本结构"></a>PL/SQL块的基本结构</h2><p>PL/SQL中起作用的部分都是由基本块组成的。基本块由4个组成部分。</p>
<ul>
<li><p>声明部分：<code>declare</code>，可选部分</p>
<p>变量、常量、游标、用户自定义异常声明</p>
</li>
<li><p>执行体开始部分：<code>begin</code>，必要部分</p>
<ul>
<li>sql语句</li>
<li>PL/SQL语句</li>
</ul>
</li>
<li><p>异常处理部分：<code>exception</code>，可选部分</p>
<p>程序出现异常时，捕捉异常并处理异常</p>
</li>
<li><p>执行体结束：<code>end;</code>，必要部分</p>
</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    <span class="token comment" spellcheck="true">--在declare部分声明变量，常量等</span>
    <span class="token comment" spellcheck="true">--声明变量的规范：变量名称 变量类型 [:=缺省值];</span>
    v_deptno number<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--在begin部分可以写sql语句，pl/sql语句</span>
    <span class="token comment" spellcheck="true">--在begin部分可以使用declare部分声明的变量，常量</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'欢迎使用PL/SQL，执行查询语句之前，v_deptno='</span> <span class="token operator">||</span> v_deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">select</span> deptno <span class="token keyword">into</span> v_deptno <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'执行查询语句后，v_deptno='</span> <span class="token operator">||</span> v_deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> v_deptno<span class="token punctuation">;</span>
    <span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> v_deptno<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>PL/SQL环境</strong></p>
<p>在数据库执行PL/SQL程序时，PL/SQL语句和SQL语句被分别解析和执行的。PL/SQL块被数据库内部的PL/SQL引擎提取，将SQL语句取出送给Oracle的SQL引擎。两种语句分别在两种引擎中分析处理，在数据库内部完成数据交互，处理的过程。</p>
<h2 id="PL-SQL块语法规则"><a href="#PL-SQL块语法规则" class="headerlink" title="PL/SQL块语法规则"></a>PL/SQL块语法规则</h2><ul>
<li><p>语句可以写在多行，就像SQL语句一样</p>
</li>
<li><p>各个关键字，字段名称等，通过空格分隔</p>
</li>
<li><p>每条语句必须通过分号结束，包括PL/SQL结束部分的end关键字后面也需要加分号</p>
</li>
<li><p>标识符的规定</p>
<ul>
<li>最多可以包含30个字符</li>
<li>不能包含保留字，若有使用双引号括起来</li>
<li>必须以字母字符开始</li>
<li>不能与数据库的表或者列名称相同</li>
</ul>
</li>
<li><p>在PL/SQL程序中出现的字符和日期必须用单引号括起来</p>
</li>
<li><p>数字可以是简单值或科学计数法表示</p>
<pre><code>v_Sql number(4) := 2000;
v_year number(4) := v_sql *12;</code></pre></li>
<li><p>在PL/SQL中也需养成添加注释的习惯，注释可以是</p>
<ul>
<li><code>/*</code>和<code>*/</code>之间的多行注释</li>
<li>单行注释，以<code>--</code>开始</li>
</ul>
</li>
</ul>
<h2 id="PL-SQL中处理变量"><a href="#PL-SQL中处理变量" class="headerlink" title="PL/SQL中处理变量"></a>PL/SQL中处理变量</h2><ul>
<li>在声明部分声明和初始化变量</li>
<li>在执行部分为变量赋新值，或在表达式中使用变量</li>
<li>在异常处理部分也可以使用变量</li>
<li>通过参数把值传递到PL/SQL块中</li>
<li>通过输出变量或者参数将值传出PL/SQL块</li>
</ul>
<p><strong>声明变量和常量</strong></p>
<p>语法：</p>
<pre><code>identifier [constant] datatype [not null]
            [:= | default expr];</code></pre><ul>
<li>定义的标识符名称应遵循命名规则</li>
<li>在声明常量时可以为其设置初始化值，也可以设置not null</li>
<li>可以使用赋值运算符（:=）或者default保留字来初始化标识符</li>
<li>在声明时，每行只能声明一个标识符</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_total_sal number<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--PL/SQL中赋值语句</span>
    c_tax_rate constant number<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">8.25</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--常量只能被赋值一次</span>
    v_gender char<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_valid <span class="token keyword">boolean</span> <span class="token operator">not</span> <span class="token boolean">null</span> :<span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    v_b <span class="token keyword">boolean</span><span class="token punctuation">;</span>
    v_num1 number<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
    v_num2 number<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_total_sal='</span> <span class="token operator">||</span> v_total_sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">-- = 相当于Java中的 == 的功能，执行逻辑比较操作</span>
    v_b :<span class="token operator">=</span> <span class="token punctuation">(</span>v_num1 <span class="token operator">=</span> v_num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/*
    if(v_b = true) then
        dbms_output.put_line('OK');
    else
        dbms_output.put_line('NOT OK');
    end if;
    */</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>v_b<span class="token punctuation">)</span> <span class="token keyword">then</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'NOT OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>简单变量</strong></p>
<p>简单变量不包括任何组件，只能保存一个值</p>
<p>基本类型包括三大类：字符，数字，日期</p>
<ul>
<li>binary_integer，整形数字</li>
<li>number[(precision,scale)]，数字类型</li>
<li>char[(maximum_length)]，定长字符类型</li>
<li>varchar2(maximum_length)，变长字符类型</li>
<li>date，日期类型</li>
<li>long，长字符类型</li>
<li>long raw，长二进制类型</li>
<li>clob/blob/bfile，大对象类型（字符大对象，二进制大对象，操作系统文件大对象）</li>
<li>boolean，布尔类型，有效值为true，false，null</li>
</ul>
<p><strong>复合数据类型</strong></p>
<p>复合变量也叫组合变量。在复合变量中包含多个内部的组件，每个组件都可以单独存放值。一个复合变量可以存放多个值。</p>
<p>与简单变量类型不同，复合变量不是数据库中已经存在的数据类型，所以复合变量在声明类型之前，首先要创建使用到的复合类型，然后将变量声明为复合变量。</p>
<p>复合数据类型：</p>
<ul>
<li>PL/SQL tables，表类型</li>
<li>PL/SQL records，记录类型</li>
</ul>
<p>复合类型被创建后，可以被使用多次定义多个变量。</p>
<blockquote>
<p>table</p>
</blockquote>
<pre><code>type type_name = is table of scalar_datatype
    [not null] index by binary_integer;
identifier type_name;</code></pre><p>表类型类似于其它编程语言中的数组类型</p>
<p>由两个组件组成：</p>
<ul>
<li>数据类型为binary_integer（整形数字）的主键</li>
<li>数据类型为一个确定的简单类型的列</li>
</ul>
<p>table类型没有长度限制，可以动态增长。表类型中的第二部分类似于数组中的值，这个部分必须是一个已经确定的简单类型，不能是其它的复合类型。</p>
<p>表类型的结构很像数组。第一部分是一个按1递增的整形数字，起到数字索引的作用，第二部分是一种确定的简单类型，用来存放每个索引号对应的具体的数值。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    <span class="token comment" spellcheck="true">--在声明部分声明表类型</span>
    <span class="token keyword">type</span> nameed_table_type <span class="token operator">is</span> <span class="token keyword">table</span> <span class="token keyword">of</span> varchar2<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">index</span> <span class="token keyword">by</span> binary_integer<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">--使用声明的表类型来声明变量</span>
    v_table1 nameed_table_type<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--给表类型的变量赋值，可以通过索引来访问表类型的变量</span>
    <span class="token comment" spellcheck="true">--表类型的变量没有长度的限制</span>
    v_table1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'hello1'</span><span class="token punctuation">;</span>
    v_table1<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'hello2'</span><span class="token punctuation">;</span>
    v_table1<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'hello3'</span><span class="token punctuation">;</span>
    v_table1<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'工程师'</span><span class="token punctuation">;</span>
    v_table1<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'hello1'</span><span class="token punctuation">;</span>

    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_table1(1)='</span> <span class="token operator">||</span> v_table1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">',v_table1(2)='</span> <span class="token operator">||</span> v_table1<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<blockquote>
<p>records</p>
</blockquote>
<p>复合类型中的records类型是由多个组件组成的一种类型。包含一个或几个组件，每个组件称为一个域（field），域的数据类型可以是简单变量类型、另一个record类型或PL/SQL的table类型。</p>
<p>在使用records变量时把多个域的集合作为一个逻辑单元使用，对记录类型变量赋值或引用，都需要使用”记录变量名.域名“的方式来实现。</p>
<p>主要用于从表中取出查询到的行数据。</p>
<p>记录类型可以包含一个或多个域，每个域相当于记录类型变量的一个属性。在使用记录变量类型时，实际上是对记录类型变量的属性进行操作。每个域都可以是不同的数据类型，存放不同类型的数据。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    <span class="token comment" spellcheck="true">--声明记录类型</span>
    <span class="token keyword">type</span> named_recore_type <span class="token operator">is</span> record<span class="token punctuation">(</span>
        empno number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        ename varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        job varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        mgr number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        hiredate <span class="token keyword">date</span><span class="token punctuation">,</span>
        sal number<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        com number<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        deptno number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">--使用记录类型来声明变量</span>
    v_rec named_recore_type<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--给记录类型的变量赋值，只有类型中声明好的字段，才可以进行访问</span>
    v_rec<span class="token punctuation">.</span>empno :<span class="token operator">=</span> <span class="token number">7963</span><span class="token punctuation">;</span>
    v_rec<span class="token punctuation">.</span>ename :<span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span>
    v_rec<span class="token punctuation">.</span>job :<span class="token operator">=</span> <span class="token string">'Java开发'</span><span class="token punctuation">;</span>
    v_rec<span class="token punctuation">.</span>mgr :<span class="token operator">=</span> <span class="token number">7800</span><span class="token punctuation">;</span>
    v_rec<span class="token punctuation">.</span>hiredate :<span class="token operator">=</span> to_date<span class="token punctuation">(</span><span class="token string">'1987-12-5'</span><span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_rec<span class="token punctuation">.</span>sal :<span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
    v_rec<span class="token punctuation">.</span>comm :<span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    v_rec<span class="token punctuation">.</span>deptno :<span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_rec.empno='</span> <span class="token operator">||</span> v_rec<span class="token punctuation">.</span>empno <span class="token operator">||</span> <span class="token string">'v_rec.ename='</span> <span class="token operator">||</span> v_rec<span class="token punctuation">.</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>%type</strong></p>
<p>除了可以使用已经确定的类型来声明变量之外，还可以使用<code>%type</code>，<code>%rowtype</code>来作为变量的类型。</p>
<p><code>%type</code>的前缀可以是一个前面已经声明过的简单类型的变量（可以是简单类型的变量，也可以是复合类型的变量-表类型的变量），也可以是一个表的字段的名称。</p>
<p>通过<code>%type</code>类型声明新变量的类型，实际上就是将参照的变量或表中的字段类型作为新变量的类型，新变量的类型与它所参照的类型完全相同，并且保持同步。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_empno number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">--用v_empno的类型作为v_deptno的类型</span>
    v_deptno v_empno<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    v_empno :<span class="token operator">=</span> <span class="token number">8000</span><span class="token punctuation">;</span>
    v_deptno :<span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_empno='</span> <span class="token operator">||</span> v_empno <span class="token operator">||</span> <span class="token string">'v_deptno='</span> <span class="token operator">||</span> v_deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>


<span class="token keyword">declare</span>
<span class="token comment" spellcheck="true">--用emp表的deptno的类型作为v_deptno的类型，当emp表中的deptno的类型编号变化时，v_deptno的类型自动跟着变化</span>
    v_deptno emp<span class="token punctuation">.</span>deptno<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    v_deptno :<span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_deptno='</span> <span class="token operator">||</span> v_deptno<span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>使用%type属性的好处：</p>
<ul>
<li>可能不知道数据库中字段的数据类型</li>
<li>数据库中字段的数据类型可以在运行时被改变</li>
<li>和前面声明过的变量的类型保持一致</li>
</ul>
<p><strong>%rowtype</strong></p>
<p><code>%rowtype</code>与%type作用类似，用于定义不确定的类型。</p>
<p><code>%rowtype</code>的前缀可以是一个表名（或视图），也可以是前面声明的一个记录类型的变量（该变量必须要参照一个表，而不能是自定义的记录类型）。</p>
<p>record中的域，与表的字段名称、个数、数据类型，以及长度完全相同，可以用来存放从从表中取出的一条记录的所有的字段值（select * from table）。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    <span class="token comment" spellcheck="true">-- %rowtype的前缀是一个表名</span>
    v_emp dept<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">--使用%rowtype时，Oracle做了两件事：1、用dept表的字段及其类型来声明了一种记录类型；2、用这种记录来声明变量</span>
<span class="token keyword">begin</span>
    v_emp<span class="token punctuation">.</span>deptno :<span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    v_emp<span class="token punctuation">.</span>dname :<span class="token operator">=</span> <span class="token string">'研发部'</span><span class="token punctuation">;</span>
    v_emp<span class="token punctuation">.</span>loc :<span class="token operator">=</span> <span class="token string">'北京'</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_emp.deptno='</span> <span class="token operator">||</span> v_emp<span class="token punctuation">.</span>deptno <span class="token operator">||</span> <span class="token string">'v_emp.dname='</span> <span class="token operator">||</span> v_emp<span class="token punctuation">.</span>dname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>


<span class="token keyword">declare</span>
    <span class="token comment" spellcheck="true">--v_dept是一种记录类型的变量</span>
    v_dept dept<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">--用v_dept的类型（记录类型）来作为v_emp的类型，v_emp也是一种记录类型</span>
    v_emp v_dept<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    v_emp<span class="token punctuation">.</span>deptno :<span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    v_emp<span class="token punctuation">.</span>dname :<span class="token operator">=</span> <span class="token string">'人事部'</span><span class="token punctuation">;</span>
    v_emp<span class="token punctuation">.</span>loc :<span class="token operator">=</span> <span class="token string">'上海'</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_emp.deptno='</span> <span class="token operator">||</span> v_emp<span class="token punctuation">.</span>deptno <span class="token operator">||</span> <span class="token string">'v_emp.dname='</span> <span class="token operator">||</span> v_emp<span class="token punctuation">.</span>dname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><code>%rowtype</code>声明的肯定是记录类型的变量。</p>
<h2 id="嵌套块和变量作用域"><a href="#嵌套块和变量作用域" class="headerlink" title="嵌套块和变量作用域"></a>嵌套块和变量作用域</h2><p>PL/SQL程序也叫做PL/SQL程序块，在程序块中可以嵌套另一个程序块，外部的程序块叫做”父块“或”外部块“，嵌套的块叫”子块“或”嵌套块“。</p>
<ul>
<li>只要是允许执行语句的地方，就可以使用嵌套PL/SQL块</li>
<li>嵌套块也被当作一个语句</li>
<li>异常部分也可以包含嵌套块，嵌套块也可以包括异常部分</li>
<li>应用对象的程序对象的作用域指的是可见范围</li>
<li>标识符可见的范围<ul>
<li>子块可以向上查看父块的标识符</li>
<li>父块不能向下查看子块的标识符</li>
</ul>
</li>
</ul>
<p>PL/SQL嵌套块的使用：只要是能出现非声明性的SQL语句的地方（在begin和exception部分），都可以出现嵌套块。嵌套块本本身就被当作一个SQL语句来执行。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_weight number<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">declare</span>
        v_weight number<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token keyword">begin</span>
        v_weight :<span class="token operator">=</span> v_weight <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'在嵌套块中：v_weight='</span> <span class="token operator">||</span> v_weight<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--201</span>
    <span class="token keyword">end</span><span class="token punctuation">;</span>

    v_weight :<span class="token operator">=</span> v_weight <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'在嵌套块外：v_weight='</span> <span class="token operator">||</span> v_weight<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--101</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<h2 id="PL-SQL中的函数"><a href="#PL-SQL中的函数" class="headerlink" title="PL/SQL中的函数"></a>PL/SQL中的函数</h2><ul>
<li><p>可用</p>
<ul>
<li>数字函数</li>
<li>字符函数</li>
<li>类型转换函数</li>
<li>日期函数</li>
</ul>
</li>
<li><p>不可用</p>
<ul>
<li>组函数</li>
</ul>
</li>
</ul>
<p>在PL/SQL中使用函数和直接在Oracle中使用函数没有区别。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_date datep :<span class="token operator">=</span> to_date<span class="token punctuation">(</span><span class="token string">'1987-12-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_name varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'Hello test'</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_date='</span> <span class="token operator">||</span> to_char<span class="token punctuation">(</span>v_date<span class="token punctuation">,</span><span class="token string">'yyyy-mm-dd'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">',字符长度是：'</span> <span class="token operator">||</span> length<span class="token punctuation">(</span>v_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>数据类型转换</strong></p>
<p>把数据转换为可操作的数据类型。</p>
<p>转换函数：</p>
<ul>
<li>to_char</li>
<li>to_date</li>
<li>to_number</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_1 varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--v_1 := user || ':' || to_char(sysdate);</span>
    v_1 :<span class="token operator">=</span> <span class="token keyword">user</span> <span class="token operator">||</span> <span class="token string">':'</span> <span class="token operator">||</span> sysdate<span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<h2 id="PL-SQL中的SQL命令"><a href="#PL-SQL中的SQL命令" class="headerlink" title="PL/SQL中的SQL命令"></a>PL/SQL中的SQL命令</h2><p>在PL/SQL程序块中可以使用各种SQL命令，但是使用的方法根据命令不同也各不相同。</p>
<ul>
<li>使用select命令，可以从数据库中取出单行数据，语法略有变化</li>
<li>使用DML命令，修改数据库中的行，没有变化</li>
<li>使用commit或rollback命令控制事务，没有变化</li>
<li>通过execute immediate，执行DDL和DCL语句</li>
</ul>
<blockquote>
<p>查询数据</p>
</blockquote>
<p>在PL/SQL中通过select从数据库中检索数据：</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">select</span> select_list
<span class="token keyword">into</span> ariable_name <span class="token operator">|</span> record_name
<span class="token keyword">from</span> <span class="token keyword">table</span>
<span class="token keyword">where</span> condition<span class="token punctuation">;</span></code></pre>
<ul>
<li>必须使用into子句，用于将查询出的数据传递给变量</li>
<li>查询必须并且只能返回一行</li>
<li>可以使用完整的select语法</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_empno emp<span class="token punctuation">.</span>empno<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
    v_ename emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--查询列表和变量必须要匹配</span>
    <span class="token keyword">select</span> empno<span class="token punctuation">,</span>ename <span class="token keyword">into</span> v_empno<span class="token punctuation">,</span>v_ename <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_empno='</span> <span class="token operator">||</span> v_empno <span class="token operator">||</span> <span class="token string">',v_ename='</span> <span class="token operator">||</span> ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--用记录类型的变量和select *搭配使用</span>
<span class="token keyword">declare</span>
    v_emp emp<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">into</span> v_emp <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_empno='</span> <span class="token operator">||</span> v_empno <span class="token operator">||</span> <span class="token string">',v_ename='</span> <span class="token operator">||</span> ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>在PL/SQL中使用组函数时，可以使用，但是要保证查询语句只能返回一条记录。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_deptno number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_maxsal number<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_minsal number<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">select</span> deptno<span class="token punctuation">,</span><span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> maxsal<span class="token punctuation">,</span><span class="token function">min</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> minsal <span class="token keyword">into</span> v_deptno<span class="token punctuation">,</span>v_maxsal<span class="token punctuation">,</span>v_minsal
    <span class="token keyword">from</span> emp
    <span class="token keyword">group</span> <span class="token keyword">by</span> deptno
    <span class="token keyword">having</span> <span class="token function">max</span><span class="token punctuation">(</span>sal<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">3000</span><span class="token punctuation">;</span>

    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_deptno='</span> <span class="token operator">||</span> v_deptno <span class="token operator">||</span> <span class="token string">',v_maxsal='</span> <span class="token operator">||</span> v_maxsal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>查询异常</strong></p>
<p>PL/SQL中的select语句必须返回且只返回一行。如果检索到了0行或多于1行，将会引起异常。</p>
<p>select常见的异常：</p>
<ul>
<li>too_many_rows</li>
<li>no_data_found</li>
</ul>
<blockquote>
<p>操作数据</p>
</blockquote>
<p>通过使用DML命令，修改数据库中表的数据。</p>
<p>在PL/SQL中执行DML语句、事务控制语句和在Oracle中执行没有任何区别。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">begin</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> emp <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">'销售员'</span><span class="token punctuation">,</span><span class="token number">7902</span><span class="token punctuation">,</span><span class="token string">'12-8月-1987'</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">update</span> emp <span class="token keyword">set</span> job <span class="token operator">=</span> <span class="token string">'MANAGER'</span><span class="token punctuation">,</span>sal <span class="token operator">=</span> <span class="token number">2600</span> <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">--commit;</span>
    <span class="token comment" spellcheck="true">--rollback;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>在PL/SQL中执行DDL，DCL要使用execute immediate。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">begin</span>
    <span class="token keyword">execute</span> immediate <span class="token string">'create table users (id number(4) primary key,name varchar2(20),sex char(2) )'</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token keyword">begin</span>
    <span class="token keyword">execute</span> immediate <span class="token string">'create table users (userid number(4) primary key,username varchar2(20),sex char(2) check (sex in ('</span><span class="token string">'男'</span><span class="token string">','</span><span class="token string">'女'</span><span class="token string">')) )'</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><p>在PL/SQL中使用if elsif else。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--根据职务，现有的工资，给7369涨工资</span>
<span class="token keyword">declare</span>
    v_job emp<span class="token punctuation">.</span>job<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
    v_sal emp<span class="token punctuation">.</span>sql<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
    v_addsal v_sal<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">select</span> job<span class="token punctuation">,</span>sal <span class="token keyword">into</span> v_job<span class="token punctuation">,</span>v_sal <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>v_job <span class="token operator">=</span> <span class="token string">'CLERK'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        v_addsal :<span class="token operator">=</span> v_sal <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">;</span>
    elsif <span class="token punctuation">(</span>v_job <span class="token operator">=</span> <span class="token string">'SALESMAN'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        v_addsal :<span class="token operator">=</span> v_sal <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">;</span>
    elsif <span class="token punctuation">(</span>v_job <span class="token operator">=</span> <span class="token string">'PRESIDENT'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        v_addsal :<span class="token operator">=</span> v_sal <span class="token operator">*</span> <span class="token number">1.7</span><span class="token punctuation">;</span>
    elsif <span class="token punctuation">(</span>v_job <span class="token operator">=</span> <span class="token string">'MANAGER'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        v_addsal :<span class="token operator">=</span> v_sal <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        v_addsal :<span class="token operator">=</span> v_sal <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>

    <span class="token keyword">update</span> emp <span class="token keyword">set</span> sal <span class="token operator">=</span> v_addsal <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">7369</span><span class="token punctuation">;</span>
    <span class="token keyword">commit</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<h2 id="循环控制"><a href="#循环控制" class="headerlink" title="循环控制"></a>循环控制</h2><p><strong>loop语句</strong></p>
<p>循环用于多次执行某些语句。</p>
<p>主要有三种循环类型：</p>
<ul>
<li>简单循环</li>
<li>for循环</li>
<li>while循环</li>
</ul>
<p>循环的四个条件：1、初始条件；2、循环条件；3、循环体；4、迭代条件。</p>
<p><strong>简单循环</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_count number<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--初始条件</span>
<span class="token keyword">begin</span>
    loop
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_count='</span> <span class="token operator">||</span> v_count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--循环体</span>
        v_count :<span class="token operator">=</span> v_count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--迭代条件</span>
        <span class="token keyword">exit</span> <span class="token keyword">when</span> v_count <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--循环条件</span>
    <span class="token keyword">end</span> loop<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--利用loop循环，向users表插入10条数据，如果编号是奇数，性别为男；如果编号是偶数，性别为女</span>
<span class="token keyword">declare</span>
    v_sex char<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_count number<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    v_name varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    loop
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mod<span class="token punctuation">(</span>v_count<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            v_sex :<span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            v_sex :<span class="token operator">=</span> <span class="token string">'男'</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
        v_name :<span class="token operator">=</span> <span class="token string">'test'</span> <span class="token operator">||</span> v_count<span class="token punctuation">;</span>
        <span class="token keyword">insert</span> <span class="token keyword">into</span> users <span class="token keyword">values</span><span class="token punctuation">(</span>v_count<span class="token punctuation">,</span>v_name<span class="token punctuation">,</span>v_sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v_count :<span class="token operator">=</span> v_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">exit</span> <span class="token keyword">when</span> v_count <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> loop<span class="token punctuation">;</span>
    <span class="token keyword">commit</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>for循环</strong></p>
<p>使用for循环，循环执行指定次数。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">for</span> <span class="token keyword">index</span> <span class="token operator">in</span> <span class="token punctuation">[</span>reverse<span class="token punctuation">]</span> lower_bound<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>upper_bound loop
    statement1<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">end</span> loop<span class="token punctuation">;</span></code></pre>
<p>reverse是反转的意思，正常的循环计数器从小到大，使用reverse将计数器从大到小递减。</p>
<p>for循环使用的规则：</p>
<ul>
<li>循环计数器不需要声明，Oracle自动为for循环声明计数器变量</li>
<li>只能在循环体内引用计数器</li>
<li>如果需要在循环体外引用计数器的值，可以使用一个变量记录计数器的值</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_sex char<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_name varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">for</span> v_count <span class="token operator">in</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">100</span> loop
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mod<span class="token punctuation">(</span>v_count<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            v_sex :<span class="token operator">=</span> <span class="token string">'女'</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            v_sex :<span class="token operator">=</span> <span class="token string">'男'</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
        v_name :<span class="token operator">=</span> <span class="token string">'test'</span> <span class="token operator">||</span> v_count<span class="token punctuation">;</span>
        <span class="token keyword">insert</span> <span class="token keyword">into</span> users <span class="token keyword">values</span><span class="token punctuation">(</span>v_count<span class="token punctuation">,</span>v_name<span class="token punctuation">,</span>v_sex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> loop<span class="token punctuation">;</span>
    <span class="token keyword">commit</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>while循环</strong></p>
<p>使用while循环，只要条件满足就执行循环。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">while</span> condition loop
    statement1<span class="token punctuation">;</span>
    statement2<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">end</span> loop<span class="token punctuation">;</span></code></pre>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_count number<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>v_count <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> loop
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_count='</span> <span class="token operator">||</span> v_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v_count :<span class="token operator">=</span> v_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> loop<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>异常就是在Oracle数据库中运行时出现的错误，可能使用户设置的一些数据规则的违反（如约束），异常处理就是对这些异常的捕捉和处理。</p>
<p>在PL/SQL中出现的异常，如果没有处理，异常会被传递给调用环境，中断程序的执行。</p>
<p>PL/SQL程序会从发生异常的代码处中断，以后的代码是无法执行的。</p>
<p><strong>捕获异常语法</strong></p>
<pre><code>exception
    when exception1 [or exception2...] then
        statement1;
        statement2;
        ...
    [when exception3 [or exception4...] then
        statement1;
        statement2;
        ...
    ]
    [when others then
        statement1;
        statement2;
        ...
    ]</code></pre><p>异常出现在程序的执行部。在执行某些语句时，可能违反了某些数据库的规则或用户的规则，从而触发异常。异常在发生之后就不能继续执行程序，而是立刻进入到异常处理部分（exception）；在异常处理部分首先要捕获异常，如果异常被捕获到，就执行用户定义的异常处理程序，如果发生的异常没有被捕获到，就会被传递到程序的调用环境中，产生报错信息。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_job emp<span class="token punctuation">.</span>job<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">select</span> job <span class="token keyword">into</span> v_job <span class="token keyword">from</span> emp <span class="token keyword">where</span> empno <span class="token operator">=</span> <span class="token number">8001</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_job='</span> <span class="token operator">||</span> v_job<span class="token punctuation">)</span><span class="token punctuation">;</span>
exception
    <span class="token keyword">when</span> no_data_found <span class="token keyword">then</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'执行的select语句没有查询到结果'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">when</span> others <span class="token keyword">then</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'PL/SQL中发生了其它异常'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>当PL/SQL程序中，在begin部门的语句引起异常之后，就会进入到exception部分执行异常处理功能。</p>
<p><strong>Oracle的异常类型分为三类</strong></p>
<ul>
<li><p>预定义异常，Oracle中已经预先为这种异常定义好了名称，在异常处理部分直接通过异常名称进行捕获。</p>
<p>预定义的一些异常名称：</p>
<ul>
<li>no_data_found，没有找到数据</li>
<li>too_many_rows，数据太多</li>
<li>invalid_cursor，失效的游标</li>
<li>zero_divide，除数为0</li>
<li>dup_val_on_index，唯一索引中插入重复值</li>
<li>value_error，赋值异常</li>
</ul>
</li>
<li><p>非预定义异常，也是因为违反了Oracle的规则，Oracle会产生报错信息（有错误编号和错误信息），但是Oracle并没有为这类错误定义好异常名称，那么可以自定义一种异常名称，并将这种异常名称和错误编号进行绑定。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    e_myexception exception<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--自定义一种异常名称</span>
    pragma exception_init<span class="token punctuation">(</span>v_emp_remaining<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">002292</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
exception
    <span class="token keyword">when</span> v_emp_remaining <span class="token keyword">then</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'违反外键约束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">when</span> others <span class="token keyword">then</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'PL/SQL中发生了其它异常'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>用户定义异常，操作时，并没有违反Oracle的规则，而是违反了用户定义的规则。由于没有违反Oracle的规则，Oracle不会自己主动的产生报错信息，需要手动的提升一个异常。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> sm_emp<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> sm_emp<span class="token punctuation">(</span>
    <span class="token keyword">no</span> char<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    name char<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    salary number<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    phone char<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> sm_emp <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token number">999.99</span><span class="token punctuation">,</span><span class="token string">'3474907'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sm_emp <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'02'</span><span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token number">999.99</span><span class="token punctuation">,</span><span class="token string">'3474907'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> sm_emp <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'03'</span><span class="token punctuation">,</span><span class="token string">'te'</span><span class="token punctuation">,</span><span class="token number">999.99</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span>
    e_phone_lost_exception exception<span class="token punctuation">;</span>
    <span class="token keyword">cursor</span> cur_sm_emp <span class="token operator">is</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sm_emp<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">for</span> v_rec_emp <span class="token operator">in</span> cur_sm_emp 1oop
        <span class="token keyword">if</span><span class="token punctuation">(</span>v_rec_emp<span class="token punctuation">.</span>phone <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            v_name :<span class="token operator">=</span> v_rec_emp<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
            raise e_phone_lost_exception<span class="token punctuation">;</span>
        <span class="token keyword">end</span> id<span class="token punctuation">;</span>
    <span class="token keyword">end</span> loop
exception
    <span class="token keyword">when</span> e_phone_lost_exception <span class="token keyword">then</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_name <span class="token operator">||</span> <span class="token string">'的电话为null'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">when</span> others <span class="token keyword">then</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'PL/SQL中发生了其它异常'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
</li>
</ul>
<p>预定义异常和非预定义异常都是因为违反了Oracle的规则，Oracle会自动的产生异常；而用户自定义异常并没有违反Oracle的规则，Oracle不会自动的产生异常。</p>
<p><strong>异常捕获相关的函数</strong></p>
<p>在进行异常捕获时，在where子句中捕获大多数的预先可以预测到的异常。但是在数据库中存在太多的不可预期的异常。所以在程序中很可能异常发生时，没有捕获。这时需要借助<code>where others then</code>子句在处理这些的非预期的异常。</p>
<p><code>where others then</code>可以捕获到预先没有定义的异常。为了有效的处理这些异常，以便在以后的程序中减少这些异常，通常会将这些异常写入错误日志表中。</p>
<p>为了能够记录发生的异常信息，Oracle提供了两个函数：</p>
<ul>
<li>sqlcode，返回错误代码，number类型</li>
<li>sqlerrm，返回与错误代码关联的信息，varchar2类型</li>
</ul>
<blockquote>
<p>对于非预测的异常，如何处理？</p>
</blockquote>
<p>用when  others then捕获所有的非预期的异常，渠道错误编号和错误信息，记录到数据库中。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">drop</span> <span class="token keyword">table</span> err_log<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> err_log <span class="token punctuation">(</span>id number<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>code number<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>message varchar2<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">datetime</span> <span class="token keyword">date</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> err_LOG<span class="token punctuation">;</span>

<span class="token keyword">declare</span>
    v_code number<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_msg varchar2<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">delete</span> <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
exception
    <span class="token keyword">when</span> others <span class="token keyword">then</span>
        <span class="token comment" spellcheck="true">--获取错误编号</span>
        v_code :<span class="token operator">=</span> salcode<span class="token punctuation">;</span>
        v_msg :<span class="token operator">=</span> sqlerrm<span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">--把错误编号和错误信息插入到日志表中</span>
        <span class="token keyword">insert</span> <span class="token keyword">into</span> err_log <span class="token keyword">values</span><span class="token punctuation">(</span>seq_errlog<span class="token punctuation">.</span>nextval<span class="token punctuation">,</span>v_code<span class="token punctuation">,</span>v_msg<span class="token punctuation">,</span>sysdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">commit</span><span class="token punctuation">;</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'PL/SQL程序中遇到异常，请查询日志表获取详细信息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<h2 id="PL-SQL程序单元"><a href="#PL-SQL程序单元" class="headerlink" title="PL/SQL程序单元"></a>PL/SQL程序单元</h2><p>PL/SQL程序，也叫PL/SQL程序单元，是数据库中命名的PL/SQL块。</p>
<p>主要有四类：</p>
<ul>
<li>过程，执行特定操作</li>
<li>函数，进行复杂计算，返回计算的结果</li>
<li>包，将逻辑上相关的过程和函数组织在一起</li>
<li>触发器，事件触发，执行相应操作</li>
</ul>
<p><strong>块类型</strong></p>
<ul>
<li><p>匿名块</p>
<pre class=" language-sql"><code class="language-sql"><span class="token punctuation">[</span><span class="token keyword">declare</span><span class="token punctuation">]</span>
    变量，常量声明
<span class="token keyword">begin</span>
    语句<span class="token punctuation">;</span>
<span class="token punctuation">[</span>exception<span class="token punctuation">]</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>过程</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">procedure</span> name <span class="token operator">is</span>
    变量，常量声明
<span class="token keyword">begin</span>
    语句<span class="token punctuation">;</span>
<span class="token punctuation">[</span>exception<span class="token punctuation">]</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>函数</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">function</span> name <span class="token keyword">return</span> datatype <span class="token operator">is</span>
    变量，常量声明
<span class="token keyword">begin</span>
    语句<span class="token punctuation">;</span>
    returen <span class="token keyword">value</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>exception<span class="token punctuation">]</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>触发器</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">trigger</span> name <span class="token keyword">after</span><span class="token operator">|</span>before <span class="token operator">is</span>
    变量，常量声明
<span class="token keyword">begin</span>
    语句<span class="token punctuation">;</span>
<span class="token punctuation">[</span>exception<span class="token punctuation">]</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>包</p>
<pre class=" language-sql"><code class="language-sql">package name
    函数声明<span class="token punctuation">;</span>
    过程声明<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

package body name
<span class="token keyword">begin</span>
    函数定义<span class="token punctuation">;</span>
    过程定义<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
</li>
</ul>
<p><strong>匿名块</strong></p>
<ul>
<li>匿名块只使用一次的PL/SQL程序块</li>
<li>匿名块没有名称，也不被存储在数据库中，它不是PL/SQL存储程序单元</li>
<li>由PL/SQL的四个基本组成部分构成</li>
<li>在SQL*PLUS中通过“/”编译并且执行</li>
<li>不能被重复使用，当要执行时，需要重新编写并编译执行</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">procedure</span> cur_emp <span class="token operator">is</span>
    <span class="token keyword">cursor</span> cur_emp <span class="token operator">is</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
    v_rec_emp emp<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">open</span> cur_emp<span class="token punctuation">;</span>
    <span class="token keyword">fetch</span> cur_emp <span class="token keyword">into</span> v_rec_emp<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cur_emp<span class="token operator">%</span>found<span class="token punctuation">)</span> loop
        <span class="token keyword">fetch</span> cur_emp <span class="token keyword">into</span> v_rec_emp<span class="token punctuation">;</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_rec_emp<span class="token punctuation">.</span>empno <span class="token operator">||</span> <span class="token string">','</span> <span class="token operator">||</span> v_rec_emp<span class="token punctuation">.</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">fetch</span> cur_emp <span class="token keyword">into</span> v_rec_emp<span class="token punctuation">;</span>
    <span class="token keyword">end</span> loop<span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'查询数据的总条数是：'</span> <span class="token operator">||</span> cur_emp<span class="token operator">%</span><span class="token keyword">rowcount</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">close</span> cur_emp<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--调用过程</span>
<span class="token comment" spellcheck="true">--在命令行中调用</span>
<span class="token keyword">exec</span> cur_emp<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--在匿名块中调用</span>
<span class="token keyword">begin</span>
    cur_emp<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>创建带有参数的存储过程。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">procedure</span> add_dept<span class="token punctuation">(</span>p_deptno number<span class="token punctuation">,</span>p_dname varchar2<span class="token punctuation">,</span>p_loc varchar2<span class="token punctuation">)</span> <span class="token operator">is</span>

<span class="token keyword">begin</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> dept <span class="token keyword">values</span><span class="token punctuation">(</span>p_deptno<span class="token punctuation">,</span>p_dname<span class="token punctuation">,</span>p_loc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">commit</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--在匿名块中调用存储过程</span>
<span class="token comment" spellcheck="true">--调用有参数的过程的不同方式</span>
<span class="token comment" spellcheck="true">--1、按参数名称调用</span>
<span class="token keyword">declare</span>
    v_deptno number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    v_dname varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'销售部'</span><span class="token punctuation">;</span>
    v_loc varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'北京'</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    add_dept<span class="token punctuation">(</span>p_loc <span class="token operator">=</span><span class="token operator">></span> v_loc<span class="token punctuation">,</span>p_dname <span class="token operator">=</span><span class="token operator">></span> v_dname<span class="token punctuation">,</span>p_deptno <span class="token operator">=</span><span class="token operator">></span> v_deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--2、按参数的位置进行调用</span>
<span class="token keyword">declare</span>
    v_deptno number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    v_dname varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'销售部'</span><span class="token punctuation">;</span>
    v_loc varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'北京'</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    add_dept<span class="token punctuation">(</span>v_deptno<span class="token punctuation">,</span>v_dname<span class="token punctuation">,</span>v_loc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--3、按混合方式调用</span>
<span class="token keyword">declare</span>
    v_deptno number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    v_dname varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'销售部'</span><span class="token punctuation">;</span>
    v_loc varchar2<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'北京'</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    add_dept<span class="token punctuation">(</span>v_deptno<span class="token punctuation">,</span>p_loc <span class="token operator">=</span><span class="token operator">></span> v_loc<span class="token punctuation">,</span>p_dname <span class="token operator">=</span><span class="token operator">></span> v_dname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>作为Oracle中过程的参数，除了有数据类型之外，还有一种特殊的类型，既输入输出类型（in，out，in out）。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> replace param_test<span class="token punctuation">(</span>p_in <span class="token operator">in</span> varchar2<span class="token punctuation">,</span>p_out <span class="token keyword">out</span> varchar2<span class="token punctuation">,</span>p_in_out <span class="token operator">in</span> <span class="token keyword">out</span> varchar2<span class="token punctuation">)</span> <span class="token operator">is</span>

<span class="token keyword">begin</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'在过程中，p_in ='</span> <span class="token operator">||</span> p_in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'在过程中，p_out = '</span> <span class="token operator">||</span> p_out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'在过程中，p_in_out = '</span> <span class="token operator">||</span> p_in_out<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">--作为out类型的参数，可以在过程中被重新赋值，并且会被返回给调用者</span>
    p_out :<span class="token operator">=</span> <span class="token string">'out类型的参数在过程中被重新赋值'</span><span class="token punctuation">;</span>
    p_in_out :<span class="token operator">=</span> <span class="token string">'in out类型的参数在过程中被重新赋值'</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span>
    v_in varchar2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'in类型参数的初始值'</span><span class="token punctuation">;</span>
    v_out varchar2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'out类型参数的初始值'</span><span class="token punctuation">;</span>
    v_in_out varchar2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'in out类型参数的初始值'</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    param_test<span class="token punctuation">(</span>v_in<span class="token punctuation">,</span>v_out<span class="token punctuation">,</span>v_in_out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'在过程中，p_in ='</span> <span class="token operator">||</span> p_in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'在过程中，p_out = '</span> <span class="token operator">||</span> p_out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'在过程中，p_in_out = '</span> <span class="token operator">||</span> p_in_out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>存储过程完成的是一系列的操作，可以单独的调用一个过程，来完成某些操作。</p>
<p>函数：可以接收一个或多个参数，在函数中完成运算，最终返给用户一个结果（Oracle中的函数必须有返回结果）</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--根据职位和薪金，计算佣金的值</span>
<span class="token comment" spellcheck="true">--函数的参数也有输入输出类型，但是out类型的参数使用不方便，所以在函数中只使用in类型的参数</span>
<span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">function</span> add_comm<span class="token punctuation">(</span>p_job varchar2<span class="token punctuation">,</span>v_sal emp<span class="token punctuation">.</span>sal<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token keyword">return</span> number <span class="token operator">is</span>
    v_comm emp<span class="token punctuation">.</span>comm<span class="token operator">%</span><span class="token keyword">type</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>p_job <span class="token operator">=</span> <span class="token string">'CLERK'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        v_comm :<span class="token operator">=</span> p_sal <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    elsif<span class="token punctuation">(</span>p_job <span class="token operator">=</span> <span class="token string">'SALESMAN'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        v_comm :<span class="token operator">=</span> p_sal <span class="token operator">*</span> <span class="token number">0.6</span><span class="token punctuation">;</span>
    elsif<span class="token punctuation">(</span>p_job <span class="token operator">=</span> <span class="token string">'PRESIDENT'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        v_comm :<span class="token operator">=</span> p_sal <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">;</span>
    elsif<span class="token punctuation">(</span>p_job <span class="token operator">=</span> <span class="token string">'ANALYST'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        v_comm :<span class="token operator">=</span> p_sal <span class="token operator">*</span> <span class="token number">0.8</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        v_comm :<span class="token operator">=</span> p_sal <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> v_comm<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">--在函数中一定要有一个有效的return语句</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--调用函数</span>
<span class="token comment" spellcheck="true">--1、无法在命令行中调用函数</span>
<span class="token comment" spellcheck="true">--2、在匿名块中调用函数</span>
<span class="token keyword">declare</span>
    v_res number<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_str varchar2<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> :<span class="token operator">=</span> <span class="token string">'test'</span><span class="token punctuation">;</span>
    v_length number<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    v_res :<span class="token operator">=</span> add_comm<span class="token punctuation">(</span><span class="token string">'SALESMAN'</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_length :<span class="token operator">=</span> length<span class="token punctuation">(</span>v_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_res='</span> <span class="token operator">||</span> v_res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'v_length='</span> <span class="token operator">||</span> v_length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">--3、在sql语句中使用函数</span>
<span class="token keyword">select</span> ename<span class="token punctuation">,</span>length<span class="token punctuation">(</span>ename<span class="token punctuation">)</span> 名字长度<span class="token punctuation">,</span>job<span class="token punctuation">,</span>sal<span class="token punctuation">,</span>add_comm<span class="token punctuation">(</span>job<span class="token punctuation">,</span>sal<span class="token punctuation">)</span> <span class="token string">"佣金"</span>
<span class="token keyword">from</span> emp<span class="token punctuation">;</span></code></pre>
<p><strong>参数模式</strong></p>
<table>
<thead>
<tr>
<th align="center">in</th>
<th align="center">out</th>
<th align="center">in out</th>
</tr>
</thead>
<tbody><tr>
<td align="center">默认</td>
<td align="center">必须指定</td>
<td align="center">必须指定</td>
</tr>
<tr>
<td align="center">值被传递给子程序</td>
<td align="center">返回到调用环境</td>
<td align="center">传递给子程序，返回到调用环境</td>
</tr>
<tr>
<td align="center">参数形式：常量</td>
<td align="center">未初始化的变量</td>
<td align="center">初始化的变量</td>
</tr>
<tr>
<td align="center">可以是表达式，常量，或者是初始化的变量</td>
<td align="center">必须是一个变量</td>
<td align="center">必须是一个变量</td>
</tr>
</tbody></table>
<p><strong>函数与过程比较</strong></p>
<table>
<thead>
<tr>
<th align="center">过程</th>
<th align="center">函数</th>
</tr>
</thead>
<tbody><tr>
<td align="center">完成某些特定的任务或工作</td>
<td align="center">完成复杂的计算</td>
</tr>
<tr>
<td align="center">作为一个独立的PL/SQL语句来执行</td>
<td align="center">不饿能独立执行，必须作为表达式的一部分来调用</td>
</tr>
<tr>
<td align="center">程序头部使用procedure声明</td>
<td align="center">头部使用function声明</td>
</tr>
<tr>
<td align="center">程序头不用描述返回类型</td>
<td align="center">程序头部必须描述返回值的类型</td>
</tr>
<tr>
<td align="center">不需要return语句</td>
<td align="center">必须在程序执行主体中办好return语句，至少有一个有效的return语句</td>
</tr>
<tr>
<td align="center">可以使用in/out/in out三种模式的参数</td>
<td align="center">可以使用in/out/in out三种模式的参数（但是out/in out没有意义）</td>
</tr>
<tr>
<td align="center">可以不返回值，也可以返回多个值，通过out/in out类型参数来返回</td>
<td align="center">必须返回一个值，通过return语句返回，并且返回的值要与声明部分一致，也可以通过out类型的参数带出变量（但是通常情况下不会这么做）</td>
</tr>
</tbody></table>
<p><strong>函数和存储过程</strong></p>
<p>函数的好处：</p>
<ul>
<li>可以实现用简单的SQL语句不能实现的计算</li>
<li>提高查询的效率</li>
</ul>
<p>函数和存储过程使用规则：</p>
<ul>
<li>1、在SQL语句中只能使用函数，而不是过程</li>
<li>2、函数中不允许DML语句，在过程中可以使用DML语句</li>
<li>3、函数的形参可以为in(out/in out)</li>
<li>4、在函数中必须返回Oracle支持的数据类型，而不是PL/SQL支持的数据类型</li>
</ul>
<p><strong>在SQL语句中调用函数</strong></p>
<ul>
<li>任何有效的SQL子句中</li>
<li>select命令的选择列表</li>
<li>where和having条件子句</li>
<li>order by，和group by子句</li>
<li>insert命令的values子句</li>
<li>update命令的set子句</li>
</ul>
<h2 id="Oracle的存储程序单元"><a href="#Oracle的存储程序单元" class="headerlink" title="Oracle的存储程序单元"></a>Oracle的存储程序单元</h2><p>在Oracle中，除了单次执行的PL/SQL匿名块以外，更多的使用的是PL/SQL程序（也就是PL/SQL的子程序）。</p>
<p>PL/SQL子程序就是数据库中命名的PL/SQL块，可以接收参数，也可以传出计算结果。</p>
<p>PL/SQL子程序主要有两种类型：</p>
<ul>
<li>存储过程（proceduer）：用来完成某些操作的任务</li>
<li>函数（function）：用来做复杂的计算</li>
</ul>
<p>PL/SQL子程序，是基于PL/SQL块的结构的，只是比PL/SQL块多了子程序头部的定义。使用PL/SQL子程序，使得PL/SQL程序易于维护，而且可以重复的使用。</p>
<h1 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h1><p>游标是一段私有的SQL工作区，也就是一段内存区域，用于暂时存放受到SQL语句影响到的数据。</p>
<p>在执行增删改查语句时，Oracle都会开辟一块内存空间，用来暂时存放受到SQL语句影响的数据。这块内存空间就被称为游标区域，可以借助于游标来分析这些受到影响的数据。</p>
<p>游标的分类：</p>
<ul>
<li>隐式游标：被用于描述执行的SQL命令。在PL/SQL中出现的SQL语句，Oracle都会为其分配一段私有的内存空间，也就是游标区域。所有的DML语句或PL/SQL select语句都有隐式游标。</li>
<li>显示游标：由开发人员通过程序显示控制，用于从表中取出多行数据，并将多行数据一行一行的单独进行处理。</li>
</ul>
<p>两种游标具有相同的属性，可以使用游标属性取得SQL语句的相关信息。</p>
<p>游标属性包括四种：</p>
<ul>
<li>%rowcount，受SQL影响的行数</li>
<li>%found，Boolean值，是否还有数据</li>
<li>%notfound，Boolean值，是否已无数据</li>
<li>%isopen，游标是否打开</li>
</ul>
<p>显示游标和隐式游标都有以上四种属性。但是使用方法和含义却不相同。</p>
<p>在使用游标时，需要使用游标名称作为前缀。但是隐式游标没有名称，所以在使用隐式游标时采用统一的一个名称SQL。</p>
<ul>
<li>sql%rowcount，受SQL影响的行数</li>
<li>sql%found，Boolean值，是否还有数据</li>
<li>sql%notfound，Boolean值，是否已无数据</li>
<li>sql%isopen，总是为false</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    v_count number<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">delete</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    v_count :<span class="token operator">=</span> sql<span class="token operator">%</span><span class="token keyword">rowcount</span><span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'被删除的数据的条数是：'</span> <span class="token operator">||</span> v_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>显示游标的使用</strong></p>
<ul>
<li>可以用于暂存查询取出的多行结果，然后一行一行的处理</li>
<li>显示游标就是专门用来查询多条数据的</li>
<li>按行处理查询返回的多行结果</li>
<li>显示游标首先将查询出的多行数据暂存在游标区域中，然后再PL/SQL中借助于循环语句手动的控制游标的多行操作，每次取出一条进行处理，直到取出游标中所有的数据为止。</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    <span class="token comment" spellcheck="true">--1、声明游标，一个显示游标，就是和一个有效的select语句绑定的</span>
    <span class="token keyword">cursor</span> cur_emp <span class="token operator">is</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
    v_rec_emp emp<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--2、打开游标，就是执行了游标绑定的SQL语句，并且把受到影响的数据放入到了游标区域中</span>
    <span class="token keyword">open</span> cur_emp<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">--3、取出游标中的一条数据装入记录类型的变量中</span>
    <span class="token keyword">fetch</span> cur_emp <span class="token keyword">into</span> v_rec_emp<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">--从记录类型的变量中取出查询的数据</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_rec_emp<span class="token punctuation">.</span>empno <span class="token operator">||</span> <span class="token string">','</span> <span class="token operator">||</span> v_rec_emp<span class="token punctuation">.</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">--关闭游标，清空游标区域</span>
    <span class="token keyword">close</span> cur_emp<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>使用loop循环遍历和%found搭配使用分析游标数据</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    <span class="token keyword">cursor</span> cur_emp <span class="token operator">is</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
    v_rec_emp emp<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--游标在没有之前，在关闭之后，是无法使用的，就会导致无效的游标错误</span>
    <span class="token comment" spellcheck="true">--在关闭之后，如果需要重新使用游标，需要重新打开游标</span>
    <span class="token keyword">open</span> cur_emp<span class="token punctuation">;</span>
    <span class="token keyword">fetch</span> cur_emp <span class="token keyword">into</span> v_rec_emp<span class="token punctuation">;</span>
    loop
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_rec_emp<span class="token punctuation">.</span>empno <span class="token operator">||</span> <span class="token string">','</span> <span class="token operator">||</span> v_rec_emp<span class="token punctuation">.</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">fetch</span> cur_emp <span class="token keyword">into</span> v_rec_emp<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">--装入另一条数据</span>
        <span class="token keyword">exit</span> <span class="token keyword">when</span> cur_emp<span class="token operator">%</span>notfound<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">--当游标中没有数据时，退出循环</span>
    <span class="token keyword">end</span> loop<span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'查询数据的总条数是：'</span> <span class="token operator">||</span> cur_emp<span class="token operator">%</span><span class="token keyword">rowcount</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">close</span> cur_emp<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>使用while循环和%found搭配使用分析游标数据</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    <span class="token keyword">cursor</span> cur_emp <span class="token operator">is</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
    v_rec_emp emp<span class="token operator">%</span>rowtype<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">open</span> cur_emp<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">--在没有执行fetch操作之前，游标中是没有数据的，也就是cur_emp%found为false。</span>
    <span class="token keyword">fetch</span> cur_emp <span class="token keyword">into</span> v_rec_emp<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cur_emp<span class="token operator">%</span>found<span class="token punctuation">)</span> loop
        <span class="token keyword">fetch</span> cur_emp <span class="token keyword">into</span> v_rec_emp<span class="token punctuation">;</span>
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_rec_emp<span class="token punctuation">.</span>empno <span class="token operator">||</span> <span class="token string">','</span> <span class="token operator">||</span> v_rec_emp<span class="token punctuation">.</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">fetch</span> cur_emp <span class="token keyword">into</span> v_rec_emp<span class="token punctuation">;</span>
    <span class="token keyword">end</span> loop<span class="token punctuation">;</span>
    dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'查询数据的总条数是：'</span> <span class="token operator">||</span> cur_emp<span class="token operator">%</span><span class="token keyword">rowcount</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">close</span> cur_emp<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>使用for循环，可以简化游标的开发，Oracle会自动声明记录类型的变量，Oracle会自动的open,fetch,close游标</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">declare</span>
    <span class="token keyword">cursor</span> cur_emp <span class="token operator">is</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--Oracle会自动的声明记录类型的变量v_rec_emp，类型是emp%rowtype</span>
    <span class="token keyword">for</span> v_rec_emp <span class="token operator">in</span> cur_emp loop
        dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>v_rec_emp<span class="token punctuation">.</span>empno <span class="token operator">||</span> <span class="token string">','</span> <span class="token operator">||</span> v_rec_emp<span class="token punctuation">.</span>ename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> loop<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h1><p>触发器类似于函数和过程，同样是具有声明部分、执行部分和异常处理部分的命名PL/SQL块。但与过程、函数不同的是，触发器是在事件发生时隐式的运行的，并且触发器不能接收参数；而过程、函数是用户显示调用的，可以接收参数。</p>
<p>运行触发器的方式叫做触动（firing），指在特定的事件发生的时候（前或后）自动运行定义好的PL/SQL程序。</p>
<p>触发的事件可以是多数据库表的DML操作（insert、update或delete）或某个视图的操作。</p>
<p>触发的事件也可以是系统事件，例如数据库的启动和关闭，以及一些DDL操作。</p>
<p>触发器被作为触动触发器的事务的一部分，所以在触发器中不可以使用结束事务的事务控制语句。</p>
<p><strong>触发器主要用于下列情况：</strong></p>
<ul>
<li>安全性方面，确定用户的操作是否可以继续执行</li>
<li>产生对数据值修改的审计，将修改的信息记录下来，产生数据改动记录</li>
<li>提供更灵活的完整性校验规则，能根据复杂的规则校验数据</li>
<li>提供表数据的同步复制，使多个表的数据同步</li>
<li>事件日志记录，记录数据库的重要操作</li>
</ul>
<blockquote>
<p>触发器类型</p>
</blockquote>
<p>在Oracle数据库中主要有两种触发器类型</p>
<ul>
<li>DML触发器</li>
<li>系统触发器</li>
</ul>
<h2 id="DML触发器"><a href="#DML触发器" class="headerlink" title="DML触发器"></a>DML触发器</h2><p>DML触发器由DML语句触发，并且语句类型决定了DML触发器的类型。</p>
<p>DML触发器类型主要包括insert、update、delete三种触发器。</p>
<ul>
<li>操作对象：表或视图</li>
<li>触发的时机包括：对表来说由before或after触发，对视图来说由instead of</li>
<li>触发范围包括：行级触发或语句级触发。行级触发时在每行数据操作时都会触发执行</li>
<li>可以设置when子句，决定触发后是否执行触发器的执行部分；如果不设置when子句，那么只要事件触发，就执行程序体</li>
</ul>
<p><strong>语句级DML触发器语法格式</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token punctuation">[</span><span class="token operator">or</span> replace<span class="token punctuation">]</span> <span class="token keyword">trigger</span> trigger_name
    timing
        event1 <span class="token punctuation">[</span><span class="token operator">or</span> event2 <span class="token operator">or</span> event3<span class="token punctuation">]</span>
            <span class="token keyword">on</span> table_name
        <span class="token keyword">when</span> conditions
<span class="token punctuation">[</span><span class="token keyword">declare</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true">--同样可以声明变量等</span>
<span class="token keyword">begin</span>

<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<ul>
<li>timing：表示触发实际可以是after或before</li>
<li>event1：表示触发事件，例如：insert，delete，update</li>
<li>when：表示执行触发器的条件</li>
<li>tirgger_body：触发器的执行体</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--向emp表中插入一条数据，会自动激活触发器的工作</span>
<span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">trigger</span> secure_emp
    before <span class="token keyword">insert</span> <span class="token keyword">on</span> emp
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--如果当前的时间是星期六或星期日，或时间不在8:00-18:00之间</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'dy'</span><span class="token punctuation">)</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'星期六'</span><span class="token punctuation">,</span><span class="token string">'星期日'</span><span class="token punctuation">)</span> <span class="token operator">or</span>
      <span class="token punctuation">(</span>to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'hh24:mi'</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token operator">between</span> <span class="token string">'08:00'</span> <span class="token operator">and</span> <span class="token string">'18:00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
      <span class="token comment" spellcheck="true">--提升一条用户自定义的错误信息，通过这个错误信息，中断用户的操作</span>
      raise_application_error<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20500</span><span class="token punctuation">,</span><span class="token string">'你只能在工作时间对表进行操作'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>注意：</p>
<ul>
<li>raise_application_error：这一语句升起一个用户定义错误，显示一条用户定义提示。</li>
<li>错误号必须在当在-20000..-20999之间</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">trigger</span> secure_emp_2
    before <span class="token keyword">insert</span> <span class="token operator">or</span> <span class="token keyword">update</span> <span class="token operator">or</span> <span class="token keyword">delete</span> <span class="token keyword">on</span> employees
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--如果当前时间是周六或周日，或者时间不在8:00-18:00之间</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'dy'</span><span class="token punctuation">)</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'SAT'</span><span class="token punctuation">,</span><span class="token string">'SUN'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token punctuation">(</span>to_char<span class="token punctuation">(</span>sysdate<span class="token punctuation">,</span><span class="token string">'hh24'</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token operator">between</span> <span class="token string">'08'</span> <span class="token operator">and</span> <span class="token string">'18'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token keyword">if</span> deleting <span class="token keyword">then</span>
            raise_application_error<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20502</span><span class="token punctuation">,</span><span class="token string">'你只能在工作时间删除员工表的数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elsif inserting <span class="token keyword">then</span>
            raise_application_error<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20500</span><span class="token punctuation">,</span><span class="token string">'你只能在工作时间插入员工表的数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        elsif updating <span class="token punctuation">(</span><span class="token string">'SALARY'</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
            raise_application_error<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20503</span><span class="token punctuation">,</span><span class="token string">'你只能在工作时间更新员工表的数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            raise_application_error<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20504</span><span class="token punctuation">,</span><span class="token string">'你只能在工作时间操作员工表的数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p><strong>行级DML触发器语法格式</strong></p>
<pre><code>create [or replace] trigger trigger_name
    timing
        event1 [or event2 or event3]
            on table_name
        [referencing OLD as old|NEW as new]
        for each row
        [when conditions]
[declare]
    --同样可以声明变量等
begin

end;</code></pre><ul>
<li>for each row：表明对表中的每行数据操作时都会触发这个触发器。referencing子句是说明触发器替换值的前缀名，默认替换前的前缀名为old，替换后的前缀名为new。也可以自己声明替换前后变量的前缀规则。</li>
</ul>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">trigger</span> restrict_salary
    before <span class="token keyword">insert</span> <span class="token operator">or</span> <span class="token keyword">update</span> <span class="token keyword">of</span> sal <span class="token keyword">on</span> emp
    <span class="token keyword">for each row</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--如果新插入的工作不是'AD_PRES'，'AD_VP'，并且新的工资 > 15000</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token punctuation">(</span>:new<span class="token punctuation">.</span>job <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'AD_PRES'</span><span class="token punctuation">,</span><span class="token string">'AD_VP'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">and</span> :new<span class="token punctuation">.</span>sal <span class="token operator">></span> <span class="token number">15000</span> <span class="token keyword">then</span>
        raise_application_error<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20202</span><span class="token punctuation">,</span><span class="token string">'员工不能有这么高的工资'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">--不允许降低员工的工资</span>
<span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">trigger</span> restrict_salary
    before <span class="token keyword">update</span> <span class="token keyword">of</span> sal <span class="token keyword">on</span> emp
    <span class="token keyword">for each row</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--新的工资小于老的工资</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token punctuation">(</span>:new<span class="token punctuation">.</span>sal <span class="token operator">&lt;</span> :old<span class="token punctuation">.</span>sal<span class="token punctuation">)</span> <span class="token keyword">then</span>
        raise_application_error<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20202</span><span class="token punctuation">,</span><span class="token string">'黑心的资本家，你不能降低员工的工资'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>创建触发器，解决外键约束问题</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--在插入员共表记录之前，首先判断新插入的部门编号是否存在；</span>
<span class="token comment" spellcheck="true">--如果新的部门编号不存在，则首先向部门表中插入该部门</span>
<span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">trigger</span> restrict_salary
    before <span class="token keyword">insert</span> <span class="token keyword">on</span> emp
    <span class="token keyword">for each row</span>
<span class="token comment" spellcheck="true">--在触发器中要想声明变量，必须要加入declare</span>
<span class="token keyword">declare</span>
    v_count number<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v_dname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">into</span> v_count <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> :new<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>v_count <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        v_dname :<span class="token operator">=</span> <span class="token string">'部门-'</span> <span class="token operator">||</span> :new<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
        <span class="token keyword">insert</span> <span class="token keyword">into</span> dept <span class="token keyword">values</span> <span class="token punctuation">(</span>:new<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span>v_dname<span class="token punctuation">,</span><span class="token string">'北京'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<p>通过触发器，来实现级联删除的操作。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--在删除部门时，如果该部门有员工，把该部门的所有员工也删除掉</span>
<span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">trigger</span> restrict_salary
    before <span class="token keyword">delete</span> <span class="token keyword">on</span> dept
    <span class="token keyword">for each row</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--删除部门之前，首先删除员工表中的该部门的所有员工</span>
    <span class="token keyword">delete</span> <span class="token keyword">from</span> emp <span class="token keyword">where</span> deptno <span class="token operator">=</span> :old<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<h2 id="视图上的instead-of触发器"><a href="#视图上的instead-of触发器" class="headerlink" title="视图上的instead of触发器"></a>视图上的instead of触发器</h2><pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token punctuation">[</span><span class="token operator">or</span> replace<span class="token punctuation">]</span> <span class="token keyword">trigger</span> trigger_name
    instead <span class="token keyword">of</span>
        event1 <span class="token punctuation">[</span><span class="token operator">or</span> event2 <span class="token operator">or</span> event3<span class="token punctuation">]</span>
        <span class="token keyword">on</span> view_name
    <span class="token punctuation">[</span>referencing OLD <span class="token keyword">as</span> old <span class="token operator">|</span> NEW <span class="token keyword">as</span> new<span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token keyword">for each row</span><span class="token punctuation">]</span>
trigger_body</code></pre>
<p>instead of：被用于视图，当对视图进行DML操作时，对视图的DML操作被转换为对另外一些表的操作。</p>
<pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">--创建视图</span>
<span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">view</span> view_empinfo
<span class="token keyword">as</span>
<span class="token keyword">select</span> <span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span><span class="token number">e</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> emp<span class="token punctuation">,</span>dept <span class="token number">d</span>
<span class="token keyword">where</span> <span class="token number">e</span><span class="token punctuation">.</span>deptno <span class="token operator">=</span> <span class="token number">d</span><span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">---创建触发器</span>
<span class="token keyword">create</span> <span class="token keyword">of</span> replace <span class="token keyword">trigger</span> insert_view
    instead <span class="token keyword">of</span> <span class="token keyword">insert</span> <span class="token keyword">on</span> view_empinfo
    <span class="token keyword">for each row</span>
<span class="token keyword">declare</span>
    v_count number<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token comment" spellcheck="true">--判断向视图插入的部门是否存在，如果该部门不存在，则向部门表中插入新数据</span>
    <span class="token comment" spellcheck="true">--如果该部门存在，则更新部门表的部门名称和位置</span>
    <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">into</span> v_count <span class="token keyword">from</span> dept <span class="token keyword">where</span> deptno <span class="token operator">=</span> :nwe<span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>v_count <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span>
        <span class="token comment" spellcheck="true">--把一部分数据插入到dept表中</span>
        <span class="token keyword">insert</span> <span class="token keyword">into</span> dept <span class="token keyword">values</span><span class="token punctuation">(</span>:new<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span>:new<span class="token punctuation">.</span>dname<span class="token punctuation">,</span>:new<span class="token punctuation">.</span>loc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token comment" spellcheck="true">--把一部分数据插入到emp表中</span>
        <span class="token keyword">insert</span> <span class="token keyword">into</span> emp <span class="token keyword">values</span><span class="token punctuation">(</span>:new<span class="token punctuation">.</span>empno<span class="token punctuation">,</span>:new<span class="token punctuation">.</span>ename<span class="token punctuation">,</span>:new<span class="token punctuation">.</span>job<span class="token punctuation">,</span>:new<span class="token punctuation">.</span>mgr<span class="token punctuation">,</span>:new<span class="token punctuation">.</span>hiredate<span class="token punctuation">,</span>:new<span class="token punctuation">.</span>sal<span class="token punctuation">,</span>:new<span class="token punctuation">.</span>comm<span class="token punctuation">,</span>:new<span class="token punctuation">,</span>deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>
<h2 id="管理触发器"><a href="#管理触发器" class="headerlink" title="管理触发器"></a>管理触发器</h2><ul>
<li><p>启用或者禁用某个触发器</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">trigger</span> trigger_name <span class="token keyword">disable</span><span class="token operator">|</span><span class="token keyword">enable</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>启用或者禁用某个对象上的所有触发器</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> table_name <span class="token keyword">disable</span><span class="token operator">|</span><span class="token keyword">enable</span> <span class="token keyword">all</span> triggers<span class="token punctuation">;</span></code></pre>
</li>
<li><p>重编译触发器</p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">trigger</span> trigger_name compile<span class="token punctuation">;</span></code></pre>
</li>
</ul>
<h2 id="数据库系统级触发器"><a href="#数据库系统级触发器" class="headerlink" title="数据库系统级触发器"></a>数据库系统级触发器</h2><p>用户触发事件：</p>
<ul>
<li>create、alter或drop命令</li>
<li>登录或退出数据库连接</li>
</ul>
<p>系统触发事件：</p>
<ul>
<li>启动、关闭数据库</li>
<li>特殊错误发生</li>
</ul>
<p><strong>DDL触发器语法</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token punctuation">[</span><span class="token operator">or</span> replace<span class="token punctuation">]</span> <span class="token keyword">trigger</span> trigger_name
    timing
        <span class="token punctuation">[</span>ddl_event1 <span class="token punctuation">[</span><span class="token operator">or</span> ddl_event2 <span class="token operator">or</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">on</span> {<span class="token keyword">database</span><span class="token operator">|</span><span class="token keyword">schema</span>}
trigger_body</code></pre>
<p>可以使用DDL触发器强制用户执行DDL语句的规则，例如只让用户执行create table的操作。</p>
<p><strong>系统事件触发器语法</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token punctuation">[</span><span class="token operator">or</span> replace<span class="token punctuation">]</span> <span class="token keyword">trigger</span> trigger_name
    timing
        <span class="token punctuation">[</span>database_event1 <span class="token punctuation">[</span><span class="token operator">or</span> database_event2 <span class="token operator">or</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">on</span> {<span class="token keyword">database</span><span class="token operator">|</span><span class="token keyword">schema</span>}
trigger_body</code></pre>
<p><strong>登录/退出触发器</strong></p>
<pre class=" language-sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">trigger</span> logon_trig
<span class="token keyword">after</span> logon <span class="token keyword">on</span> <span class="token keyword">schema</span>
<span class="token keyword">begin</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> log_trig_table<span class="token punctuation">(</span>user_id<span class="token punctuation">,</span>log_date<span class="token punctuation">,</span><span class="token keyword">action</span><span class="token punctuation">)</span>
    <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token keyword">user</span><span class="token punctuation">,</span>sysdate<span class="token punctuation">,</span><span class="token string">'Logging on'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token operator">or</span> replace <span class="token keyword">trigger</span> logoff_trig
before logoff <span class="token keyword">on</span> <span class="token keyword">schema</span>
<span class="token keyword">begin</span>
    <span class="token keyword">insert</span> <span class="token keyword">into</span> log_trig_table<span class="token punctuation">(</span>user_id<span class="token punctuation">,</span>log_date<span class="token punctuation">,</span><span class="token keyword">action</span><span class="token punctuation">)</span>
    <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token keyword">user</span><span class="token punctuation">,</span>sysdate<span class="token punctuation">,</span><span class="token string">'Logging off'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span></code></pre>

            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Oracle/">
                                    <span class="chip bg-color">Oracle</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    /* #vcomments .vwrap {
        box-sizing: border-box;
        padding: 0 0 44px;
        background-color: #F0FFF0;
    }
    #vcomments .vwrap .vheader{width: 80%;bottom:0;position: absolute;background: #F0FFF0;}

    #vcomments .vinput{padding:10px 15px; text-align: center;}

    #vcomments .vwrap .vheader .vinput{border-bottom:0px}

    #vcomments .vwrap .vedit .vctrl{margin-top:-44px;right:0;position:absolute;margin-right:-3px;}

    #vcomments  .vwrap .vrow{position:absolute;right:0;bottom:0;width:20%;padding-top:0px;}

    #vcomments  .vrow {font-size: 0;padding: 0px 0;}

    #vcomments  .vicon {margin-right: 15px;}

    #vcomments  .vrow .vcol.vcol-30{display: none}

    #vcomments  .vedit .vctrl span.vpreview-btn{display: none}

    #vcomments  .vrow .vcol.vcol-70{width: 100%;}

    #vcomments  .vsubmit.vbtn{border-radius: 0;padding: 0;color: #fff;line-height: 44px;width:100%;border: none;background:#00ecbc;}

    #vcomments  .vcards .vcard .vh .vhead .vsys{background: #F0FFF0;}

    #vcomments  .vcards .vcard .vh .vmeta .vat{font-size: 12px;display: block;margin-left: 15px;float: right;color: #fff;background-color: #00ecbc;line-height: 20px;padding: 0 6px;border-radius: 3px;}

    @media screen and (max-width: 520px){
    #vcomments  .vwrap .vheader .vinput{width: 33.33%;padding:10px 5px;}  
    } */

    #vcomments input[type=text],

    #vcomments input[type=email],

    #vcomments input[type=url],

    #vcomments textarea {
        box-sizing: border-box;
    }
    #vcomments .vwrap p {
        height: 20px;
        width: 20px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }
    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    /* 修复评论第一行位置错位 */
    .v .vlist .vcard {
    padding-top: 2.5em !important ;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        admin_email: '2292807998@qq.com',
        appId: 'vDtNtruYzjCbFJbWyeQ8Bybw-gzGzoHsz',
        appKey: 'TJv4iKCEAYMHDhy8V8IvAJGF',
        path: window.location.pathname,
        comment_count: true,
        notify: 'false' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'retro',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'ヾﾉ≧∀≦)o在这里可以留言评论喔！',

    });
    $(document).ready(function(){
        $("#vcomments").on('click', 'span.vat',function(){
            $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
            $('textarea#veditor').focus();
        })
    })
</script>
<!-- <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
<script type="text/javascript">
    jinrishici.load(function(result) {
        var jrsc_plac =  result.data.content + "\n「" + result.data.origin.title + "」" + result.data.origin.dynasty + " · " + result.data.origin.author
        document.getElementById("veditor").setAttribute("placeholder",jrsc_plac);
    });
</script> -->

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/archives/af4eacf0/">
                    <div class="card-image">
                        
                        <img src="https://cdn.jsdelivr.net/gh/lskjwp/image/imageCover/Go学习笔记.jpg" class="responsive-img" alt="Golang学习笔记">
                        
                        <span class="card-title">Golang学习笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            学习文档链接：Go入门学习
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-06-17
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Go/" class="post-category">
                                    Go
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Go/">
                        <span class="chip bg-color">Go</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/archives/580061a7/">
                    <div class="card-image">
                        
                        <img src="https://cdn.jsdelivr.net/gh/lskjwp/image/imageCover/SpringCloud%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.jpg" class="responsive-img" alt="SpringCloud学习笔记">
                        
                        <span class="card-title">SpringCloud学习笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            学习视频链接：遇见狂神说  尚硅谷
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-05-13
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/SpringCloud/" class="post-category">
                                    SpringCloud
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/SpringCloud/">
                        <span class="chip bg-color">SpringCloud</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" >
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

    <div id="floating-toc-btn" class="hide-on-med-and-down" >
        <a class="btn-floating btn-large waves-effect waves-light" title="展开/关闭TOC">
            <i class="fas fa-list-ul" style="zoom: 0.88;"></i>
        </a>
    </div>
<!-- <div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div> -->


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="6668004913"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="/about" target="_blank">勇也很努力</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">317.4k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv" style="display: none;">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv" style="display:none">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "7";
                    var startDate = "1";
                    var startHour = "14";
                    var startMinute = "24";
                    var startSecond = "48";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:2292807998@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2292807998" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2292807998" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>
<script>
    /*
    修改不蒜子初始化计数
    */
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);  // 50ms周期检测函数
        var pvcountOffset = 3000;  // 初始化首次数据
        var uvcountOffset = 1100;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int); // 停止检测
            }
        }
    });
</script>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!" title="返回顶部">
        <i class="fas fa-arrow-up" style="zoom: 0.88;"></i>
    </a>
</div>

    <!-- <script src="/js/fireworks.js"></script> -->
    <!-- <script src="/js/cursor.js"></script> -->
    <!-- <script src="/js/click_show_text.js"></script> -->
    <!-- <script src="/js/snow.js"></script> -->


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    
    <script>
        (function (i, s, o, g, r, a, m) {
            i["DaoVoiceObject"] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o), m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            a.charset = "utf-8";
            m.parentNode.insertBefore(a, m)
        })(window, document, "script", ('https:' == document.location.protocol ? 'https:' : 'http:') +
            "//widget.daovoice.io/widget/6984b559.js", "daovoice")
        daovoice('init', {
            app_id: "f9383031"
        });
        daovoice('update');
    </script>
    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

    <script type="text/javascript">
        var OriginTitile=document.title,st;
        document.addEventListener("visibilitychange",function(){
            document.hidden?(document.title="ヽ(●-`Д´-)ノ你要玩捉迷藏嘛",clearTimeout(st)):(document.title="(Ő∀Ő3)ノ好哦！",st=setTimeout(function(){document.title=OriginTitile},3e3))
        })
    </script>

    <!--夜晚模式-->
    <script>
        if (localStorage.getItem('dark') === '1') {
        document.body.classList.add('dark');
        }
        else if (new Date().getHours() >= 22 || new Date().getHours() < 7) {
        document.body.classList.add('dark');
        } 
        else if (matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
        }
    </script>

    <!--全屏-->
    <script src="/js/fullscreen.js" type="module"></script>
    <a onclick="switchNightMode()" id="sma">
        <i class="fa fa-moon-o" id="nightMode" aria-hidden="true"></i>
    </a><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>

</html>
